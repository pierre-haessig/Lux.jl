


<a id='Training-a-Neural-ODE-to-Model-Gravitational-Waveforms'></a>

# Training a Neural ODE to Model Gravitational Waveforms


This code is adapted from [Astroinformatics/ScientificMachineLearning](https://github.com/Astroinformatics/ScientificMachineLearning/blob/c93aac3a460d70b4cce98836b677fd9b732e94b7/neuralode_gw.ipynb)


The code has been minimally adapted from [Keith et. al. 2021](https://arxiv.org/abs/2102.12695) which originally used Flux.jl


<a id='Package-Imports'></a>

## Package Imports


```julia
using Lux, ComponentArrays, LineSearches, LuxAMDGPU, LuxCUDA, OrdinaryDiffEq,
    Optimization, OptimizationOptimJL, Random, SciMLSensitivity
using CairoMakie, MakiePublication
CUDA.allowscalar(false)
```


<a id='Define-some-Utility-Functions'></a>

## Define some Utility Functions


::: tip


This section can be skipped. It defines functions to simulate the model, however, from a scientific machine learning perspective, isn't super relevant.


:::


We need a very crude 2-body path. Assume the 1-body motion is a newtonian 2-body position vector $r = r_1 - r_2$ and use Newtonian formulas to get $r_1$, $r_2$ (e.g. Theoretical Mechanics of Particles and Continua 4.3)


```julia
function one2two(path, m₁, m₂)
    M = m₁ + m₂
    r₁ = m₂ / M .* path
    r₂ = -m₁ / M .* path
    return r₁, r₂
end
```


```
one2two (generic function with 1 method)
```


Next we define a function to perform the change of variables: $(\chi(t),\phi(t)) \mapsto (x(t),y(t))$


```julia
@views function soln2orbit(soln, model_params=nothing)
    @assert size(soln, 1) ∈ [2, 4] "size(soln,1) must be either 2 or 4"

    if size(soln, 1) == 2
        χ = soln[1, :]
        ϕ = soln[2, :]

        @assert length(model_params)==3 "model_params must have length 3 when size(soln,2) = 2"
        p, M, e = model_params
    else
        χ = soln[1, :]
        ϕ = soln[2, :]
        p = soln[3, :]
        e = soln[4, :]
    end

    r = p ./ (1 .+ e .* cos.(χ))
    x = r .* cos.(ϕ)
    y = r .* sin.(ϕ)

    orbit = vcat(x', y')
    return orbit
end
```


```
soln2orbit (generic function with 2 methods)
```


This function uses second-order one-sided difference stencils at the endpoints; see https://doi.org/10.1090/S0025-5718-1988-0935077-0


```julia
function d_dt(v::AbstractVector, dt)
    a = -3 / 2 * v[1] + 2 * v[2] - 1 / 2 * v[3]
    b = (v[3:end] .- v[1:(end - 2)]) / 2
    c = 3 / 2 * v[end] - 2 * v[end - 1] + 1 / 2 * v[end - 2]
    return [a; b; c] / dt
end
```


```
d_dt (generic function with 1 method)
```


This function uses second-order one-sided difference stencils at the endpoints; see https://doi.org/10.1090/S0025-5718-1988-0935077-0


```julia
function d2_dt2(v::AbstractVector, dt)
    a = 2 * v[1] - 5 * v[2] + 4 * v[3] - v[4]
    b = v[1:(end - 2)] .- 2 * v[2:(end - 1)] .+ v[3:end]
    c = 2 * v[end] - 5 * v[end - 1] + 4 * v[end - 2] - v[end - 3]
    return [a; b; c] / (dt^2)
end
```


```
d2_dt2 (generic function with 1 method)
```


Now we define a function to compute the trace-free moment tensor from the orbit


```julia
function orbit2tensor(orbit, component, mass=1)
    x = orbit[1, :]
    y = orbit[2, :]

    Ixx = x .^ 2
    Iyy = y .^ 2
    Ixy = x .* y
    trace = Ixx .+ Iyy

    if component[1] == 1 && component[2] == 1
        tmp = Ixx .- trace ./ 3
    elseif component[1] == 2 && component[2] == 2
        tmp = Iyy .- trace ./ 3
    else
        tmp = Ixy
    end

    return mass .* tmp
end

function h_22_quadrupole_components(dt, orbit, component, mass=1)
    mtensor = orbit2tensor(orbit, component, mass)
    mtensor_ddot = d2_dt2(mtensor, dt)
    return 2 * mtensor_ddot
end

function h_22_quadrupole(dt, orbit, mass=1)
    h11 = h_22_quadrupole_components(dt, orbit, (1, 1), mass)
    h22 = h_22_quadrupole_components(dt, orbit, (2, 2), mass)
    h12 = h_22_quadrupole_components(dt, orbit, (1, 2), mass)
    return h11, h12, h22
end

function h_22_strain_one_body(dt::T, orbit) where {T}
    h11, h12, h22 = h_22_quadrupole(dt, orbit)

    h₊ = h11 - h22
    hₓ = T(2) * h12

    scaling_const = √(T(π) / 5)
    return scaling_const * h₊, -scaling_const * hₓ
end

function h_22_quadrupole_two_body(dt, orbit1, mass1, orbit2, mass2)
    h11_1, h12_1, h22_1 = h_22_quadrupole(dt, orbit1, mass1)
    h11_2, h12_2, h22_2 = h_22_quadrupole(dt, orbit2, mass2)
    h11 = h11_1 + h11_2
    h12 = h12_1 + h12_2
    h22 = h22_1 + h22_2
    return h11, h12, h22
end

function h_22_strain_two_body(dt::T, orbit1, mass1, orbit2, mass2) where {T}
    # compute (2,2) mode strain from orbits of BH 1 of mass1 and BH2 of mass 2

    @assert abs(mass1 + mass2 - 1.0)<1e-12 "Masses do not sum to unity"

    h11, h12, h22 = h_22_quadrupole_two_body(dt, orbit1, mass1, orbit2, mass2)

    h₊ = h11 - h22
    hₓ = T(2) * h12

    scaling_const = √(T(π) / 5)
    return scaling_const * h₊, -scaling_const * hₓ
end

function compute_waveform(dt::T, soln, mass_ratio, model_params=nothing) where {T}
    @assert mass_ratio≤1 "mass_ratio must be <= 1"
    @assert mass_ratio≥0 "mass_ratio must be non-negative"

    orbit = soln2orbit(soln, model_params)
    if mass_ratio > 0
        m₂ = inv(T(1) + mass_ratio)
        m₁ = mass_ratio * m₂

        orbit₁, orbit₂ = one2two(orbit, m₁, m₂)
        waveform = h_22_strain_two_body(dt, orbit1, mass1, orbit2, mass2)
    else
        waveform = h_22_strain_one_body(dt, orbit)
    end
    return waveform
end
```


```
compute_waveform (generic function with 2 methods)
```


<a id='Simulating-the-True-Model'></a>

## Simulating the True Model


`RelativisticOrbitModel` defines system of odes which describes motion of point like particle in schwarzschild background, uses


$$
u[1] = \chi
$$


$$
u[2] = \phi
$$


where, $p$, $M$, and $e$ are constants


```julia
function RelativisticOrbitModel(u, (p, M, e), t)
    χ, ϕ = u

    numer = (p - 2 - 2 * e * cos(χ)) * (1 + e * cos(χ))^2
    denom = sqrt((p - 2)^2 - 4 * e^2)

    χ̇ = numer * sqrt(p - 6 - 2 * e * cos(χ)) / (M * (p^2) * denom)
    ϕ̇ = numer / (M * (p^(3 / 2)) * denom)

    return [χ̇, ϕ̇]
end

mass_ratio = 0.0         # test particle
u0 = Float64[π, 0.0]     # initial conditions
datasize = 250
tspan = (0.0f0, 6.0f4)   # timespace for GW waveform
tsteps = range(tspan[1], tspan[2]; length=datasize)  # time at each timestep
dt_data = tsteps[2] - tsteps[1]
dt = 100.0
const ode_model_params = [100.0, 1.0, 0.5]; # p, M, e
```


Let's simulate the true model and plot the results using `OrdinaryDiffEq.jl`


```julia
prob = ODEProblem(RelativisticOrbitModel, u0, tspan, ode_model_params)
soln = Array(solve(prob, RK4(); saveat=tsteps, dt, adaptive=false))
waveform = first(compute_waveform(dt_data, soln, mass_ratio, ode_model_params))

fig = with_theme(theme_web()) do
    fig = Figure()
    ax = CairoMakie.Axis(fig[1, 1]; xlabel="Time", ylabel="Waveform")

    l = lines!(ax, tsteps, waveform; linewidth=2, alpha=0.75)
    s = scatter!(ax, tsteps, waveform; markershape=:circle, markeralpha=0.25, alpha=0.5)

    axislegend(ax, [[l, s]], ["Waveform Data"])

    return fig
end
```


![](1_GravitationalWaveForm-24.png)


<a id='Defiing-a-Neural-Network-Model'></a>

## Defiing a Neural Network Model


Next, we define the neural network model that takes 1 input (time) and has two outputs. We'll make a function `ODE_model` that takes the initial conditions, neural network parameters and a time as inputs and returns the derivatives.


It is typically never recommended to use globals but incase you do use them, make sure to mark them as `const`.


We will deviate from the standard Neural Network initialization and use `WeightInitializers.jl`,


```julia
const nn = Chain(Base.Fix1(broadcast, cos),
    Dense(1 => 32, cos; init_weight=truncated_normal(; std=1e-4)),
    Dense(32 => 32, cos; init_weight=truncated_normal(; std=1e-4)),
    Dense(32 => 2; init_weight=truncated_normal(; std=1e-4)))
ps, st = Lux.setup(MersenneTwister(), nn)
```


```
((layer_1 = NamedTuple(), layer_2 = (weight = Float32[0.00019216347; -5.6279983f-5; 3.7411795f-5; -0.00011563732; 0.00023942583; 1.964395f-5; 4.4780787f-5; -8.453147f-5; -2.2821514f-5; -0.00012508205; -0.0001263335; -0.00015608784; 9.096036f-6; 6.4745473f-6; 0.00024411618; -0.00030136097; 0.00011070244; -0.00016290115; 9.61327f-6; -0.00013228589; 8.732072f-6; 0.00012902764; 5.5615594f-5; -5.5557844f-5; -0.000111107685; 0.00010022129; 0.00010480005; 1.6765413f-5; -3.2223852f-5; -5.8552803f-5; -2.4507033f-5; -1.2297272f-5;;], bias = Float32[0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0;;]), layer_3 = (weight = Float32[0.00025254156 2.8349423f-5 7.996543f-6 0.00020763268 -0.00014033502 0.00017866849 0.00019607012 -1.79882f-5 -9.116278f-5 2.2492337f-5 -8.630826f-5 -9.367268f-5 -7.898461f-5 -1.8319592f-5 -2.800552f-5 -7.534016f-5 0.00010996047 4.951005f-5 3.1533295f-5 -2.280897f-5 4.8023717f-6 0.000111800844 9.949844f-5 0.00019508392 4.583087f-5 0.00015706371 0.00013695097 -4.0471492f-5 -0.00011033081 5.7305322f-5 -0.00011255947 5.825223f-6; -3.201984f-5 -8.8570145f-5 -2.8299748f-5 0.00026288058 -0.00013232231 5.068802f-5 2.265921f-5 -0.0001318968 -0.00011617372 0.00012211973 3.14147f-5 -6.8943614f-6 4.3119246f-5 -0.00020027319 -0.00018948402 -3.440544f-7 2.3921935f-5 -0.0001027202 -7.530759f-5 0.00021756231 -6.9787595f-5 0.00012473835 5.0670897f-5 -0.00015785109 3.0604973f-5 -4.2450618f-5 -1.9260102f-5 -6.403648f-5 2.4505802f-5 4.0646362f-5 0.00010034534 -3.1197884f-5; -3.4020786f-6 6.9841626f-5 9.186415f-6 -5.6020508f-5 9.0712616f-5 8.222214f-5 0.00019212486 6.142533f-6 -0.00011934025 1.5949232f-5 -5.2594473f-6 4.4414257f-5 7.3330525f-6 -7.133344f-5 0.00012400594 9.641301f-5 -0.00015635014 2.4931574f-5 -9.0839036f-5 -0.0001455243 -1.5227668f-5 0.00022383539 1.5084545f-5 -0.00015616011 -7.143348f-5 -6.859749f-5 -4.3110264f-5 3.7998172f-5 -3.1515898f-5 0.00021378064 4.264149f-5 3.0404248f-5; -1.27271505f-5 9.75424f-5 -3.7758324f-5 2.2399916f-5 2.0201405f-5 -0.000110692796 -8.902138f-5 -9.111683f-5 9.586943f-5 -2.9153112f-5 -5.0601462f-5 -8.166011f-5 0.00025881763 0.00015937982 1.4563096f-5 5.053379f-5 -0.00014524884 6.3254294f-5 -5.719489f-5 -5.332609f-5 -1.0072885f-5 0.00012619524 0.000119130505 2.4398783f-5 -0.00016953151 5.2723066f-5 0.000109672124 -4.0730596f-5 -1.1817747f-6 -0.00016051321 -0.00015063028 -2.1452921f-5; 0.00016680182 -7.478008f-5 6.937253f-5 0.00014632377 -0.00014732411 7.531338f-5 3.4901914f-6 -7.941473f-5 0.0001375566 3.5262954f-5 6.0152106f-5 0.00022149821 -0.000119710705 6.149661f-5 -1.9293893f-5 8.164213f-5 -8.349275f-5 8.285853f-5 0.00018192024 -9.977062f-5 -1.4962455f-5 2.6360727f-5 0.0001708592 -0.00013308691 1.31277875f-5 2.4531453f-6 4.0034443f-5 -0.00014127666 0.00014513446 -6.1636965f-5 4.5010085f-5 -0.00014474067; 4.571913f-6 -4.6450154f-5 -4.081635f-5 1.9841667f-5 0.00015027859 0.00014983989 -0.000103421095 8.697368f-5 6.759453f-5 -1.2069416f-5 -1.5414545f-5 -2.8830442f-5 0.00010362628 0.00012742194 -5.8914364f-5 -1.4266294f-5 -6.46059f-5 1.6106049f-5 -0.00014269684 -6.156627f-5 -0.00014757774 4.7071728f-5 6.400094f-5 4.92521f-6 -6.8336696f-5 -6.797019f-6 0.00019620205 -0.00015481297 4.78707f-5 -0.000118456104 -2.5858813f-5 -5.1719806f-5; -0.00013089592 -4.9260554f-5 0.00013431165 1.13596f-5 -2.4891597f-5 -0.00041591167 -0.00011975115 5.2401876f-5 -3.6370217f-5 -4.5596076f-5 7.097603f-5 -0.00012115881 1.2191589f-6 -0.00014398016 -4.300329f-5 0.00013168188 7.446224f-5 -0.00021483577 3.4902783f-5 0.00010062575 -5.7539153f-5 0.00017828545 -8.419575f-5 -2.3666584f-5 0.00012696527 -4.8695338f-6 -0.00025381605 0.0002824579 -0.0001553126 0.00017702705 1.2492908f-5 0.00011154169; 3.0411853f-5 -7.226532f-5 -8.74527f-6 -2.616992f-5 4.5959987f-5 8.232031f-5 0.00010839901 3.605055f-5 -0.0002870946 -2.0110301f-6 -6.353205f-5 6.621939f-6 3.160638f-5 7.4985414f-6 4.2508174f-5 0.0002083924 5.3762004f-5 -9.7016404f-5 -4.9203416f-5 0.000110817884 -8.261059f-6 6.70782f-5 6.63971f-5 -5.011402f-5 -1.9649708f-5 0.00010679703 -0.00018598854 0.0001360307 4.7086716f-5 -0.000100362406 3.4883444f-5 0.00023164178; 0.00019120051 -4.2131236f-5 9.4232935f-5 1.2579857f-5 -2.3955054f-5 -3.812838f-5 -6.385355f-5 -0.00011913421 0.00014817306 2.9074614f-5 -9.227651f-5 1.5470278f-5 -0.000105107145 3.665711f-5 4.8720853f-5 0.00022087386 2.4790452f-5 -0.00013380502 0.00010336006 -1.0366744f-5 9.579196f-5 -7.7357116f-5 3.8964963f-6 5.9657843f-5 -0.00015525892 0.00018895273 -2.6828116f-5 1.4435634f-5 1.6925502f-5 -6.5840155f-5 0.000110687775 5.2596028f-5; 4.7705737f-7 -4.005419f-5 -0.00014645603 0.000121534176 2.6256823f-5 7.807985f-5 -5.1914056f-5 0.00012430258 5.4406195f-5 0.00013841985 -5.607848f-5 -1.6617425f-5 -6.383032f-5 -5.880677f-5 -0.00016769728 -0.00010444607 -0.00012062683 1.2766825f-5 -6.2209954f-5 3.2675453f-5 6.7596025f-5 -0.00011753658 -0.00010860675 1.875366f-5 -0.0001558418 6.767742f-5 2.0517398f-5 4.7816324f-5 -1.2156924f-6 -2.636209f-5 -7.2302646f-5 -6.311326f-5; -1.0435003f-5 -0.00013801419 -6.745056f-6 0.0001445865 7.0911265f-5 0.00024453053 -3.7426475f-5 6.3528296f-6 5.8178695f-5 0.00013001185 0.00026119885 4.2134393f-6 -1.32479645f-5 -1.7618431f-5 -7.6702245f-6 0.00012499723 -4.482506f-6 0.0001243056 0.000104024286 4.6107787f-5 -5.404659f-5 7.387561f-5 -1.5642796f-5 0.00014659758 -5.516917f-5 0.0002692493 0.00011766474 -0.00018832754 2.3615114f-5 0.00013024562 -9.146804f-5 0.00012832283; -0.0001664507 0.000115821786 8.755299f-5 0.00015973348 -3.0989986f-7 5.5120363f-5 -8.533985f-5 3.96411f-6 -5.8031317f-5 7.52981f-5 1.2994279f-5 0.00015970384 2.3959543f-5 -6.860059f-5 0.00018097002 -6.0039783f-5 0.00013461626 8.6136875f-5 -2.8127126f-6 -8.6232656f-5 -6.390628f-5 -5.6884357f-5 8.4615815f-5 3.4034844f-8 2.2204717f-5 9.983521f-7 -3.9888022f-5 -4.6088182f-5 0.00014017992 0.00016782775 9.745305f-6 -5.4376455f-6; -0.000103420025 -0.00015326063 -5.689384f-5 -4.056099f-6 -0.00013428823 -3.0626517f-5 5.1325176f-5 4.9858834f-5 2.5978095f-5 0.000119979646 3.3721226f-5 -0.00017711661 -0.00010467443 -0.000100923455 3.7606103f-5 7.811333f-5 -3.642772f-5 6.1600294f-5 -6.7399346f-6 7.875044f-5 -3.2629025f-5 5.423027f-5 0.00019064159 -0.00011941775 0.00018358343 0.00016281662 2.9913846f-5 2.6013053f-5 -2.0906125f-5 0.00011435197 0.00010665977 -0.00010043734; 6.8359004f-5 -0.00017443472 0.00012973876 8.6580185f-5 -7.9860285f-5 0.00018832367 -5.8102938f-5 -0.00011390952 7.743367f-5 -2.9250232f-6 3.7939917f-5 8.690374f-5 -9.5469084f-5 5.5949837f-5 1.806186f-6 -0.00012438356 8.059372f-5 6.774232f-5 9.0895526f-5 2.9492254f-5 3.617842f-5 -4.34367f-5 7.763571f-5 -0.00013516928 8.00002f-6 1.216836f-5 -0.00012264235 -4.4648164f-5 -0.000116081406 7.68376f-5 -6.1661354f-5 2.2108681f-5; -1.1865214f-5 0.00015675936 8.6036285f-5 4.4035976f-5 -5.3906246f-5 5.516757f-5 1.03043785f-5 -8.710972f-5 7.481621f-5 -2.5138954f-5 6.5906606f-5 3.9811803f-5 -0.000106556065 -6.6387605f-5 0.00024589692 3.2192158f-5 0.00010873953 0.00011155544 3.7940365f-5 1.1804068f-5 -4.6677014f-5 -0.00019121316 -9.3723014f-5 9.3851784f-5 1.8772334f-5 0.00019432657 1.8482035f-5 0.00011079679 0.00011917444 0.00012993279 3.4503653f-6 -1.5420623f-5; -3.704744f-5 -0.00015318023 -3.0432564f-6 0.00011097727 -0.00012386966 0.00014674668 0.00020250645 -0.00019605379 -5.6689954f-5 4.6298195f-5 0.00020236454 4.645295f-5 -1.4086342f-5 0.00010211497 3.2606145f-5 4.5748908f-5 -0.000113579415 1.7600108f-8 9.414258f-6 -6.957801f-5 0.00027963886 0.00027284562 0.00010337606 -0.00015204205 3.6102563f-5 0.00021731829 -2.732565f-5 6.0744234f-5 -3.5176126f-5 9.933954f-5 -3.391736f-5 0.00012397242; 9.4999894f-5 0.00013590758 -7.614681f-5 9.05592f-6 -8.750048f-5 7.839406f-5 8.310292f-6 0.00012901596 -0.00014423665 5.2421656f-5 0.00015647076 4.6767964f-5 0.00030002897 -7.868248f-6 -5.0521838f-5 -0.000106865715 -2.8753075f-5 -0.00011812978 -0.000106012856 -8.909473f-5 -8.6303626f-5 1.9829173f-5 -0.00011012849 -0.00024661396 8.1676935f-6 -4.2043444f-5 -1.5533666f-5 8.371037f-5 -9.874054f-6 8.685345f-5 -8.9591424f-7 2.337088f-5; 8.967398f-5 -5.98477f-5 -6.780124f-5 -1.1241535f-5 1.39594795f-5 -1.4828242f-5 -9.1723996f-5 0.00013698127 3.848364f-5 6.238018f-5 -9.5268864f-5 -3.127089f-5 -0.00019130974 6.5327895f-6 -2.2156134f-6 -2.9274445f-6 -7.099175f-5 -4.995697f-6 -5.5000713f-5 -1.6268597f-5 0.000118754186 8.229096f-5 -8.3236655f-6 0.00018786591 0.00026284275 0.00016903377 2.9508577f-5 5.7748413f-5 -2.8930133f-5 -3.4134722f-5 -1.678499f-5 -1.2094168f-6; -5.5644337f-5 1.248415f-6 7.2946685f-5 0.00016337057 2.4909103f-5 9.980176f-6 -6.2931824f-5 6.7809735f-5 -3.953068f-5 0.00020974311 5.8316848f-5 -0.000109030785 -0.000118717 8.4669555f-5 0.0002554847 -0.000103272716 1.2342285f-5 -0.00018990343 4.462532f-5 -0.00018397823 8.873397f-5 5.3992964f-5 -2.565513f-5 7.189719f-5 -8.083829f-5 -0.00013463653 3.078179f-5 -8.489248f-5 6.618463f-5 -9.140173f-5 0.00019716982 4.2665186f-5; 1.7894186f-5 9.951251f-5 -0.00022652345 2.4371262f-5 -1.0501404f-5 -0.00012279698 4.4819768f-5 1.6719323f-5 5.578257f-5 -2.5937765f-5 3.3564385f-5 0.00021055301 -7.3059073f-6 0.00018076602 -0.00012698474 -0.00016414677 7.999354f-5 -5.9180053f-5 -8.233679f-5 -0.00021316891 -4.2421807f-6 2.2860406f-5 0.00012347529 6.0902246f-5 4.6044956f-5 0.00012673906 -5.886628f-5 9.056158f-5 -0.00016690508 2.3687666f-5 -9.5249816f-5 -3.4725563f-5; 9.9036615f-6 4.266064f-5 -8.926755f-5 -7.3777934f-5 7.964775f-5 -4.63457f-5 -6.2963845f-5 0.00014787732 0.00012440214 8.923515f-5 -0.00022309116 9.800046f-5 -3.9924424f-5 0.00014026299 -0.0001973683 -6.5235145f-5 6.919084f-5 -3.685689f-5 -2.8389739f-5 -5.2174397f-5 -2.1917862f-5 -0.00012359404 0.00015419844 -3.874702f-5 8.689616f-5 -6.2469575f-5 2.344643f-5 -0.00013963184 7.387035f-5 9.134711f-5 1.0660904f-5 -0.00012568593; 0.00016226653 -8.613679f-5 9.5251984f-5 -5.9334805f-5 -0.00011142038 7.859705f-5 -0.0001305037 2.4484094f-5 -0.00013697882 -0.00014483195 -8.762907f-5 -3.308779f-5 -4.8224356f-5 -1.6744836f-5 -0.00020409485 3.1735854f-5 7.006538f-5 -6.9520206f-6 0.00012131752 6.0922175f-5 8.79784f-5 -6.387425f-5 -0.00015030261 -2.5866044f-5 3.879399f-5 0.00014402177 -6.008101f-5 -9.7752214f-5 -1.4840659f-5 -0.00021683595 -9.254754f-5 0.00017094363; 5.3351614f-5 0.00013675194 -0.00015005391 -2.8826547f-5 -0.000104121405 0.00015857466 0.000100735524 -9.641567f-5 3.5810062f-5 9.098317f-6 5.466773f-5 5.4255644f-5 -0.00012866982 -5.4283235f-5 -5.4166656f-5 9.7950484f-5 -0.000103148675 -5.6322664f-5 -1.16595875f-5 5.6603163f-5 -0.00015547381 7.707558f-5 -2.5129793f-5 -0.00013249426 2.7681788f-5 1.3985818f-6 -0.00021175852 -2.1761607f-6 -0.00023326698 -4.2380685f-5 3.0583713f-5 2.4874596f-6; 7.686438f-6 -0.00015388553 1.4593235f-5 4.4160595f-5 4.2316886f-5 -4.0045514f-5 -0.00012152917 9.580553f-5 4.3491873f-5 -5.8291844f-5 -3.637507f-5 3.0249814f-5 3.2530337f-5 -3.10574f-5 -1.0712053f-5 6.0729573f-5 -0.00013928622 1.235192f-5 8.749917f-5 -8.120988f-5 -1.2792945f-5 0.00011610327 0.000103180166 2.5187315f-5 -5.0465693f-5 -7.03152f-6 0.00014949965 4.3072752f-5 0.00012693356 5.120175f-5 -0.00016282237 3.5181627f-5; -1.0814601f-5 -5.6367597f-5 -9.592442f-5 0.00010968434 -4.6937672f-5 -6.60911f-5 0.0001479206 -0.00012865293 0.00011713232 -7.880941f-5 -1.29473f-5 -0.00012329443 -0.00012463414 7.589704f-5 -0.00016300271 -0.000116803276 2.4401215f-5 0.00016312241 8.960119f-5 -2.9655645f-5 5.4221822f-5 8.477771f-5 -4.715129f-5 -4.2568623f-5 -1.382012f-5 1.9255383f-5 -3.894239f-5 4.4875378f-5 -3.6223784f-5 -0.00012794763 -9.757082f-5 -0.00016067358; 6.535245f-6 6.0731727f-5 5.972751f-5 -2.3981407f-5 7.0485265f-5 -5.1037064f-6 -8.9808695f-5 9.244652f-5 -8.33965f-5 9.401009f-5 -8.0982834f-5 0.00013773437 -0.00012932303 7.8536184f-5 -1.6590735f-5 -0.00017914479 -7.384166f-5 0.0001319244 0.00013023362 -0.000113845854 4.2717427f-5 0.00016750276 0.000113683134 -4.07679f-5 0.00016688414 -1.29355785f-5 0.0001519324 7.6383614f-5 3.0787178f-5 0.00020880192 0.00015119885 -0.0003799551; -5.3815183f-5 -5.4465523f-5 -4.5509925f-5 1.8878358f-6 -8.708736f-5 -0.0002200133 -1.0755602f-5 -0.000113712675 2.758018f-5 -0.00015663126 -8.64634f-5 4.5028835f-5 -0.00013412953 -4.7984562f-5 -2.6113801f-5 -2.2643146f-5 -1.4712208f-5 -5.0283863f-5 -3.1350697f-5 -9.1435766f-5 -0.00018814199 -2.5709794f-5 5.606631f-5 2.63413f-5 -0.00020061446 -4.1185438f-5 -0.00014062454 3.3503344f-5 -0.00014883534 -0.000248842 -8.879655f-7 -0.00019727284; -3.677941f-5 6.741057f-5 5.382375f-5 -3.9109844f-5 6.7433723f-7 -8.663384f-5 1.8767225f-5 -7.105166f-5 0.00010719942 -0.00010408406 6.1826504f-6 0.00011420873 2.5910602f-5 -0.00011162049 -0.00020723091 8.4487314f-5 -9.636674f-5 -2.7810662f-5 -0.000104589715 -3.816077f-5 -3.3383232f-5 -1.4240666f-5 -7.491116f-5 2.2300988f-5 -7.8271056f-5 0.00015514842 -8.355268f-5 5.9573573f-5 -0.00013575409 -4.5098026f-5 -0.00017153748 -8.272408f-5; -3.187956f-5 -9.48663f-5 -0.000116200536 2.0949544f-6 2.8387271f-8 -5.8261212f-5 -2.5603964f-5 3.5868914f-5 -2.0818936f-6 -1.7754137f-5 -0.00016871306 -8.555953f-5 3.9216957f-5 -0.00014498565 -2.373438f-5 -2.5858351f-5 5.2744937f-5 -1.2191269f-5 5.618706f-5 -0.00016089474 1.36617855f-5 5.452296f-5 -8.6742526f-5 -2.1708982f-5 -6.3753665f-5 -0.0001088276 0.00010957616 -0.00019576952 0.00014572231 -4.3745546f-5 -7.9865385f-5 -7.572275f-5; -0.00017414079 0.00015049466 -0.00026844314 9.8839366f-5 4.680974f-5 -5.2164025f-5 -6.437477f-6 6.0717677f-5 2.5306815f-6 3.5806588f-5 5.576822f-5 0.00013743587 -3.974948f-5 6.566738f-5 -9.246677f-5 9.0876965f-5 3.4388824f-5 2.3104994f-5 1.7859968f-5 0.00014613959 -0.00019879514 4.7336445f-5 -1.4266234f-5 9.7329365f-5 -0.00015483724 7.7426055f-5 7.7051496f-5 0.00010736486 -0.00010727461 -5.7538942f-5 -2.7882323f-5 -4.3442677f-5; -7.5371076f-6 -8.060278f-5 -1.9287165f-5 -0.00021606378 8.889532f-5 0.00013148722 -4.786636f-6 -4.015565f-5 3.792733f-5 9.5298696f-5 -5.909659f-5 0.00016181881 0.0001481606 -5.1817555f-5 0.00011800067 7.711823f-6 9.942067f-5 -1.4908005f-5 -0.00016013748 0.00010803087 -3.158838f-5 9.78929f-6 -0.00013227442 0.00018149153 6.248294f-5 3.5014655f-5 -0.00010635864 -0.0001172222 -1.4838785f-5 4.989376f-5 -0.0001430317 -0.0001554534; -3.49401f-5 -6.285717f-5 -5.0105416f-5 3.169906f-5 4.564326f-5 -2.5096026f-5 2.8748591f-5 -0.00016846073 0.00013847143 -2.1103467f-6 0.00012568368 0.00010566181 6.9188376f-5 -2.9588036f-6 -5.455226f-5 -0.00010037526 -0.000118103184 -2.0920786f-5 6.617306f-5 0.00014941019 2.1000815f-5 -5.972333f-5 2.9348657f-5 0.00026191078 -0.00015231942 0.0001430332 0.000118580836 -5.692839f-6 0.00010778382 5.4348925f-6 1.9580773f-5 -8.439353f-6], bias = Float32[0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0;;]), layer_4 = (weight = Float32[5.7296023f-5 0.00020799338 5.258563f-5 -0.00013476082 -2.6059884f-5 2.9554149f-5 -1.255778f-5 -0.000107924134 0.00010422073 8.485688f-5 0.00010283731 6.4092616f-5 -0.00012903161 -0.00020034073 -0.00016557163 0.00021330794 2.7577758f-5 0.00017107568 -2.1516616f-5 0.00010218546 8.943623f-5 0.00010761139 3.8304373f-5 -4.9933016f-5 0.00020534122 1.23706495f-5 9.234372f-5 2.6493164f-5 -5.9380778f-5 -0.00013183278 9.654583f-5 -5.492985f-5; 5.914912f-5 3.019073f-5 -5.2947693f-5 -6.877287f-5 -0.00018539107 -3.1777243f-5 -7.181906f-5 6.987992f-5 5.6603305f-5 -1.825946f-5 7.0247304f-5 -3.07217f-5 6.923796f-5 8.891129f-5 -1.4361465f-6 -9.8387696f-5 -4.1933825f-5 7.8174155f-5 -1.1916959f-6 8.476098f-5 -5.7514826f-5 -6.132414f-6 -2.937686f-5 8.828812f-6 -0.00010912385 5.634907f-5 0.00029423993 2.3788169f-5 5.096057f-5 -9.554452f-5 1.2805749f-5 -6.360892f-5], bias = Float32[0.0; 0.0;;])), (layer_1 = NamedTuple(), layer_2 = NamedTuple(), layer_3 = NamedTuple(), layer_4 = NamedTuple()))
```


Similar to most DL frameworks, Lux defaults to using `Float32`, however, in this case we need Float64


```julia
const params = ComponentArray{Float64}(ps)
```


```
ComponentVector{Float64}(layer_1 = Float64[], layer_2 = (weight = [0.00019216346845496446; -5.627998325508088e-5; 3.741179534699768e-5; -0.00011563731823116541; 0.0002394258335698396; 1.9643950508907437e-5; 4.478078699321486e-5; -8.453147165710106e-5; -2.2821513994131237e-5; -0.00012508204963523895; -0.00012633349979296327; -0.00015608784451615065; 9.096035682887305e-6; 6.4745472627691925e-6; 0.00024411617778241634; -0.0003013609675690532; 0.00011070244363509119; -0.0001629011530894786; 9.613269867259078e-6; -0.00013228588795755059; 8.73207227414241e-6; 0.0001290276413783431; 5.561559373745695e-5; -5.5557844461873174e-5; -0.00011110768537037075; 0.00010022128844866529; 0.00010480004857527092; 1.6765412510721944e-5; -3.2223852031165734e-5; -5.855280323885381e-5; -2.4507033231202513e-5; -1.2297272405703552e-5;;], bias = [0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0;;]), layer_3 = (weight = [0.000252541562076658 2.8349422791507095e-5 7.996542990440503e-6 0.00020763267821166664 -0.0001403350179316476 0.00017866848793346435 0.0001960701192729175 -1.7988200852414593e-5 -9.116277942666784e-5 2.2492336938739754e-5 -8.630826050648466e-5 -9.367267921334133e-5 -7.898460899014026e-5 -1.831959161791019e-5 -2.8005519197904505e-5 -7.534016185672954e-5 0.00010996047058142722 4.9510050303069875e-5 3.153329453198239e-5 -2.2808970243204385e-5 4.802371677214978e-6 0.00011180084402440116 9.94984366116114e-5 0.00019508392142597586 4.583087138598785e-5 0.00015706371050328016 0.0001369509700452909 -4.0471491956850514e-5 -0.00011033080954803154 5.730532211600803e-5 -0.00011255947174504399 5.825223070132779e-6; -3.2019841455621645e-5 -8.857014472596347e-5 -2.829974800988566e-5 0.00026288058143109083 -0.0001323223114013672 5.068802056484856e-5 2.2659209207631648e-5 -0.0001318967988481745 -0.00011617371637839824 0.00012211973080411553 3.141470006085001e-5 -6.894361376907909e-6 4.3119245674461126e-5 -0.0002002731926040724 -0.00018948402430396527 -3.44054399192828e-7 2.392193528066855e-5 -0.00010272020153934136 -7.530758739449084e-5 0.00021756230853497982 -6.978759483899921e-5 0.00012473834794946015 5.0670896598603576e-5 -0.00015785108553245664 3.0604973289882764e-5 -4.245061791152693e-5 -1.926010190800298e-5 -6.403648148989305e-5 2.4505801775376312e-5 4.06463623221498e-5 0.00010034534352598712 -3.119788379990496e-5; -3.4020786188193597e-6 6.984162610024214e-5 9.186414899886586e-6 -5.602050805464387e-5 9.071261592907831e-5 8.222214091802016e-5 0.0001921248622238636 6.142533038655529e-6 -0.00011934024951187894 1.594923196535092e-5 -5.259447334537981e-6 4.441425699042156e-5 7.333052508329274e-6 -7.133343751775101e-5 0.00012400593550410122 9.6413008577656e-5 -0.00015635014278814197 2.4931574444053695e-5 -9.083903569262475e-5 -0.00014552430366165936 -1.5227667972794734e-5 0.0002238353918073699 1.5084545339050237e-5 -0.00015616010932717472 -7.143348193494603e-5 -6.859748827992007e-5 -4.311026350478642e-5 3.7998172047082335e-5 -3.151589771732688e-5 0.0002137806441169232 4.2641491745598614e-5 3.040424780920148e-5; -1.2727150533464737e-5 9.754239727044478e-5 -3.7758323742309585e-5 2.2399915906134993e-5 2.0201405277475715e-5 -0.00011069279571529478 -8.902137778932229e-5 -9.111683175433427e-5 9.586942906025797e-5 -2.915311233664397e-5 -5.0601462135091424e-5 -8.166010957211256e-5 0.0002588176284916699 0.0001593798224348575 1.4563095646735746e-5 5.0533788453321904e-5 -0.00014524883590638638 6.325429421849549e-5 -5.719489126931876e-5 -5.332608998287469e-5 -1.007288483378943e-5 0.00012619524204637855 0.00011913050548173487 2.4398783352808096e-5 -0.00016953151498455554 5.272306589176878e-5 0.00010967212438117713 -4.07305960834492e-5 -1.1817746781161986e-6 -0.00016051321290433407 -0.00015063027967698872 -2.1452920918818563e-5; 0.0001668018230702728 -7.478008046746254e-5 6.93725305609405e-5 0.0001463237713323906 -0.00014732411364093423 7.531337905675173e-5 3.4901913750218228e-6 -7.941472722450271e-5 0.0001375566062051803 3.526295404299162e-5 6.015210601617582e-5 0.0002214982087025419 -0.00011971070489380509 6.149661203380674e-5 -1.929389327415265e-5 8.164213068084791e-5 -8.349274867214262e-5 8.285853255074471e-5 0.00018192024435847998 -9.977062291000038e-5 -1.496245477028424e-5 2.636072713357862e-5 0.00017085920262616128 -0.00013308691268321127 1.3127787497069221e-5 2.4531452709197765e-6 4.003444337286055e-5 -0.00014127665781416 0.0001451344578526914 -6.163696525618434e-5 4.5010085159447044e-5 -0.00014474066847469658; 4.5719129957433324e-6 -4.645015360438265e-5 -4.0816350519889966e-5 1.9841667381115258e-5 0.00015027858898974955 0.00014983989240135998 -0.00010342109453631565 8.69736832100898e-5 6.759452662663534e-5 -1.2069415788573679e-5 -1.5414545487146825e-5 -2.8830441806348972e-5 0.00010362627654103562 0.00012742193939629942 -5.891436376259662e-5 -1.4266293874243274e-5 -6.460589793277904e-5 1.610604886082001e-5 -0.00014269683742895722 -6.156627205200493e-5 -0.00014757773897144943 4.707172774942592e-5 6.400093843694776e-5 4.9252098506258335e-6 -6.83366961311549e-5 -6.7970190684718546e-6 0.00019620204693637788 -0.00015481296577490866 4.78707006550394e-5 -0.00011845610424643382 -2.5858813387458213e-5 -5.171980592422187e-5; -0.00013089591811876744 -4.926055407850072e-5 0.0001343116455245763 1.1359599739080295e-5 -2.4891596694942564e-5 -0.00041591166518628597 -0.00011975115194218233 5.240187601884827e-5 -3.637021654867567e-5 -4.559607623377815e-5 7.097602792782709e-5 -0.00012115880963392556 1.2191588893983862e-6 -0.00014398015628103167 -4.3003288737963885e-5 0.00013168188161216676 7.446223753504455e-5 -0.00021483577438630164 3.490278322715312e-5 0.00010062575165648013 -5.753915320383385e-5 0.00017828545242082328 -8.419575169682503e-5 -2.366658372920938e-5 0.0001269652711926028 -4.869533768214751e-6 -0.00025381604791618884 0.0002824579132720828 -0.00015531260578427464 0.0001770270464476198 1.2492908354033716e-5 0.00011154168896609917; 3.0411853003897704e-5 -7.226532034110278e-5 -8.745269951759838e-6 -2.616992060211487e-5 4.595998689183034e-5 8.232030813815072e-5 0.00010839900642167777 3.605055098887533e-5 -0.00028709459002129734 -2.011030119319912e-6 -6.353204662445933e-5 6.6219390646438114e-6 3.1606381526216865e-5 7.498541435779771e-6 4.250817437423393e-5 0.00020839240460190922 5.376200351747684e-5 -9.701640374260023e-5 -4.9203415983356535e-5 0.00011081788397859782 -8.261058610514738e-6 6.707820284646004e-5 6.639710045419633e-5 -5.011402026866563e-5 -1.964970761036966e-5 0.00010679702972993255 -0.00018598853785078973 0.00013603070692624897 4.7086716222111136e-5 -0.00010036240564659238 3.488344373181462e-5 0.00023164178128354251; 0.0001912005100166425 -4.2131236114073545e-5 9.423293522559106e-5 1.257985695701791e-5 -2.395505362073891e-5 -3.8128378946566954e-5 -6.385354936355725e-5 -0.00011913420894416049 0.00014817305782344192 2.907461384893395e-5 -9.22765102586709e-5 1.5470277503482066e-5 -0.00010510714491829276 3.665711119538173e-5 4.872085264651105e-5 0.0002208738587796688 2.4790451789158396e-5 -0.00013380502059590071 0.00010336005652789026 -1.0366744390921667e-5 9.579196193953976e-5 -7.73571155150421e-5 3.896496309607755e-6 5.965784293948673e-5 -0.0001552589237689972 0.0001889527338789776 -2.682811646081973e-5 1.4435633602261078e-5 1.6925501768128015e-5 -6.584015500266105e-5 0.00011068777530454099 5.259602767182514e-5; 4.770573696077918e-7 -4.0054190321825445e-5 -0.00014645603368990123 0.00012153417628724128 2.6256822820869274e-5 7.807985093677416e-5 -5.1914055802626535e-5 0.00012430257629603148 5.44061949767638e-5 0.00013841985492035747 -5.6078479246934876e-5 -1.6617424989817664e-5 -6.383031723089516e-5 -5.8806770539376885e-5 -0.00016769727517385036 -0.0001044460732373409 -0.00012062682799296454 1.2766825420840178e-5 -6.22099541942589e-5 3.2675452530384064e-5 6.759602547390386e-5 -0.00011753658327506855 -0.00010860674956347793 1.8753660697257146e-5 -0.00015584180073346943 6.767742161173373e-5 2.0517398297670297e-5 4.78163237858098e-5 -1.2156923503425787e-6 -2.6362089556641877e-5 -7.230264600366354e-5 -6.311325705610216e-5; -1.0435002877784427e-5 -0.00013801419117953628 -6.74505599818076e-6 0.00014458650548476726 7.091126462910324e-5 0.00024453052901662886 -3.742647459148429e-5 6.3528295868309215e-6 5.817869532620534e-5 0.00013001184561289847 0.00026119884569197893 4.21343929701834e-6 -1.3247964488982689e-5 -1.761843122949358e-5 -7.670224476896692e-6 0.0001249972265213728 -4.4825060285802465e-6 0.00012430560309439898 0.00010402428597444668 4.6107787056826055e-5 -5.4046591685619205e-5 7.387561345240101e-5 -1.5642795915482566e-5 0.00014659758016932756 -5.516917008208111e-5 0.00026924931444227695 0.00011766474199248478 -0.00018832753994502127 2.3615113605046645e-5 0.00013024562213104218 -9.14680422283709e-5 0.00012832283391617239; -0.00016645069990772754 0.0001158217855845578 8.755298767937347e-5 0.0001597334776306525 -3.098998604400549e-7 5.512036295840517e-5 -8.533985237590969e-5 3.9641099647269584e-6 -5.803131716675125e-5 7.529809954576194e-5 1.2994279131817166e-5 0.0001597038353793323 2.395954288658686e-5 -6.860058783786371e-5 0.00018097001884598285 -6.0039783420506865e-5 0.0001346162607660517 8.613687532488257e-5 -2.812712637023651e-6 -8.623265603091568e-5 -6.390627822838724e-5 -5.688435703632422e-5 8.461581455776468e-5 3.403484427622061e-8 2.220471651526168e-5 9.983521067624679e-7 -3.9888022001832724e-5 -4.608818198903464e-5 0.00014017992361914366 0.0001678277476457879 9.74530485109426e-6 -5.437645540951053e-6; -0.00010342002497054636 -0.0001532606256660074 -5.6893841247074306e-5 -4.056098987348378e-6 -0.00013428823149297386 -3.062651740037836e-5 5.13251761731226e-5 4.985883424524218e-5 2.5978095436585136e-5 0.00011997964611509815 3.372122591827065e-5 -0.0001771166134858504 -0.00010467442916706204 -0.00010092345473822206 3.7606103433063254e-5 7.811332761775702e-5 -3.642771844170056e-5 6.160029442980886e-5 -6.739934633515077e-6 7.875043957028538e-5 -3.262902464484796e-5 5.423026959761046e-5 0.00019064158550463617 -0.00011941775301238522 0.0001835834264056757 0.00016281662101391703 2.9913846447016113e-5 2.601305277494248e-5 -2.0906125428155065e-5 0.00011435196938691661 0.00010665976878954098 -0.00010043734073406085; 6.835900421719998e-5 -0.00017443472461309284 0.00012973876437172294 8.658018487039953e-5 -7.986028504092246e-5 0.00018832366913557053 -5.8102938055526465e-5 -0.00011390951840439811 7.743367314105853e-5 -2.925023181887809e-6 3.7939917092444375e-5 8.690373942954466e-5 -9.546908404445276e-5 5.5949836678337306e-5 1.806185991881648e-6 -0.00012438355770427734 8.0593723396305e-5 6.774232315365225e-5 9.089552622754127e-5 2.949225381598808e-5 3.617841866798699e-5 -4.3436699343146756e-5 7.763571193208918e-5 -0.00013516927720047534 8.00001998868538e-6 1.2168359717179555e-5 -0.0001226423482876271 -4.464816447580233e-5 -0.0001160814063041471 7.683759758947417e-5 -6.166135426610708e-5 2.2108681150712073e-5; -1.1865214219142217e-5 0.00015675935719627887 8.603628521086648e-5 4.403597631608136e-5 -5.390624573919922e-5 5.516756937140599e-5 1.0304378520231694e-5 -8.710972178960219e-5 7.481621287297457e-5 -2.513895378797315e-5 6.590660632355139e-5 3.9811802707845345e-5 -0.00010655606456566602 -6.638760532950982e-5 0.00024589692475274205 3.219215795979835e-5 0.00010873952851397917 0.00011155544052598998 3.794036456383765e-5 1.1804067980847321e-5 -4.667701432481408e-5 -0.00019121315563097596 -9.372301428811625e-5 9.385178418597206e-5 1.8772334442473948e-5 0.0001943265669979155 1.848203464760445e-5 0.0001107967909774743 0.00011917443771380931 0.00012993278505746275 3.4503652841522126e-6 -1.542062273074407e-5; -3.704744085553102e-5 -0.00015318022633437067 -3.0432563562499126e-6 0.00011097727110609412 -0.00012386965681798756 0.0001467466790927574 0.0002025064459303394 -0.00019605379202403128 -5.668995436280966e-5 4.629819522961043e-5 0.00020236453565303236 4.64529512100853e-5 -1.4086342162045185e-5 0.00010211497283307835 3.260614539613016e-5 4.574890772346407e-5 -0.00011357941548340023 1.7600108037640894e-8 9.414257874595933e-6 -6.957801087992266e-5 0.00027963885804638267 0.0002728456165641546 0.00010337606363464147 -0.00015204204828478396 3.610256317188032e-5 0.00021731828746851534 -2.73256500804564e-5 6.074423436075449e-5 -3.5176126402802765e-5 9.933953697327524e-5 -3.391736026969738e-5 0.0001239724224433303; 9.499989391770214e-5 0.00013590758317150176 -7.614681089762598e-5 9.055919690581504e-6 -8.750047709327191e-5 7.839406316634268e-5 8.310292287205812e-6 0.00012901595619041473 -0.00014423664833884686 5.242165570962243e-5 0.0001564707636134699 4.6767963794991374e-5 0.00030002897256053984 -7.86824784881901e-6 -5.052183769294061e-5 -0.00010686571476981044 -2.8753074730047956e-5 -0.0001181297775474377 -0.00010601285612210631 -8.909472671803087e-5 -8.630362572148442e-5 1.98291727429023e-5 -0.00011012848699465394 -0.0002466139558237046 8.167693522409536e-6 -4.204344440950081e-5 -1.5533665646216832e-5 8.371037256438285e-5 -9.874053830571938e-6 8.685344801051542e-5 -8.959142405728926e-7 2.3370879716821946e-5; 8.967398025561124e-5 -5.984770177747123e-5 -6.78012365824543e-5 -1.1241534593864344e-5 1.3959479474578984e-5 -1.482824154663831e-5 -9.172399586532265e-5 0.00013698126713279635 3.848363849101588e-5 6.238018249860033e-5 -9.526886424282566e-5 -3.1270890758605674e-5 -0.00019130973669234663 6.532789484481327e-6 -2.2156134491524426e-6 -2.927444484157604e-6 -7.099175127223134e-5 -4.995697054255288e-6 -5.500071347341873e-5 -1.6268597391899675e-5 0.00011875418567797169 8.22909569251351e-5 -8.32366549730068e-6 0.0001878659095382318 0.0002628427464514971 0.00016903376672416925 2.95085774268955e-5 5.774841338279657e-5 -2.8930133339599706e-5 -3.41347222274635e-5 -1.678499029367231e-5 -1.2094168369003455e-6; -5.564433740801178e-5 1.2484149465308292e-6 7.29466846678406e-5 0.00016337056877091527 2.490910264896229e-5 9.980176400858909e-6 -6.293182377703488e-5 6.780973490094766e-5 -3.953068153350614e-5 0.00020974311337340623 5.831684757140465e-5 -0.00010903078509727493 -0.0001187169982586056 8.466955478070304e-5 0.0002554846869315952 -0.00010327271593268961 1.2342285117483698e-5 -0.00018990342505276203 4.46253216068726e-5 -0.00018397823441773653 8.873397018760443e-5 5.3992964240023866e-5 -2.5655130230006762e-5 7.189719326561317e-5 -8.083829015959054e-5 -0.00013463653158396482 3.078178997384384e-5 -8.4892482846044e-5 6.618462793994695e-5 -9.140172915067524e-5 0.00019716982205864042 4.26651859015692e-5; 1.7894186385092326e-5 9.951250831363723e-5 -0.00022652345069218427 2.4371262043132447e-5 -1.0501404176466167e-5 -0.00012279697693884373 4.481976793613285e-5 1.67193229572149e-5 5.578256968874484e-5 -2.5937764803529717e-5 3.356438537593931e-5 0.00021055301476735622 -7.3059072747128084e-6 0.00018076601554639637 -0.00012698474165517837 -0.00016414676792919636 7.999353692866862e-5 -5.9180052630836144e-5 -8.233678818214685e-5 -0.00021316891070455313 -4.242180693836417e-6 2.286040580656845e-5 0.0001234752853633836 6.090224633226171e-5 4.6044955524848774e-5 0.00012673906167037785 -5.886628059670329e-5 9.056158160092309e-5 -0.0001669050834607333 2.3687665816396475e-5 -9.524981578579172e-5 -3.472556272754446e-5; 9.903661521093454e-6 4.266063842806034e-5 -8.926755253924057e-5 -7.37779337214306e-5 7.964774704305455e-5 -4.634569995687343e-5 -6.29638452664949e-5 0.00014787731925025582 0.00012440214050002396 8.923515269998461e-5 -0.00022309116320684552 9.800046245800331e-5 -3.992442361777648e-5 0.00014026298595126718 -0.00019736829563044012 -6.523514457512647e-5 6.919084262335673e-5 -3.685689080157317e-5 -2.8389738872647285e-5 -5.217439684201963e-5 -2.19178618863225e-5 -0.0001235940435435623 0.00015419843839481473 -3.874702088069171e-5 8.689615788171068e-5 -6.246957491384819e-5 2.344642962270882e-5 -0.00013963184028398246 7.387035293504596e-5 9.134710853686556e-5 1.0660904081305489e-5 -0.0001256859250133857; 0.0001622665295144543 -8.61367880133912e-5 9.525198402116075e-5 -5.933480497333221e-5 -0.00011142037692479789 7.859704783186316e-5 -0.00013050370034761727 2.4484093955834396e-5 -0.00013697882241103798 -0.00014483195263892412 -8.762907236814499e-5 -3.308778832433745e-5 -4.82243558508344e-5 -1.6744836102589034e-5 -0.00020409484568517655 3.173585355398245e-5 7.006538362475112e-5 -6.952020612516208e-6 0.00012131752009736374 6.092217518016696e-5 8.797839836915955e-5 -6.38742494629696e-5 -0.00015030261420179158 -2.5866043870337307e-5 3.879399082507007e-5 0.0001440217747585848 -6.008100899634883e-5 -9.775221406016499e-5 -1.4840658877801616e-5 -0.0002168359496863559 -9.254753967979923e-5 0.00017094363283831626; 5.335161404218525e-5 0.00013675194350071251 -0.00015005390741862357 -2.882654735003598e-5 -0.0001041214054566808 0.00015857466496527195 0.00010073552402900532 -9.641567157814279e-5 3.581006239983253e-5 9.098316695599351e-6 5.466772927320562e-5 5.4255644499789923e-5 -0.0001286698243347928 -5.428323493106291e-5 -5.416665590018965e-5 9.795048390515149e-5 -0.00010314867540728301 -5.632266402244568e-5 -1.1659587471513078e-5 5.660316310240887e-5 -0.00015547381190117449 7.707557961111888e-5 -2.5129793357336894e-5 -0.00013249425683170557 2.7681788196787238e-5 1.3985818441142328e-6 -0.00021175852452870458 -2.1761607058579102e-6 -0.0002332669828319922 -4.238068504491821e-5 3.058371294173412e-5 2.4874595965229673e-6; 7.686438038945198e-6 -0.00015388552856165916 1.45932353916578e-5 4.4160595280118287e-5 4.231688581057824e-5 -4.004551374237053e-5 -0.00012152917042840272 9.580553160049021e-5 4.349187292973511e-5 -5.829184374306351e-5 -3.637506961240433e-5 3.0249813789851032e-5 3.253033719374798e-5 -3.1057399610290304e-5 -1.0712053153838497e-5 6.072957330616191e-5 -0.00013928621774539351 1.235192030435428e-5 8.749916742090136e-5 -8.12098805909045e-5 -1.2792945199180394e-5 0.00011610327055677772 0.0001031801657518372 2.5187315259245224e-5 -5.046569276601076e-5 -7.03151999914553e-6 0.00014949965407140553 4.3072752305306494e-5 0.0001269335625693202 5.12017504661344e-5 -0.00016282236902043223 3.518162702675909e-5; -1.08146014099475e-5 -5.636759669869207e-5 -9.592442074790597e-5 0.00010968434071401134 -4.6937671868363395e-5 -6.609110278077424e-5 0.00014792059664614499 -0.00012865292956121266 0.00011713231651810929 -7.880941120674834e-5 -1.2947300092491787e-5 -0.00012329443416092545 -0.00012463414168450981 7.58970418246463e-5 -0.00016300271090585738 -0.00011680327588692307 2.4401215341640636e-5 0.00016312241496052593 8.960119157563895e-5 -2.9655644539161585e-5 5.422182221082039e-5 8.477771189063787e-5 -4.7151290345937014e-5 -4.256862303009257e-5 -1.3820120329910424e-5 1.9255383449490182e-5 -3.8942391256568953e-5 4.487537808017805e-5 -3.622378426371142e-5 -0.00012794762733392417 -9.757081716088578e-5 -0.00016067357501015067; 6.535245120176114e-6 6.073172698961571e-5 5.9727510233642533e-5 -2.398140713921748e-5 7.048526458675042e-5 -5.103706371301087e-6 -8.980869461083785e-5 9.24465202842839e-5 -8.33965023048222e-5 9.401008719578385e-5 -8.098283433355391e-5 0.00013773437240161002 -0.00012932303070556372 7.853618444642052e-5 -1.6590734958299436e-5 -0.00017914478667080402 -7.384165655821562e-5 0.00013192440383136272 0.00013023361680097878 -0.00011384585377527401 4.271742727723904e-5 0.00016750275972299278 0.00011368313425919041 -4.076789991813712e-5 0.00016688414325471967 -1.2935578524775337e-5 0.00015193239960353822 7.63836142141372e-5 3.0787177820457146e-5 0.00020880192460026592 0.00015119885210879147 -0.00037995510501787066; -5.381518349167891e-5 -5.446552313514985e-5 -4.550992525764741e-5 1.887835765046475e-6 -8.70873627718538e-5 -0.00022001330216880888 -1.0755601579148788e-5 -0.000113712674647104 2.7580179448705167e-5 -0.00015663125668652356 -8.646339847473428e-5 4.5028835302218795e-5 -0.0001341295283054933 -4.7984562115743756e-5 -2.6113801141036674e-5 -2.2643145712208934e-5 -1.471220821258612e-5 -5.028386294725351e-5 -3.1350697099696845e-5 -9.143576608039439e-5 -0.00018814198847394437 -2.5709794499562122e-5 5.6066310207825154e-5 2.634130032674875e-5 -0.00020061446412000805 -4.118543802178465e-5 -0.00014062454283703119 3.350334372953512e-5 -0.00014883534458931535 -0.00024884199956431985 -8.879654842530726e-7 -0.00019727283506654203; -3.677940912893973e-5 6.741056859027594e-5 5.382375093176961e-5 -3.910984378308058e-5 6.743372296114103e-7 -8.663383778184652e-5 1.8767224901239388e-5 -7.105166150722653e-5 0.00010719941928982735 -0.0001040840579662472 6.182650395203382e-6 0.00011420872760936618 2.5910601834766567e-5 -0.00011162048758706078 -0.00020723091438412666 8.448731387034059e-5 -9.636674076318741e-5 -2.781066177703906e-5 -0.0001045897151925601 -3.81607715098653e-5 -3.338323222124018e-5 -1.4240666132536717e-5 -7.491115684388205e-5 2.2300988348433748e-5 -7.827105582691729e-5 0.00015514841652475297 -8.355268073501065e-5 5.9573572798399255e-5 -0.00013575408956967294 -4.509802602115087e-5 -0.00017153748194687068 -8.272408012999222e-5; -3.187956099282019e-5 -9.486630005994812e-5 -0.00011620053555816412 2.0949544250470353e-6 2.8387271200358555e-8 -5.82612119615078e-5 -2.560396387707442e-5 3.5868913982994854e-5 -2.081893626382225e-6 -1.775413693394512e-5 -0.00016871305706445128 -8.555952808819711e-5 3.921695679309778e-5 -0.00014498564996756613 -2.3734379283268936e-5 -2.5858351364149712e-5 5.274493742035702e-5 -1.2191268979222514e-5 5.6187058362411335e-5 -0.0001608947350177914 1.3661785487784073e-5 5.4522959544556215e-5 -8.67425260366872e-5 -2.1708981876145117e-5 -6.375366501742974e-5 -0.00010882759670494124 0.00010957616177620366 -0.00019576952036004514 0.00014572231157217175 -4.374554555397481e-5 -7.986538548721e-5 -7.572275353595614e-5; -0.00017414079047739506 0.00015049465582706034 -0.00026844313833862543 9.883936581900343e-5 4.680973870563321e-5 -5.2164024964440614e-5 -6.43747716821963e-6 6.071767711546272e-5 2.530681513235322e-6 3.580658813007176e-5 5.576822150032967e-5 0.00013743586896453053 -3.974948049290106e-5 6.566738011315465e-5 -9.246676927432418e-5 9.087696525966749e-5 3.4388824133202434e-5 2.310499439772684e-5 1.785996755643282e-5 0.00014613958774134517 -0.00019879514002241194 4.7336445277323946e-5 -1.4266233847592957e-5 9.73293645074591e-5 -0.00015483723836950958 7.742605521343648e-5 7.705149619141594e-5 0.00010736486001405865 -0.00010727460903581232 -5.753894220106304e-5 -2.788232268358115e-5 -4.344267654232681e-5; -7.53710764911375e-6 -8.060278196353465e-5 -1.9287164832348935e-5 -0.00021606378140859306 8.889532182365656e-5 0.0001314872206421569 -4.786636054632254e-6 -4.0155649912776425e-5 3.792732968577184e-5 9.529869566904381e-5 -5.9096590121043846e-5 0.00016181881073862314 0.00014816060138400644 -5.181755477678962e-5 0.00011800067295553163 7.711822945566382e-6 9.9420671176631e-5 -1.4908005141478498e-5 -0.00016013748245313764 0.00010803087207023054 -3.1588380807079375e-5 9.789289833861403e-6 -0.00013227442104835063 0.00018149153038393706 6.248294084798545e-5 3.501465471345e-5 -0.00010635863873176277 -0.0001172221964225173 -1.4838785318715964e-5 4.989375884179026e-5 -0.0001430317061021924 -0.0001554533955641091; -3.494010161375627e-5 -6.285717245191336e-5 -5.0105416448786855e-5 3.1699059036327526e-5 4.564326081890613e-5 -2.509602563804947e-5 2.8748590921168216e-5 -0.0001684607268543914 0.0001384714269079268 -2.1103467133798404e-6 0.00012568368401844054 0.0001056618129950948 6.918837607372552e-5 -2.9588036341010593e-6 -5.455225982586853e-5 -0.00010037526226369664 -0.00011810318392235786 -2.0920786482747644e-5 6.61730591673404e-5 0.00014941018889658153 2.1000814740546048e-5 -5.9723330195993185e-5 2.9348657335503958e-5 0.00026191078359261155 -0.00015231942234095186 0.00014303320494946092 0.00011858083598781377 -5.692838840332115e-6 0.00010778381692944095 5.434892500488786e-6 1.9580773368943483e-5 -8.439353223366197e-6], bias = [0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0;;]), layer_4 = (weight = [5.72960234421771e-5 0.00020799337653443217 5.258563032839447e-5 -0.0001347608194919303 -2.605988447612617e-5 2.9554148568422534e-5 -1.2557779882627074e-5 -0.00010792413377203047 0.00010422072955407202 8.48568815854378e-5 0.00010283730807714164 6.409261550288647e-5 -0.00012903161405120045 -0.00020034072804264724 -0.00016557163326069713 0.00021330793970264494 2.7577758373809047e-5 0.00017107567691709846 -2.151661647076253e-5 0.00010218546231044456 8.943623106461018e-5 0.00010761139128590003 3.830437344731763e-5 -4.9933016271097586e-5 0.00020534121722448617 1.237064952874789e-5 9.234371827915311e-5 2.6493164114071988e-5 -5.938077811151743e-5 -0.00013183278497308493 9.654583118390292e-5 -5.492984928423539e-5; 5.914911889703944e-5 3.0190729376045056e-5 -5.294769289321266e-5 -6.877286796225235e-5 -0.00018539106531534344 -3.1777242838870734e-5 -7.181905675679445e-5 6.987991946516559e-5 5.660330498358235e-5 -1.8259459466207772e-5 7.024730439297855e-5 -3.072170147788711e-5 6.923796172486618e-5 8.891129255061969e-5 -1.4361464764078846e-6 -9.838769619818777e-5 -4.193382483208552e-5 7.81741546234116e-5 -1.1916959010704886e-6 8.476097718812525e-5 -5.7514826039550826e-5 -6.132414000603603e-6 -2.9376860766205937e-5 8.82881158759119e-6 -0.00010912385187111795 5.634906847262755e-5 0.00029423992964439094 2.378816861892119e-5 5.0960570661118254e-5 -9.554452117299661e-5 1.2805749065591954e-5 -6.360891711665317e-5], bias = [0.0; 0.0;;]))
```


Now we define a system of odes which describes motion of point like particle with Newtonian physics, uses


$$
u[1] = \chi
$$


$$
u[2] = \phi
$$


where, $p$, $M$, and $e$ are constants


```julia
function ODE_model(u, nn_params, t)
    χ, ϕ = u
    p, M, e = ode_model_params

    # In this example we know that `st` is am empty NamedTuple hence we can safely ignore
    # it, however, in general, we should use `st` to store the state of the neural network.
    y = 1 .+ first(nn([first(u)], nn_params, st))

    numer = (1 + e * cos(χ))^2
    denom = M * (p^(3 / 2))

    χ̇ = (numer / denom) * y[1]
    ϕ̇ = (numer / denom) * y[2]

    return [χ̇, ϕ̇]
end
```


```
ODE_model (generic function with 1 method)
```


Let us now simulate the neural network model and plot the results. We'll use the untrained neural network parameters to simulate the model.


```julia
prob_nn = ODEProblem(ODE_model, u0, tspan, params)
soln_nn = Array(solve(prob_nn, RK4(); u0, p=params, saveat=tsteps, dt, adaptive=false))
waveform_nn = first(compute_waveform(dt_data, soln_nn, mass_ratio, ode_model_params))

fig = with_theme(theme_web()) do
    fig = Figure()
    ax = CairoMakie.Axis(fig[1, 1]; xlabel="Time", ylabel="Waveform")

    l1 = lines!(ax, tsteps, waveform; linewidth=2, alpha=0.75)
    s1 = scatter!(ax, tsteps, waveform; markershape=:circle, markeralpha=0.25, alpha=0.5)

    l2 = lines!(ax, tsteps, waveform_nn; linewidth=2, alpha=0.75)
    s2 = scatter!(ax, tsteps, waveform_nn; markershape=:circle, markeralpha=0.25, alpha=0.5)

    axislegend(ax, [[l1, s1], [l2, s2]],
        ["Waveform Data", "Waveform Neural Net (Untrained)"]; position=:lb)

    return fig
end
```


![](1_GravitationalWaveForm-35.png)


<a id='Setting-Up-for-Training-the-Neural-Network'></a>

## Setting Up for Training the Neural Network


Next, we define the objective (loss) function to be minimized when training the neural differential equations.


```julia
function loss(θ)
    pred = Array(solve(prob_nn, RK4(); u0, p=θ, saveat=tsteps, dt, adaptive=false))
    pred_waveform = first(compute_waveform(dt_data, pred, mass_ratio, ode_model_params))
    loss = sum(abs2, waveform .- pred_waveform)
    return loss, pred_waveform
end
```


```
loss (generic function with 1 method)
```


Warmup the loss function


```julia
loss(params)
```


```
(0.18855607626667814, [-0.024277786243506183, -0.023492034742483736, -0.022706283241461442, -0.021378575307341042, -0.019481067536102747, -0.016973337607444097, -0.013802300805436625, -0.009899229915273167, -0.005182016842158339, 0.0004451811719422424, 0.00708268568778254, 0.014814165972679262, 0.023658512036614482, 0.03343995850831692, 0.043505993533766704, 0.05205986164522735, 0.05474892080192896, 0.04237710537048027, 0.0013530172102782852, -0.06715715173597862, -0.11038103991536719, -0.07549869393954742, -0.006282796413967447, 0.03883036276461736, 0.054052975070254625, 0.052724913462356325, 0.04469939835201789, 0.03477468163334929, 0.02496459721235254, 0.01602378964618357, 0.008169285592821296, 0.0014041606486023682, -0.004348160864560484, -0.009185170872841044, -0.01320218237839358, -0.01648103559408674, -0.01909144585651432, -0.02108783606239126, -0.022511425221652483, -0.023391044938881864, -0.023744050617299655, -0.023576619518787943, -0.02288494967687292, -0.021652923336144443, -0.01985408106006442, -0.01744925643293112, -0.01438569227957864, -0.010596368180298674, -0.00599907526596691, -0.0004978115987563479, 0.006009783804466292, 0.013616344713215314, 0.022355256571106652, 0.0320933314914889, 0.042267110105529034, 0.05128032195535739, 0.055193995335413755, 0.04547174329105016, 0.008535445007319805, -0.05842122029568692, -0.10902727407056685, -0.08328038088657146, -0.014331245136126537, 0.03481442902756977, 0.053085685468835665, 0.05326255427449191, 0.045841195534797305, 0.03609356076508446, 0.02627216702014432, 0.017243697022415957, 0.00926884567717663, 0.002380097881934002, -0.0034993873365302295, -0.008453664862183331, -0.012586057021624936, -0.015971091271356472, -0.01868615589430495, -0.020780148600956137, -0.022300710129681618, -0.02327358422385896, -0.02371979650387695, -0.023645440886769578, -0.023046815924071384, -0.021910644991456375, -0.0202112756473949, -0.01790745741197614, -0.014953286808413438, -0.01127549944101487, -0.006800346388186779, -0.0014235866986435375, 0.004951296879611273, 0.01243082019055836, 0.02105639963575604, 0.030738413458709934, 0.04098808627395561, 0.05039781386971698, 0.05541032677839813, 0.04813647402084927, 0.015227274009323416, -0.04944573216752208, -0.10634731852677227, -0.0903544726971169, -0.022719478223134484, 0.030311502523434158, 0.05182376100983058, 0.053659647560909005, 0.04692389741330593, 0.03739237226295179, 0.027581547787725317, 0.01846953797873254, 0.010385187487145817, 0.0033674624573732472, -0.002630668989236002, -0.00770893663029255, -0.01195048786844852, -0.015447381239944623, -0.0182621584089144, -0.020457967666167257, -0.022072429258415766, -0.023140699730000592, -0.023679120825140683, -0.023697487504500486, -0.02319335330278955, -0.022151827490367475, -0.020551121836887, -0.01834974192506351, -0.01550296303730649, -0.011938493253647877, -0.007583696867921607, -0.002333557975945776, 0.003909098294433295, 0.011257017328053303, 0.019765376641885338, 0.029375923990173327, 0.039676145866012535, 0.049423276441745254, 0.05541493201618329, 0.0503984594242646, 0.021399671379598903, -0.04036656897638009, -0.10241417413218838, -0.09656241908592343, -0.03137053054300996, 0.025308373405978798, 0.05024692595129336, 0.05390055851662597, 0.04794016702602736, 0.038669531278679926, 0.028884269169236435, 0.019708143246390527, 0.011510301294500619, 0.004373535902004444, -0.001752144586340959, -0.006942183930474652, -0.011301656077165793, -0.01490471041988188, -0.01782561455219881, -0.02011618523249177, -0.02182947174445707, -0.02299100718051633, -0.02362256068775453, -0.023733554091682145, -0.023322853634087023, -0.022377461903545018, -0.020872305495252305, -0.018777397885824314, -0.01603471610309857, -0.012583348348405176, -0.008350687888895274, -0.0032280347292617507, 0.002883977114681002, 0.01009800974230139, 0.018480553701250003, 0.028009837006576915, 0.03833575807546877, 0.048366022913751756, 0.055230271941806824, 0.05227690292837636, 0.02705006191335151, -0.03133075306044742, -0.09731090697618944, -0.10176498106199547, -0.04019272076816376, 0.01980539773639756, 0.04832547258409185, 0.05397309705145299, 0.04888152158887927, 0.039916752317698576, 0.030188491490709898, 0.020948211584398024, 0.012648717292830838, 0.005390186145866611, -0.0008498105379432427, -0.006165006778612494, -0.010635548135184865, -0.014348100249247667, -0.01736724306901608, -0.019761938884089326, -0.021569699693754378, -0.022825568171331884, -0.023549106132122865, -0.023753590679443444, -0.02343610382474245, -0.022584768895987387, -0.02118131136274241, -0.019184647270373126, -0.01655027770234104, -0.013211897849981592, -0.009099295573274872, -0.004104182825639005, 0.0018743144566311617, 0.008951638693952175, 0.017206916441827022, 0.026642566076974645, 0.036970709101985834, 0.047236451265005995, 0.05487092992491445, 0.053800171103364436, 0.032169063542335355, -0.022446229554368785, -0.09116214966828938, -0.1058420071973063, -0.04906538807956364, 0.013794896681749836, 0.04604350016874397, 0.05385759246044258, 0.04973905181363896, 0.04113395503646422, 0.03148183775087049, 0.02219548245442773, 0.013797858950597437, 0.0064230717602790964, 6.329106963109778e-5, -0.005369811245827042, -0.009953117990591537, -0.013773728647621967, -0.016895942096509964, -0.01938987914507268, -0.02129381472886, -0.022643740664237737, -0.023459995189378427, -0.023757144255279035, -0.02353300509587822, -0.022776826479574568, -0.02147109119211068, -0.019576271180762866, -0.01704858052750014, -0.01382307867671631, -0.00983044543143112, -0.005837812186145803])
```


Now let us define a callback function to store the loss over time


```julia
const losses = Float64[]

function callback(θ, l, pred_waveform)
    push!(losses, l)
    println("Training || Iteration: $(length(losses)) || Loss: $(l)")
    return false
end
```


```
callback (generic function with 1 method)
```


<a id='Training-the-Neural-Network'></a>

## Training the Neural Network


Training uses the BFGS optimizers. This seems to give good results because the Newtonian model seems to give a very good initial guess


```julia
adtype = Optimization.AutoZygote()
optf = Optimization.OptimizationFunction((x, p) -> loss(x), adtype)
optprob = Optimization.OptimizationProblem(optf, params)
res = Optimization.solve(optprob,
    BFGS(; initial_stepnorm=0.01, linesearch=LineSearches.BackTracking());
    callback, maxiters=1000)
```


```
u: ComponentVector{Float64}(layer_1 = Float64[], layer_2 = (weight = [0.000192163468454775; -5.627998325509101e-5; 3.741179534693135e-5; -0.00011563731823092065; 0.00023942583356970713; 1.964395050881911e-5; 4.47807869931742e-5; -8.453147165710218e-5; -2.2821513994142533e-5; -0.00012508204963486473; -0.00012633349979258225; -0.00015608784451597092; 9.096035682890218e-6; 6.474547262759373e-6; 0.0002441161777814812; -0.0003013609675687759; 0.00011070244363507656; -0.0001629011530891694; 9.613269867242957e-6; -0.00013228588795751204; 8.732072274123478e-6; 0.000129027641378173; 5.5615593737343066e-5; -5.5557844461777025e-5; -0.00011110768537015518; 0.00010022128844829968; 0.00010480004857496245; 1.676541251072627e-5; -3.222385203108159e-5; -5.855280323858279e-5; -2.450703323117507e-5; -1.2297272405677487e-5;;], bias = [2.1073351860687498e-16; 1.1627909108505136e-17; 7.48243780244253e-17; -2.779049468690395e-16; 1.4051525362174328e-16; 9.868189398171189e-17; 4.614699670306769e-17; 5.657627624942604e-18; 1.2439202883531561e-17; -4.1694241929545623e-16; -4.285326011304841e-16; -2.1004102426178749e-16; -3.6864094848616536e-18; 1.1021601278505709e-17; 1.059992995788096e-15; -3.099658381328937e-16; 1.6064656491906938e-17; -3.4871944226490104e-16; 1.821680025920649e-17; -4.039735001781086e-17; 2.0887523288525406e-17; 1.8835619353740175e-16; 1.3028618221604815e-16; -1.0852623565349772e-16; -2.365083331639096e-16; 4.1184155176415007e-16; 3.4477473887810294e-16; -4.621205166178974e-18; -9.469240041309021e-17; -3.0223130119580885e-16; -3.137366953872559e-17; -2.859138884650852e-17;;]), layer_3 = (weight = [0.0002525459840708164 2.835384478571413e-5 8.000964984650082e-6 0.00020763710020585893 -0.00014033059593751858 0.00017867290992767542 0.00019607454126712627 -1.7983778858213286e-5 -9.1158357432457e-5 2.2496758932928823e-5 -8.630383851229606e-5 -9.36682572191648e-5 -7.898018699592878e-5 -1.8315169623698656e-5 -2.8001097203778746e-5 -7.533573986264876e-5 0.00010996489257562117 4.951447229724325e-5 3.153771652619385e-5 -2.280454824901799e-5 4.806793671426466e-6 0.00011180526601858878 9.950285860581853e-5 0.00019508834342018305 4.583529338018166e-5 0.00015706813249747727 0.00013695539203948667 -4.046706996263933e-5 -0.00011032638755382143 5.730974411021469e-5 -0.00011255504975083328 5.829645064344159e-6; -3.20214244716184e-5 -8.85717277419775e-5 -2.83013310259006e-5 0.000262878998415082 -0.00013232389441735347 5.06864375488331e-5 2.2657626191617012e-5 -0.00013189838186418652 -0.0001161752993944136 0.0001221181477881079 3.1413117044842526e-5 -6.895944392911094e-6 4.3117662658445505e-5 -0.00020027477562008805 -0.0001894856073199504 -3.456374151619651e-7 2.3920352264659165e-5 -0.00010272178455534343 -7.530917041050645e-5 0.00021756072551897316 -6.978917785501482e-5 0.000124736764933453 5.066931358258949e-5 -0.00015785266854847073 3.060339027387343e-5 -4.245220092753745e-5 -1.926168492401302e-5 -6.403806450590856e-5 2.450421875936118e-5 4.0644779306135885e-5 0.0001003437605099718 -3.119946681592054e-5; -3.400753922156367e-6 6.984295079691963e-5 9.18773959656486e-6 -5.601918335797075e-5 9.071394062573255e-5 8.222346561469887e-5 0.0001921261869205416 6.143857735331332e-6 -0.00011933892481520029 1.5950556662023068e-5 -5.258122637865968e-6 4.4415581687089956e-5 7.334377205008115e-6 -7.133211282107216e-5 0.00012400726020075445 9.641433327429583e-5 -0.00015634881809146835 2.4932899140721155e-5 -9.083771099594593e-5 -0.00014552297896498805 -1.522634327611589e-5 0.00022383671650404158 1.5085870035727782e-5 -0.0001561587846304972 -7.143215723827245e-5 -6.859616358324552e-5 -4.3108938808112265e-5 3.7999496743761095e-5 -3.1514573020648445e-5 0.0002137819688136006 4.264281644227723e-5 3.040557250588029e-5; -1.2727580622219122e-5 9.754196718168562e-5 -3.775875383106896e-5 2.239948581737729e-5 2.02009751887242e-5 -0.00011069322580405432 -8.902180787808161e-5 -9.111726184309288e-5 9.586899897149844e-5 -2.9153542425401355e-5 -5.0601892223848764e-5 -8.16605396608687e-5 0.0002588171984029104 0.00015937939234609788 1.4562665557984548e-5 5.053335836457511e-5 -0.00014524926599514428 6.325386412973966e-5 -5.719532135807833e-5 -5.3326520071631814e-5 -1.0073314922549001e-5 0.00012619481195762127 0.0001191300753929757 2.4398353264048957e-5 -0.00016953194507331342 5.2722635803010624e-5 0.00010967169429241909 -4.0731026172208735e-5 -1.1822047668756303e-6 -0.0001605136429930932 -0.00015063070976574822 -2.1453351007578115e-5; 0.00016680473315045232 -7.477717038725115e-5 6.937544064115358e-5 0.00014632668141259232 -0.00014732120356077396 7.531628913696575e-5 3.493101455234308e-6 -7.941181714429508e-5 0.00013755951628539417 3.5265864123191244e-5 6.015501609637513e-5 0.00022150111878273322 -0.00011970779481359078 6.149952211402109e-5 -1.929098319399454e-5 8.164504076097655e-5 -8.348983859193979e-5 8.286144263093403e-5 0.00018192315443869427 -9.97677128298025e-5 -1.4959544690069933e-5 2.6363637213777283e-5 0.0001708621127063727 -0.00013308400260299985 1.3130697577271945e-5 2.456055351124672e-6 4.003735345306457e-5 -0.00014127374773394586 0.0001451373679329048 -6.16340551759732e-5 4.501299523966086e-5 -0.00014473775839448234; 4.571569621370639e-6 -4.645049697875911e-5 -4.081669389426662e-5 1.9841324006739934e-5 0.00015027824561537914 0.0001498395490269832 -0.00010342143791069224 8.697333983571378e-5 6.759418325225857e-5 -1.206975916294875e-5 -1.5414888861521853e-5 -2.883078518072307e-5 0.00010362593316665881 0.00012742159602192258 -5.891470713696678e-5 -1.426663724860995e-5 -6.46062413071545e-5 1.6105705486446157e-5 -0.00014269718080333406 -6.15666154263798e-5 -0.00014757808234582627 4.7071384375050964e-5 6.400059506257129e-5 4.9248664762493606e-6 -6.833703950553034e-5 -6.79736244284755e-6 0.0001962017035620023 -0.00015481330914928547 4.7870357280662704e-5 -0.00011845644762081026 -2.585915676183497e-5 -5.172014929859867e-5; -0.00013089781923602387 -4.9262455195778054e-5 0.0001343097444072979 1.1357698621809276e-5 -2.4893497812186398e-5 -0.0004159135663035651 -0.00011975305305946037 5.2399974901573394e-5 -3.6372117665954654e-5 -4.559797735104775e-5 7.097412681055765e-5 -0.00012116071075118978 1.2172577721191455e-6 -0.00014398205739831095 -4.300518985520632e-5 0.00013167998049494362 7.446033641777283e-5 -0.00021483767550356452 3.490088210987388e-5 0.00010062385053921164 -5.75410543211131e-5 0.0001782835513035543 -8.419765281410241e-5 -2.366848484648676e-5 0.00012696337007533115 -4.87143488548783e-6 -0.00025381794903346145 0.00028245601215480363 -0.00015531450690155327 0.0001770251453303426 1.2491007236754794e-5 0.00011153978784881999; 3.0413971810542024e-5 -7.226320153443498e-5 -8.743151145090824e-6 -2.6167801795454177e-5 4.596210569846049e-5 8.232242694482046e-5 0.00010840112522834638 3.605266979554035e-5 -0.00028709247121462783 -2.008911312660796e-6 -6.35299278178004e-5 6.624057871296869e-6 3.1608500332886795e-5 7.500660242449732e-6 4.251029318086252e-5 0.0002083945234085161 5.3764122324138315e-5 -9.701428493594869e-5 -4.920129717668661e-5 0.00011082000278525565 -8.258939803844806e-6 6.708032165311848e-5 6.639921926086418e-5 -5.011190146199778e-5 -1.964758880370825e-5 0.00010679914853659556 -0.00018598641904412735 0.00013603282573291877 4.70888350287804e-5 -0.00010036028683992476 3.4885562538484194e-5 0.0002316439000902124; 0.0001912028408842207 -4.212890524646978e-5 9.423526609319616e-5 1.2582187824613953e-5 -2.395272275317617e-5 -3.8126048078961074e-5 -6.38512184959526e-5 -0.00011913187807655971 0.0001481753886910477 2.907694471652827e-5 -9.227417939107681e-5 1.5472608371069783e-5 -0.00010510481405068667 3.665944206298789e-5 4.8723183514072076e-5 0.00022087618964720617 2.4792782656755285e-5 -0.00013380268972831467 0.00010336238739549636 -1.0364413523328748e-5 9.579429280714586e-5 -7.735478464744853e-5 3.898827177211591e-6 5.966017380709056e-5 -0.00015525659290140039 0.0001889550647465761 -2.682578559322187e-5 1.4437964469867044e-5 1.6927832635733408e-5 -6.583782413505748e-5 0.0001106901061721467 5.2598358539431204e-5; 4.742328972295616e-7 -4.005701479423463e-5 -0.00014645885816231207 0.00012153135181484145 2.625399834850975e-5 7.807702646436242e-5 -5.1916880275036785e-5 0.00012429975182362598 5.440337050435219e-5 0.00013841703044795975 -5.608130371933234e-5 -1.6620249462207412e-5 -6.383314170330718e-5 -5.880959501178893e-5 -0.00016770009964620783 -0.00010444889770966969 -0.00012062965246536537 1.2764000948452419e-5 -6.22127786666709e-5 3.2672628057988024e-5 6.759320100149183e-5 -0.00011753940774746538 -0.00010860957403588719 1.8750836224847883e-5 -0.00015584462520587018 6.767459713933086e-5 2.051457382526828e-5 4.781349931339797e-5 -1.2185168227537188e-6 -2.6364914029050832e-5 -7.230547047607508e-5 -6.311608152851411e-5; -1.0427896199005933e-5 -0.00013800708450067972 -6.737949319320139e-6 0.00014459361216360024 7.091837130783456e-5 0.0002445376356954918 -3.741936791262507e-5 6.3599362656782595e-6 5.8185802005068e-5 0.00013001895229172616 0.00026120595237080584 4.2205459758258775e-6 -1.3240857810119024e-5 -1.7611324550629828e-5 -7.663117798170592e-6 0.00012500433320002674 -4.475399349744718e-6 0.0001243127097732015 0.00010403139265331035 4.611489373564945e-5 -5.403948500675552e-5 7.388272013122637e-5 -1.563568923662585e-5 0.00014660468684818428 -5.5162063403245786e-5 0.0002692564211211176 0.00011767184867132323 -0.00018832043326615807 2.3622220283908097e-5 0.00013025272880989812 -9.146093554950842e-5 0.00012832994059503588; -0.00016644716325631812 0.00011582532223600595 8.755652433082366e-5 0.00015973701428208888 -3.0636320905410777e-7 5.512389960985651e-5 -8.533631572446019e-5 3.967646616170546e-6 -5.8027780515300055e-5 7.530163619719578e-5 1.2997815783250628e-5 0.00015970737203075614 2.3963079538038564e-5 -6.859705118641197e-5 0.0001809735554973662 -6.00362467691594e-5 0.0001346197974174894 8.614041197630386e-5 -2.8091759855719604e-6 -8.622911937948398e-5 -6.390274157693553e-5 -5.6880820384891555e-5 8.461935120921291e-5 3.7571495724471656e-8 2.2208253166699293e-5 1.0018887582027267e-6 -3.9884485350393556e-5 -4.6084645337583164e-5 0.00014018346027059426 0.00016783128429723572 9.748841502545369e-6 -5.434108889499429e-6; -0.00010341905036614831 -0.00015325965106159853 -5.6892866642664875e-5 -4.055124382942784e-6 -0.00013428725688858237 -3.062554279596861e-5 5.1326150777531834e-5 4.985980884964977e-5 2.5979070040994837e-5 0.000119980620719503 3.3722200522675416e-5 -0.0001771156388814483 -0.0001046734545626522 -0.00010092248013381219 3.7607078037454056e-5 7.811430222213784e-5 -3.6426743837294615e-5 6.160126903421023e-5 -6.7389600291052345e-6 7.875141417468965e-5 -3.2628050040438115e-5 5.423124420201501e-5 0.00019064256010904504 -0.00011941677840797632 0.00018358440101008162 0.0001628175956183237 2.9914821051422467e-5 2.6014027379352263e-5 -2.0905150823745526e-5 0.0001143529439913254 0.00010666074339395067 -0.00010043636612965102; 6.835927117387769e-5 -0.00017443445765641215 0.00012973903132840376 8.658045182707932e-5 -7.986001808424653e-5 0.00018832393609225146 -5.810267109884568e-5 -0.00011390925144771777 7.743394009773947e-5 -2.9247562252082094e-6 3.794018404912394e-5 8.690400638622348e-5 -9.546881708777179e-5 5.5950103635018276e-5 1.8064529485573826e-6 -0.00012438329074760434 8.059399035298487e-5 6.774259011033088e-5 9.089579318422223e-5 2.949252077266752e-5 3.617868562466796e-5 -4.343643238646725e-5 7.763597888876989e-5 -0.00013516901024379464 8.00028694536527e-6 1.2168626673859646e-5 -0.0001226420813309471 -4.464789751912138e-5 -0.00011608113934746621 7.683786454615484e-5 -6.166108730942616e-5 2.2108948107393036e-5; -1.1860547730452922e-5 0.00015676402368501978 8.604095169961015e-5 4.404064280480671e-5 -5.390157925054114e-5 5.5172235860151234e-5 1.0309045008974443e-5 -8.710505530086733e-5 7.482087936171958e-5 -2.5134287299251277e-5 6.591127281227277e-5 3.981646919655387e-5 -0.00010655139807692035 -6.63829388407641e-5 0.00024590159124139675 3.2196824448405136e-5 0.00010874419500270622 0.00011156010701469518 3.794503105258334e-5 1.1808734469566356e-5 -4.667234783606836e-5 -0.00019120848914225562 -9.371834779937517e-5 9.385645067471316e-5 1.877700093120087e-5 0.0001943312334866459 1.8486701136333456e-5 0.00011080145746621969 0.00011917910420255353 0.0001299374515462033 3.4550317728971125e-6 -1.5415956241998488e-5; -3.70422206790588e-5 -0.00015317500615784162 -3.038036179717895e-6 0.00011098249128260599 -0.00012386443664154972 0.00014675189926929112 0.0002025116661068704 -0.00019604857184750898 -5.6684734186276154e-5 4.630341540611847e-5 0.00020236975582953984 4.645817138657867e-5 -1.408112198551095e-5 0.00010212019300961265 3.261136557256424e-5 4.5754127899845604e-5 -0.00011357419530688646 2.28202845273545e-8 9.41947805113015e-6 -6.957279070341772e-5 0.0002796440782229169 0.00027285083674066096 0.00010338128381117064 -0.0001520368281082548 3.610778334839391e-5 0.00021732350764503281 -2.732042990394051e-5 6.074945453728839e-5 -3.517090622627014e-5 9.934475714980388e-5 -3.391214009316403e-5 0.0001239776426198644; 9.499947423943737e-5 0.0001359071634932324 -7.614723057589563e-5 9.055500012313518e-6 -8.75008967715339e-5 7.839364348807289e-5 8.309872608936273e-6 0.00012901553651214592 -0.00014423706801711656 5.2421236031354745e-5 0.00015647034393520228 4.6767544116724883e-5 0.00030002855288227006 -7.868667527088818e-6 -5.052225737120229e-5 -0.0001068661344480679 -2.8753494408316097e-5 -0.00011813019722570389 -0.00010601327580037614 -8.909514639629828e-5 -8.630404539975425e-5 1.982875306463476e-5 -0.00011012890667292336 -0.00024661437550197395 8.167273844141409e-6 -4.204386408776925e-5 -1.553408532448515e-5 8.370995288611305e-5 -9.87447350884161e-6 8.685302833224606e-5 -8.963339188426229e-7 2.337046003855216e-5; 8.967604461778103e-5 -5.9845637415278824e-5 -6.779917222026068e-5 -1.1239470231678784e-5 1.39615438367351e-5 -1.4826177184444053e-5 -9.172193150312948e-5 0.00013698333149498608 3.8485702853210056e-5 6.238224686078435e-5 -9.526679988064184e-5 -3.126882639642748e-5 -0.00019130767233015218 6.534853846675819e-6 -2.2135490869978464e-6 -2.925380122023927e-6 -7.098968691004503e-5 -4.9936326920785466e-6 -5.499864911122427e-5 -1.6266533029716885e-5 0.00011875625004016616 8.229302128731846e-5 -8.321601135108231e-6 0.00018786797390042424 0.00026284481081368326 0.00016903583108635707 2.9510641789082663e-5 5.77504777449909e-5 -2.8928068977405884e-5 -3.4132657865271276e-5 -1.6782925931478195e-5 -1.2073524747059277e-6; -5.564310519406335e-5 1.2496471604928275e-6 7.29479168818033e-5 0.00016337180098487317 2.491033486290252e-5 9.981408614822025e-6 -6.293059156307242e-5 6.781096711490807e-5 -3.952944931954307e-5 0.00020974434558736324 5.8318079785361504e-5 -0.00010902955288332144 -0.00011871576604464237 8.46707869946663e-5 0.0002554859191455345 -0.00010327148371876283 1.2343517331442047e-5 -0.0001899021928388094 4.462655382083584e-5 -0.0001839770022037803 8.873520240156767e-5 5.399419645398045e-5 -2.5653898016044735e-5 7.18984254795752e-5 -8.083705794563223e-5 -0.0001346352993700056 3.0783022187802695e-5 -8.489125063208084e-5 6.618586015390981e-5 -9.140049693671332e-5 0.00019717105427260342 4.266641811553241e-5; 1.7893549849435588e-5 9.951187177797352e-5 -0.0002265240872278484 2.4370625507470827e-5 -1.0502040712118683e-5 -0.00012279761347450805 4.481913140046887e-5 1.671868642155199e-5 5.578193315308056e-5 -2.5938401339190866e-5 3.3563748840278215e-5 0.00021055237823169686 -7.3065438103771835e-6 0.000180765379010732 -0.00012698537819083044 -0.00016414740446484192 7.999290039300676e-5 -5.918068916649504e-5 -8.233742471781122e-5 -0.0002131695472402139 -4.242817229500794e-6 2.285976927090751e-5 0.00012347464882771979 6.090160979659796e-5 4.604431898918694e-5 0.0001267384251347155 -5.8866917132365415e-5 9.056094506525877e-5 -0.00016690571999639748 2.3687029280732795e-5 -9.525045232145599e-5 -3.472619926320882e-5; 9.902815928209692e-6 4.265979283516732e-5 -8.926839813213404e-5 -7.377877931432082e-5 7.964690145017638e-5 -4.6346545549767206e-5 -6.296469085938823e-5 0.0001478764736573639 0.0001244012949071302 8.923430710709501e-5 -0.00022309200879973507 9.799961686511608e-5 -3.992526921067033e-5 0.0001402621403583733 -0.0001973691412233177 -6.523599016799544e-5 6.91899970304662e-5 -3.685773639445978e-5 -2.8390584465541144e-5 -5.2175242434908724e-5 -2.191870747921636e-5 -0.00012359488913645162 0.00015419759280192166 -3.8747866473584736e-5 8.689531228882017e-5 -6.247042050673934e-5 2.344558402981795e-5 -0.00013963268587687628 7.386950734215239e-5 9.134626294397264e-5 1.0660058488411769e-5 -0.00012568677060627957; 0.0001622633360318673 -8.613998149601322e-5 9.524879053853692e-5 -5.9337998455943654e-5 -0.00011142357040736379 7.859385434923827e-5 -0.00013050689383024044 2.448090047321651e-5 -0.0001369820158936627 -0.00014483514612153323 -8.763226585075374e-5 -3.30909818069375e-5 -4.822754933345961e-5 -1.6748029585214283e-5 -0.00020409803916774012 3.173266007145127e-5 7.00621901421385e-5 -6.955214095114001e-6 0.00012131432661473853 6.09189816975598e-5 8.797520488653433e-5 -6.387744294557765e-5 -0.00015030580768441365 -2.5869237352959402e-5 3.879079734245757e-5 0.00014401858127596995 -6.0084202478962744e-5 -9.775540754279002e-5 -1.4843852360425833e-5 -0.00021683914316897762 -9.25507331624239e-5 0.00017094043935569114; 5.334848931164144e-5 0.00013674881877013441 -0.00015005703214920348 -2.8829672080603712e-5 -0.00010412453018720388 0.000158571540234691 0.00010073239929842604 -9.641879630871687e-5 3.5806937669251755e-5 9.095191965033923e-6 5.466460454264053e-5 5.4252519769233365e-5 -0.00012867294906537406 -5.4286359661644164e-5 -5.416978063071043e-5 9.794735917466243e-5 -0.00010315180013785188 -5.632578875300005e-5 -1.1662712202094306e-5 5.6600038371845334e-5 -0.00015547693663175576 7.707245488055447e-5 -2.5132918087915068e-5 -0.00013249738156228372 2.7678663466218466e-5 1.3954571135431173e-6 -0.00021176164925927474 -2.1792854364389453e-6 -0.00023327010756257248 -4.2383809775496045e-5 3.058058821115342e-5 2.4843348659418e-6; 7.687397142190532e-6 -0.00015388456945840328 1.4594194494914263e-5 4.4161554383370996e-5 4.231784491381717e-5 -4.004455463911374e-5 -0.00012152821132514645 9.580649070374487e-5 4.349283203299185e-5 -5.829088463981151e-5 -3.637411050915243e-5 3.0250772893100303e-5 3.2531296297004866e-5 -3.1056440507033406e-5 -1.0711094050600264e-5 6.073053240939037e-5 -0.00013928525864214048 1.2352879407602867e-5 8.750012652415821e-5 -8.120892148765308e-5 -1.2791986095923517e-5 0.00011610422966002941 0.00010318112485509313 2.518827436250116e-5 -5.0464733662757726e-5 -7.030560895891777e-6 0.00014950061317465894 4.307371140856332e-5 0.0001269345216725768 5.1202709569390226e-5 -0.00016282140991717554 3.518258613001595e-5; -1.081779703939873e-5 -5.637079232817809e-5 -9.592761637739379e-5 0.00010968114508453587 -4.6940867497793605e-5 -6.609429841026309e-5 0.00014791740101665777 -0.00012865612519069456 0.00011712912088862058 -7.88126068362215e-5 -1.2950495721964615e-5 -0.00012329762979038965 -0.000124637337313999 7.589384619515708e-5 -0.00016300590653528524 -0.00011680647151631877 2.439801971216399e-5 0.00016311921933106398 8.959799594614979e-5 -2.965884016863283e-5 5.421862658133119e-5 8.477451626116573e-5 -4.71544859754231e-5 -4.257181865957866e-5 -1.3823315959386978e-5 1.9252187820011254e-5 -3.894558688604691e-5 4.487218245068905e-5 -3.6226979893199644e-5 -0.0001279508229634099 -9.757401279037442e-5 -0.0001606767706396398; 6.538563370515201e-6 6.0735045239991346e-5 5.9730828484020095e-5 -2.39780888888529e-5 7.048858283706742e-5 -5.100388120922438e-6 -8.980537636046094e-5 9.244983853465524e-5 -8.339318405444372e-5 9.401340544614599e-5 -8.097951608319213e-5 0.00013773769065196268 -0.00012931971245518475 7.853950269679954e-5 -1.658741670798489e-5 -0.0001791414684205233 -7.383833830784981e-5 0.00013192772208171303 0.00013023693505135773 -0.0001138425355249139 4.272074552761803e-5 0.0001675060779733538 0.00011368645250956612 -4.076458166776138e-5 0.0001668874615050854 -1.2932260274407147e-5 0.00015193571785390538 7.638693246451596e-5 3.0790496070835094e-5 0.00020880524285064132 0.0001512021703591699 -0.00037995178676749177; -5.38252384691007e-5 -5.447557811268284e-5 -4.5519980235186216e-5 1.8777807875470976e-6 -8.709741774920842e-5 -0.000220023357146351 -1.0765656556685603e-5 -0.0001137227296246239 2.7570124471163464e-5 -0.0001566413116640154 -8.647345345222516e-5 4.501878032475562e-5 -0.00013413958328303642 -4.799461709328704e-5 -2.6123856118383817e-5 -2.2653200689453227e-5 -1.4722263190089176e-5 -5.029391792470952e-5 -3.136075207723996e-5 -9.144582105788018e-5 -0.00018815204345148752 -2.571984947705071e-5 5.605625523029191e-5 2.6331245349215495e-5 -0.0002006245190975108 -4.119549299929498e-5 -0.00014063459781453843 3.349328875199263e-5 -0.00014884539956685534 -0.0002488520545418519 -8.980204617945149e-7 -0.00019728289004408494; -3.678356882032081e-5 6.74064088988491e-5 5.3819591240340385e-5 -3.9114003474493586e-5 6.701775382579708e-7 -8.663799747327712e-5 1.876306520981098e-5 -7.105582119864794e-5 0.00010719525959839694 -0.00010408821765765711 6.178490703793887e-6 0.00011420456791796807 2.5906442143335557e-5 -0.00011162464727849185 -0.00020723507407547707 8.448315417903255e-5 -9.63709004546019e-5 -2.7814821468434225e-5 -0.0001045938748839911 -3.816493120127271e-5 -3.3387391912671204e-5 -1.4244825823945282e-5 -7.491531653530899e-5 2.2296828657006807e-5 -7.827521551833167e-5 0.0001551442568333354 -8.355684042642688e-5 5.956941310696851e-5 -0.00013575824926110268 -4.510218571257735e-5 -0.000171541641638301 -8.272823982142315e-5; -3.188457614650916e-5 -9.487131521369249e-5 -0.0001162055507119114 2.0899392713194216e-6 2.337211754485888e-8 -5.826622711525671e-5 -2.5608979030820684e-5 3.5863898829257034e-5 -2.086908780130924e-6 -1.7759152087669e-5 -0.00016871807221817463 -8.55645432419067e-5 3.9211941639348365e-5 -0.00014499066512131561 -2.373939443692072e-5 -2.586336651775026e-5 5.273992226662758e-5 -1.2196284132928528e-5 5.618204320866194e-5 -0.0001608997501715122 1.3656770334034643e-5 5.451794439083398e-5 -8.674754119043169e-5 -2.1713997029889605e-5 -6.375868017115903e-5 -0.0001088326118586743 0.00010957114662247214 -0.00019577453551379424 0.00014571729641842392 -4.375056070771873e-5 -7.987040064095858e-5 -7.572776868970546e-5; -0.00017414019424210245 0.0001504952520623596 -0.00026844254210332585 9.883996205430065e-5 4.6810334940921875e-5 -5.216342872914087e-5 -6.436880932920197e-6 6.071827335076115e-5 2.5312777485350453e-6 3.5807184365368544e-5 5.57688177356264e-5 0.00013743646519982563 -3.974888425760126e-5 6.566797634845447e-5 -9.246617303903596e-5 9.087756149494961e-5 3.4389420368499876e-5 2.3105590633021498e-5 1.7860563791732624e-5 0.0001461401839766416 -0.0001987945437871121 4.733704151262053e-5 -1.4265637612293735e-5 9.732996074275831e-5 -0.00015483664213421214 7.742665144873434e-5 7.705209242671361e-5 0.00010736545624935842 -0.00010727401280051269 -5.753834596576388e-5 -2.7881726448281446e-5 -4.3442080307027015e-5; -7.537197231529e-6 -8.060287154595087e-5 -1.9287254414765222e-5 -0.00021606387099100898 8.889523224124191e-5 0.0001314871310597406 -4.786725637048521e-6 -4.015573949519255e-5 3.7927240103355524e-5 9.529860608662796e-5 -5.909667970345971e-5 0.00016181872115620752 0.00014816051180159014 -5.181764435920595e-5 0.00011800058337311706 7.711733363152699e-6 9.942058159421506e-5 -1.490809472389405e-5 -0.00016013757203555394 0.00010803078248781474 -3.15884703894957e-5 9.789200251445562e-6 -0.00013227451063076685 0.00018149144080152084 6.24828512655695e-5 3.501456513103397e-5 -0.00010635872831417876 -0.00011722228600493361 -1.4838874901132254e-5 4.9893669259374026e-5 -0.0001430317956846087 -0.0001554534851465254; -3.4937429817073746e-5 -6.285450065520145e-5 -5.01027446520734e-5 3.170173083303055e-5 4.564593261557088e-5 -2.509335384133513e-5 2.875126271788114e-5 -0.000168458055057683 0.00013847409870464098 -2.1076749166787934e-6 0.00012568635581514136 0.00010566448479178825 6.919104787044012e-5 -2.956131837386422e-6 -5.4549588029205754e-5 -0.00010037259046706109 -0.00011810051212565387 -2.091811468605608e-5 6.6175730964055e-5 0.000149412860693281 2.1003486537260657e-5 -5.9720658399293e-5 2.9351329132215935e-5 0.00026191345538932354 -0.00015231675054424792 0.00014303587674616687 0.00011858350778451887 -5.690167043617686e-6 0.00010778648872615471 5.437564297200475e-6 1.958344516565763e-5 -8.436681426651654e-6], bias = [4.421994211597224e-9; -1.5830160156647268e-9; 1.3246966788773092e-9; -4.300887595778514e-10; 2.910080214378886e-9; -3.433743768171729e-10; -1.9011172792920922e-9; 2.118806669988328e-9; 2.3308676061787847e-9; -2.824472412092376e-9; 7.106678863857193e-9; 3.536651451796748e-9; 9.746044098702217e-10; 2.669566809753237e-10; 4.666488745818637e-9; 5.220176534373137e-9; -4.196782698124922e-10; 2.06436219451917e-9; 1.2322139632713435e-9; -6.365356643915841e-10; -8.455928938838004e-10; -3.1934826252947117e-9; -3.124730581320254e-9; 9.591032569005027e-10; -3.1956294892723103e-9; 3.3182503790669595e-9; -1.0054977543420453e-8; -4.159691431125203e-9; -5.015153749553365e-9; 5.962352998240859e-10; -8.958241632430974e-11; 2.6717967146734404e-9;;]), layer_4 = (weight = [-0.0006603833631725957 -0.0005096863145913022 -0.0006650940722377919 -0.0008524405494252624 -0.0007437394674303591 -0.0006881255827195398 -0.000730237448590857 -0.0008256037830682134 -0.0006134589089312614 -0.0006328227126563353 -0.0006148415415621866 -0.0006535868985633846 -0.0008467113295164321 -0.0009180204600416076 -0.0008832509540841966 -0.0005043713407917077 -0.0006901019718833538 -0.0005466039834223118 -0.0007391963224036166 -0.0006154942639657672 -0.0006282434899101888 -0.0006100681652843547 -0.0006793751872962065 -0.0007676127328507717 -0.0005123383461970458 -0.0007053088858124838 -0.0006253341989394598 -0.0006911862604994878 -0.0007770600487489666 -0.000849512511755853 -0.0006211339020541603 -0.0007726094530681917; 0.0002896084478489185 0.00026065015568033995 0.00017751173707115082 0.00016168657075163679 4.506832641425592e-5 0.00019868219630787617 0.0001586403623847307 0.0003003393324033831 0.000287062714458956 0.0002121999358648907 0.0003007064616544762 0.0001997376682217606 0.00029969739581412483 0.0003193707319247706 0.00022902316147577364 0.00013207159880441224 0.00018852561398512697 0.0003086335710842437 0.00022926773514027102 0.0003152204147324165 0.00017294460980988495 0.00022432696928483442 0.00020108252385802385 0.00023928824603263433 0.0001213355335997587 0.00028680844497680225 0.0005246987887736241 0.0002542475097233033 0.0002814198625536908 0.0001349149165338786 0.00024326518883577319 0.00016685048127202718], bias = [-0.0007176797333779507; 0.00023045943981490216;;]))
```


<a id='Visualizing-the-Results'></a>

## Visualizing the Results


Let us now plot the loss over time


```julia
fig = with_theme(theme_web()) do
    fig = Figure()
    ax = CairoMakie.Axis(fig[1, 1]; xlabel="Iteration", ylabel="Loss")

    lines!(ax, losses; linewidth=2, alpha=0.75)

    return fig
end
```


![](1_GravitationalWaveForm-48.png)


Finally let us visualize the results


```julia
prob_nn = ODEProblem(ODE_model, u0, tspan, res.u)
soln_nn = Array(solve(prob_nn, RK4(); u0, p=res.u, saveat=tsteps, dt, adaptive=false))
waveform_nn_trained = first(compute_waveform(dt_data, soln_nn, mass_ratio,
    ode_model_params))

fig = with_theme(theme_web()) do
    fig = Figure()
    ax = CairoMakie.Axis(fig[1, 1]; xlabel="Time", ylabel="Waveform")

    l1 = lines!(ax, tsteps, waveform; linewidth=2, alpha=0.75)
    s1 = scatter!(ax, tsteps, waveform; markershape=:circle, markeralpha=0.25, alpha=0.5)

    l2 = lines!(ax, tsteps, waveform_nn; linewidth=2, alpha=0.75)
    s2 = scatter!(ax, tsteps, waveform_nn; markershape=:circle, markeralpha=0.25, alpha=0.5)

    l3 = lines!(ax, tsteps, waveform_nn_trained; linewidth=2, alpha=0.75)
    s3 = scatter!(ax, tsteps, waveform_nn_trained; markershape=:circle, markeralpha=0.25,
        alpha=0.5)

    axislegend(ax, [[l1, s1], [l2, s2], [l3, s3]],
        ["Waveform Data", "Waveform Neural Net (Untrained)", "Waveform Neural Net"];
        position=:lb)

    return fig
end
```


![](1_GravitationalWaveForm-50.png)


---


*This page was generated using [Literate.jl](https://github.com/fredrikekre/Literate.jl).*

