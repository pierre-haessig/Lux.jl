


<a id='Training-a-Neural-ODE-to-Model-Gravitational-Waveforms'></a>

# Training a Neural ODE to Model Gravitational Waveforms


This code is adapted from [Astroinformatics/ScientificMachineLearning](https://github.com/Astroinformatics/ScientificMachineLearning/blob/c93aac3a460d70b4cce98836b677fd9b732e94b7/neuralode_gw.ipynb)


The code has been minimally adapted from [Keith et. al. 2021](https://arxiv.org/abs/2102.12695) which originally used Flux.jl


<a id='Package-Imports'></a>

## Package Imports


```julia
using Lux, ComponentArrays, LineSearches, LuxAMDGPU, LuxCUDA, OrdinaryDiffEq,
    Optimization, OptimizationOptimJL, Random, SciMLSensitivity
using CairoMakie, MakiePublication
CUDA.allowscalar(false)
```


<a id='Define-some-Utility-Functions'></a>

## Define some Utility Functions


::: tip


This section can be skipped. It defines functions to simulate the model, however, from a scientific machine learning perspective, isn't super relevant.


:::


We need a very crude 2-body path. Assume the 1-body motion is a newtonian 2-body position vector $r = r_1 - r_2$ and use Newtonian formulas to get $r_1$, $r_2$ (e.g. Theoretical Mechanics of Particles and Continua 4.3)


```julia
function one2two(path, m₁, m₂)
    M = m₁ + m₂
    r₁ = m₂ / M .* path
    r₂ = -m₁ / M .* path
    return r₁, r₂
end
```


```
one2two (generic function with 1 method)
```


Next we define a function to perform the change of variables: $(\chi(t),\phi(t)) \mapsto (x(t),y(t))$


```julia
@views function soln2orbit(soln, model_params=nothing)
    @assert size(soln, 1) ∈ [2, 4] "size(soln,1) must be either 2 or 4"

    if size(soln, 1) == 2
        χ = soln[1, :]
        ϕ = soln[2, :]

        @assert length(model_params)==3 "model_params must have length 3 when size(soln,2) = 2"
        p, M, e = model_params
    else
        χ = soln[1, :]
        ϕ = soln[2, :]
        p = soln[3, :]
        e = soln[4, :]
    end

    r = p ./ (1 .+ e .* cos.(χ))
    x = r .* cos.(ϕ)
    y = r .* sin.(ϕ)

    orbit = vcat(x', y')
    return orbit
end
```


```
soln2orbit (generic function with 2 methods)
```


This function uses second-order one-sided difference stencils at the endpoints; see https://doi.org/10.1090/S0025-5718-1988-0935077-0


```julia
function d_dt(v::AbstractVector, dt)
    a = -3 / 2 * v[1] + 2 * v[2] - 1 / 2 * v[3]
    b = (v[3:end] .- v[1:(end - 2)]) / 2
    c = 3 / 2 * v[end] - 2 * v[end - 1] + 1 / 2 * v[end - 2]
    return [a; b; c] / dt
end
```


```
d_dt (generic function with 1 method)
```


This function uses second-order one-sided difference stencils at the endpoints; see https://doi.org/10.1090/S0025-5718-1988-0935077-0


```julia
function d2_dt2(v::AbstractVector, dt)
    a = 2 * v[1] - 5 * v[2] + 4 * v[3] - v[4]
    b = v[1:(end - 2)] .- 2 * v[2:(end - 1)] .+ v[3:end]
    c = 2 * v[end] - 5 * v[end - 1] + 4 * v[end - 2] - v[end - 3]
    return [a; b; c] / (dt^2)
end
```


```
d2_dt2 (generic function with 1 method)
```


Now we define a function to compute the trace-free moment tensor from the orbit


```julia
function orbit2tensor(orbit, component, mass=1)
    x = orbit[1, :]
    y = orbit[2, :]

    Ixx = x .^ 2
    Iyy = y .^ 2
    Ixy = x .* y
    trace = Ixx .+ Iyy

    if component[1] == 1 && component[2] == 1
        tmp = Ixx .- trace ./ 3
    elseif component[1] == 2 && component[2] == 2
        tmp = Iyy .- trace ./ 3
    else
        tmp = Ixy
    end

    return mass .* tmp
end

function h_22_quadrupole_components(dt, orbit, component, mass=1)
    mtensor = orbit2tensor(orbit, component, mass)
    mtensor_ddot = d2_dt2(mtensor, dt)
    return 2 * mtensor_ddot
end

function h_22_quadrupole(dt, orbit, mass=1)
    h11 = h_22_quadrupole_components(dt, orbit, (1, 1), mass)
    h22 = h_22_quadrupole_components(dt, orbit, (2, 2), mass)
    h12 = h_22_quadrupole_components(dt, orbit, (1, 2), mass)
    return h11, h12, h22
end

function h_22_strain_one_body(dt::T, orbit) where {T}
    h11, h12, h22 = h_22_quadrupole(dt, orbit)

    h₊ = h11 - h22
    hₓ = T(2) * h12

    scaling_const = √(T(π) / 5)
    return scaling_const * h₊, -scaling_const * hₓ
end

function h_22_quadrupole_two_body(dt, orbit1, mass1, orbit2, mass2)
    h11_1, h12_1, h22_1 = h_22_quadrupole(dt, orbit1, mass1)
    h11_2, h12_2, h22_2 = h_22_quadrupole(dt, orbit2, mass2)
    h11 = h11_1 + h11_2
    h12 = h12_1 + h12_2
    h22 = h22_1 + h22_2
    return h11, h12, h22
end

function h_22_strain_two_body(dt::T, orbit1, mass1, orbit2, mass2) where {T}
    # compute (2,2) mode strain from orbits of BH 1 of mass1 and BH2 of mass 2

    @assert abs(mass1 + mass2 - 1.0)<1e-12 "Masses do not sum to unity"

    h11, h12, h22 = h_22_quadrupole_two_body(dt, orbit1, mass1, orbit2, mass2)

    h₊ = h11 - h22
    hₓ = T(2) * h12

    scaling_const = √(T(π) / 5)
    return scaling_const * h₊, -scaling_const * hₓ
end

function compute_waveform(dt::T, soln, mass_ratio, model_params=nothing) where {T}
    @assert mass_ratio≤1 "mass_ratio must be <= 1"
    @assert mass_ratio≥0 "mass_ratio must be non-negative"

    orbit = soln2orbit(soln, model_params)
    if mass_ratio > 0
        m₂ = inv(T(1) + mass_ratio)
        m₁ = mass_ratio * m₂

        orbit₁, orbit₂ = one2two(orbit, m₁, m₂)
        waveform = h_22_strain_two_body(dt, orbit1, mass1, orbit2, mass2)
    else
        waveform = h_22_strain_one_body(dt, orbit)
    end
    return waveform
end
```


```
compute_waveform (generic function with 2 methods)
```


<a id='Simulating-the-True-Model'></a>

## Simulating the True Model


`RelativisticOrbitModel` defines system of odes which describes motion of point like particle in schwarzschild background, uses


$$
u[1] = \chi
$$


$$
u[2] = \phi
$$


where, $p$, $M$, and $e$ are constants


```julia
function RelativisticOrbitModel(u, (p, M, e), t)
    χ, ϕ = u

    numer = (p - 2 - 2 * e * cos(χ)) * (1 + e * cos(χ))^2
    denom = sqrt((p - 2)^2 - 4 * e^2)

    χ̇ = numer * sqrt(p - 6 - 2 * e * cos(χ)) / (M * (p^2) * denom)
    ϕ̇ = numer / (M * (p^(3 / 2)) * denom)

    return [χ̇, ϕ̇]
end

mass_ratio = 0.0         # test particle
u0 = Float64[π, 0.0]     # initial conditions
datasize = 250
tspan = (0.0f0, 6.0f4)   # timespace for GW waveform
tsteps = range(tspan[1], tspan[2]; length=datasize)  # time at each timestep
dt_data = tsteps[2] - tsteps[1]
dt = 100.0
const ode_model_params = [100.0, 1.0, 0.5]; # p, M, e
```


Let's simulate the true model and plot the results using `OrdinaryDiffEq.jl`


```julia
prob = ODEProblem(RelativisticOrbitModel, u0, tspan, ode_model_params)
soln = Array(solve(prob, RK4(); saveat=tsteps, dt, adaptive=false))
waveform = first(compute_waveform(dt_data, soln, mass_ratio, ode_model_params))

fig = with_theme(theme_web()) do
    fig = Figure()
    ax = CairoMakie.Axis(fig[1, 1]; xlabel="Time", ylabel="Waveform")

    l = lines!(ax, tsteps, waveform; linewidth=2, alpha=0.75)
    s = scatter!(ax, tsteps, waveform; markershape=:circle, markeralpha=0.25, alpha=0.5)

    axislegend(ax, [[l, s]], ["Waveform Data"])

    return fig
end
```


![](1_GravitationalWaveForm-24.png)


<a id='Defiing-a-Neural-Network-Model'></a>

## Defiing a Neural Network Model


Next, we define the neural network model that takes 1 input (time) and has two outputs. We'll make a function `ODE_model` that takes the initial conditions, neural network parameters and a time as inputs and returns the derivatives.


It is typically never recommended to use globals but incase you do use them, make sure to mark them as `const`.


We will deviate from the standard Neural Network initialization and use `WeightInitializers.jl`,


```julia
const nn = Chain(Base.Fix1(broadcast, cos),
    Dense(1 => 32, cos; init_weight=truncated_normal(; std=1e-4)),
    Dense(32 => 32, cos; init_weight=truncated_normal(; std=1e-4)),
    Dense(32 => 2; init_weight=truncated_normal(; std=1e-4)))
ps, st = Lux.setup(MersenneTwister(), nn)
```


```
((layer_1 = NamedTuple(), layer_2 = (weight = Float32[3.8079637f-5; -6.41292f-5; -0.00012871018; 0.000110085755; 4.2652522f-5; 8.253276f-5; 0.00014346003; 5.5293458f-5; 2.8293653f-5; -0.00013781797; 0.00017177871; -1.5050334f-5; 0.0001353648; -1.9181327f-5; 2.133066f-5; -0.00016628102; -3.3096847f-5; -0.00015040468; 6.712891f-6; -7.498539f-5; 0.00016400382; -5.861396f-5; 2.8640668f-5; -3.195455f-5; 3.9900655f-7; 3.0823398f-5; 2.4948311f-5; -4.868936f-6; 7.77012f-5; 5.1021212f-5; 1.5598362f-5; 7.2928444f-5;;], bias = Float32[0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0;;]), layer_3 = (weight = Float32[-0.00015093612 -2.906411f-5 5.263882f-5 -5.4225664f-5 -0.00013629015 -0.00018652342 -9.5368036f-5 7.9895886f-5 8.910921f-5 4.243404f-5 -0.00010590479 0.00012179951 8.763894f-5 0.00021776634 3.4025277f-5 7.595289f-5 0.00010344431 8.928255f-5 -1.5130033f-5 -2.77714f-6 0.00019369532 5.9504717f-5 0.00018584939 1.577067f-5 -0.00018628268 -0.00012589508 8.976009f-5 -0.00014956994 -0.00013792202 4.1361698f-5 1.8477658f-5 0.00016896162; -7.731976f-5 9.311599f-5 -1.3448936f-5 -3.573625f-5 -0.00018662137 2.487107f-5 -9.54984f-6 8.603909f-6 4.936874f-5 -4.0193612f-5 1.3106087f-5 2.2871675f-6 5.609875f-6 -9.391219f-5 -0.00014813115 -0.00023899386 0.00018901296 -0.00018706113 -0.00018747126 0.00014807218 -8.648077f-5 -8.964351f-6 0.00010541149 3.5332443f-5 5.5475057f-6 -1.1615092f-5 6.3010084f-5 0.00027343864 -9.25668f-5 2.1155174f-6 0.000108947715 -5.7621226f-5; -3.6805726f-5 -1.3732548f-5 8.97423f-5 -4.997222f-5 -5.252796f-5 -6.866136f-5 0.00012941472 1.8724922f-5 8.487453f-5 -6.291806f-5 -0.00010740794 -0.00010473724 -8.630184f-5 -8.601755f-5 4.133644f-5 0.00021675574 -1.1350126f-5 0.00012962523 7.337386f-5 3.0394299f-6 -4.6074925f-5 -1.6721777f-5 9.922904f-5 -1.9856843f-5 6.737824f-5 9.30078f-5 0.00012449127 -4.629214f-5 -5.973362f-5 0.00015211765 -2.3686713f-5 1.19230535f-5; -0.00013493201 -1.9629063f-7 -3.7649468f-5 3.7556783f-5 -3.5386613f-5 -0.000104489234 -2.7916156f-5 -2.7299347f-5 0.00010294522 -3.6255184f-5 2.9171882f-5 -5.358614f-6 6.9029025f-5 -0.0001451026 -2.729696f-5 3.0265328f-5 3.6214245f-5 1.7442375f-5 1.2917952f-5 5.977395f-5 -0.00019048787 2.5517333f-5 2.6489823f-5 -3.7238795f-5 -3.0783667f-5 0.00013050188 5.2477404f-5 -1.1422609f-5 -0.0002457412 -0.00014343653 -1.348696f-5 -0.0001048148; -0.000103626124 0.00013645228 -1.3723709f-5 -6.516744f-5 -0.00024805748 -0.00010481319 4.9391663f-5 -0.00010221891 -2.9274886f-5 -0.00016573224 -2.9606656f-5 6.98213f-5 1.6594278f-5 4.61611f-5 5.9772054f-5 9.092705f-5 -0.00014234471 -7.6928154f-5 8.999477f-5 -2.9614961f-5 -7.313752f-5 -8.101946f-5 3.3572698f-5 -2.5615605f-5 1.3074056f-6 3.0948606f-5 1.8942337f-5 -0.00012804315 7.64428f-5 2.7200453f-5 6.340853f-6 -6.502698f-5; -0.000108669665 1.2001092f-5 5.4109503f-5 -5.5639557f-5 9.917029f-5 -2.0241632f-5 -2.0264295f-5 -0.00012219982 2.6733833f-6 5.6162917f-5 -8.8437475f-5 4.1780655f-5 -0.00010134493 0.00013626867 -3.5149427f-5 4.8963862f-5 -6.765045f-5 -7.606502f-5 0.00015891324 4.8121903f-5 -0.00015738478 0.00011249717 -4.2432635f-5 1.1133978f-5 -5.8693848f-5 -0.0001959891 -0.00011410926 -6.563643f-5 -6.1167775f-5 5.4658536f-5 -1.0227118f-5 -6.829156f-6; 0.00016856974 0.00011239915 2.4677382f-5 4.5862173f-5 7.1289476f-5 -5.476991f-5 1.4382282f-5 0.000110625544 -4.5573634f-5 -0.00011032636 2.3338576f-5 7.534457f-5 -0.00020907629 -4.1690317f-5 -9.8110744f-5 -0.00012368882 -1.8405715f-5 2.793868f-5 -7.93594f-5 -7.0910464f-5 1.0140132f-5 0.0001609234 -3.9666484f-5 -6.2548585f-5 0.0001607325 3.3176777f-5 -1.4677834f-5 -0.0001483553 -5.7151225f-5 3.3572443f-5 -1.4687802f-5 -0.00016377993; -5.2259043f-6 0.00012013666 0.00015134558 4.30859f-5 -2.3761857f-5 -0.00011886948 3.077502f-5 0.00011287628 8.898994f-5 -0.00012981458 -8.597755f-5 0.00016086268 -3.2353985f-6 -0.00011332259 -8.425028f-5 0.00014724473 5.5364777f-5 1.5469763f-5 2.9204311f-5 6.17783f-5 -2.7018763f-5 6.3956606f-5 -6.687306f-5 0.00015910524 6.063093f-5 0.0001311425 -2.2571228f-5 -0.00011456949 -0.00014027258 -7.33926f-5 -7.178225f-5 1.5241967f-5; -2.5296951f-5 4.9438876f-7 7.534739f-5 -9.492546f-5 3.458065f-5 -7.10585f-5 4.8657876f-5 -0.00013214866 -0.00016303103 6.5554166f-5 7.808361f-6 0.00012275405 -2.0946687f-5 0.0001784795 0.0001557132 3.906472f-5 0.00013938498 -0.00011551029 -0.00010428931 1.4822471f-5 0.00011741005 6.503728f-5 -7.120998f-5 -9.619227f-5 4.5780194f-5 -0.00011100626 -3.6466645f-5 -7.054146f-7 -0.0001739804 -5.4582186f-5 -0.00012718803 -5.6725155f-5; -3.2798434f-5 0.00021489197 0.00010214931 4.7285746f-5 4.3961845f-5 -0.00017174879 0.00014916767 0.00017095832 -1.5284382f-5 -2.7472985f-5 8.6901084f-5 -1.9552355f-5 4.6068544f-5 -8.062674f-6 1.1316804f-5 -2.9966972f-5 -0.00013823457 8.652361f-5 -0.00015690726 -4.7073594f-5 -3.6135032f-5 -4.5571112f-5 0.00011672812 -4.1834166f-5 -2.735453f-5 -2.508383f-6 -6.0132345f-5 -0.00013218496 6.841846f-5 -0.00014789114 5.9429083f-5 5.5414348f-5; 4.7227844f-5 -7.526621f-5 -6.4976964f-5 -0.00030973414 -0.00015652862 5.074861f-5 0.00018705631 -7.706581f-5 4.294043f-5 0.00022129374 -3.3257264f-5 -5.5492026f-5 0.00017104005 0.000116300194 5.9867827f-5 2.344087f-5 3.708796f-5 0.00015094208 -2.9890067f-5 -0.0002574439 -7.6517375f-5 -0.00017482982 -2.2736107f-5 -0.0001820572 8.796793f-5 -7.823467f-6 -3.973047f-5 -4.18812f-5 -1.178773f-5 -0.00015067367 1.2022448f-6 -2.7280616f-5; 2.1933902f-5 -0.00022303362 6.384875f-5 -2.0328169f-5 -0.00014379632 0.00012101382 -6.5618665f-6 -7.508138f-5 -7.398813f-5 0.00014653757 -0.00013010702 -1.8914623f-5 -7.586544f-5 5.5251094f-5 -6.387161f-5 -0.000105980056 3.8978367f-5 7.922588f-5 -0.00015309585 -0.0001815575 2.8436189f-5 -7.809707f-5 3.9194303f-5 -2.463706f-5 0.00012490142 0.00010815167 4.434933f-5 0.00016416654 0.00017608178 0.00019521834 -0.00010393563 -4.5688168f-5; -5.9623253f-5 2.1304219f-5 7.836446f-6 5.0596675f-5 -0.00015515547 7.2203955f-5 -0.0001227465 1.6259362f-5 -5.9923723f-6 -0.00014925728 0.00011361268 9.84621f-5 4.1385687f-5 -4.517482f-5 -6.4442537f-7 -4.093385f-5 -4.8331927f-5 3.6247493f-5 -5.5419576f-5 7.318348f-5 -0.00012878381 6.783719f-5 4.11313f-6 -0.00010319859 7.256333f-5 6.008688f-5 3.8713042f-5 3.8207538f-5 -1.9151836f-5 8.817063f-5 -7.116078f-5 4.878321f-5; -1.929738f-7 -0.00025392027 3.640757f-5 6.101489f-6 3.1614454f-5 3.544617f-5 7.632074f-6 -8.580086f-5 -1.5120845f-5 -7.5508346f-5 0.00012774952 -8.221058f-5 -8.041342f-5 -9.735547f-5 -3.5316887f-5 1.0428784f-5 3.0258165f-5 -8.032955f-5 4.253104f-5 7.788844f-5 -1.7066532f-5 -2.546464f-5 -5.7743575f-5 -4.7827714f-5 -1.9389674f-5 1.1157912f-5 2.0869416f-5 -0.00011501363 -0.00011330777 0.000119793825 -3.9550814f-5 -7.540686f-5; 6.878302f-5 -0.00019514286 -1.3035113f-5 9.616086f-5 -5.919568f-5 4.7497942f-5 -1.4496085f-5 -0.00014196422 -0.0001411865 6.7535955f-5 7.5601405f-5 4.4144323f-5 7.1252645f-5 -3.227396f-5 -5.42903f-5 -1.6579768f-5 5.979274f-5 -2.3815448f-7 1.6138416f-6 -7.46106f-5 -2.5812285f-5 -3.279484f-5 -5.143678f-5 0.00016351203 2.5613414f-5 -2.2128308f-5 -7.765765f-5 2.902225f-5 5.7964568f-5 -0.00017230914 -7.7982084f-5 -2.463016f-5; -4.1112333f-5 -5.7791285f-6 -4.2385098f-5 -0.00018515134 8.044401f-5 0.000115867435 -1.7141518f-5 -2.153885f-5 0.00011995424 -3.759241f-5 -9.461794f-5 8.2312254f-5 -3.9474824f-5 -0.000102719445 -8.86091f-6 6.988445f-6 -2.8320432f-5 -0.00012397597 -2.3081271f-5 8.6234824f-5 -0.00010002467 2.9746458f-5 -0.00017404137 -0.00020783172 1.3181348f-5 0.00015034257 7.324208f-5 0.000115486706 8.097084f-5 0.00012829398 6.2368854f-5 -1.9507706f-5; 2.5318734f-5 -1.3434976f-5 -0.00014911797 -1.82844f-7 -4.7419588f-5 -8.890344f-5 7.9294034f-5 0.00014018224 -6.232825f-5 0.00015559871 -1.3864891f-5 -1.4290293f-5 -0.00018974084 1.7086157f-7 0.00012709336 -4.945355f-5 -2.655677f-5 -0.00026410376 2.5068088f-5 -7.521664f-5 -2.3582239f-5 5.006094f-5 -0.00016002599 0.00017250792 0.00022697079 5.584552f-7 -0.00010813971 8.634947f-5 -3.233176f-5 -4.076824f-6 -4.4882418f-5 -6.9094676f-5; -3.901064f-5 7.279312f-5 3.485261f-5 -0.00015760808 3.7712794f-5 -4.4301993f-5 5.034396f-5 -5.884688f-5 -4.023508f-5 0.0002793641 5.114977f-5 9.908814f-7 -0.00010907888 -0.00017963315 -2.602143f-5 -6.209625f-6 -6.228329f-5 -2.7085402f-5 3.16754f-5 8.409927f-5 4.9567887f-5 0.00021624145 -7.023105f-5 2.364372f-6 -8.43752f-5 -5.1217185f-6 -2.5338326f-5 0.0002322027 5.5855093f-5 -2.7584712f-5 0.00011563883 -0.00021149655; -2.6755732f-5 -2.2488015f-5 0.000121222205 7.826163f-5 -0.00013551538 -0.000103624894 4.5729434f-5 8.081321f-6 -4.244215f-5 9.497268f-5 0.0001439815 -1.6270355f-5 -0.00020302985 -0.000132131 -3.767176f-5 -0.00010728274 1.2317325f-5 2.9463543f-5 -8.432394f-5 -0.00010469433 -3.9382972f-5 3.7838945f-5 -0.00010970158 -9.58051f-5 -0.00015069822 -2.3271641f-5 9.781275f-5 -9.732164f-5 -6.576391f-5 0.00018945632 9.443684f-5 0.00012563696; 0.0002891525 -0.00010636579 7.764632f-6 -7.020536f-5 -3.275366f-5 0.00014837093 4.2320087f-5 0.0001715436 4.276107f-5 6.2363666f-5 5.2720592f-5 -0.00013456437 -1.3785187f-5 -7.397068f-5 -6.394726f-5 -0.000113267175 -2.4314135f-5 -0.0001327948 -3.0249594f-5 0.0001619298 -0.00011781188 0.00014618445 -0.00012848024 -7.638438f-5 0.00010303943 9.0172f-5 -4.7376456f-5 5.6303474f-5 -0.00010726664 0.0001706744 7.975424f-5 0.00020903297; -0.00013682955 0.00013837805 4.251282f-5 0.00010409032 -0.00018533495 6.749524f-5 4.2769614f-5 -8.632578f-5 2.9633225f-5 3.5070832f-5 -4.85184f-5 -3.3108463f-5 0.00010802155 0.00013536353 0.00014032182 0.000121398516 0.00010250879 5.47446f-5 -6.344914f-5 -4.5515126f-6 -0.00010227823 1.32551395f-5 -6.2827865f-5 2.8364011f-5 7.689509f-5 -1.651079f-5 -1.6098935f-5 6.232139f-6 0.0002120882 1.207804f-7 -1.7071838f-5 0.00012747754; 0.00014179017 6.254129f-5 5.151398f-5 -1.4257932f-5 -2.1821887f-5 0.00011236561 0.00012892528 0.00017404967 1.8493432f-5 8.483572f-5 -0.00012367104 -0.00013363501 -7.92047f-5 -0.00011280099 -1.3451951f-5 0.00011241703 -2.5544963f-5 -1.7145065f-5 -0.00012757679 -5.9681548f-5 2.2000879f-5 -3.1946816f-5 -7.61294f-5 0.00016806133 3.215273f-5 6.689638f-5 3.0221912f-5 -7.941866f-6 3.841434f-5 0.00013983712 1.0079792f-5 0.00010671303; 0.00010114064 -6.312573f-5 0.000117835865 8.94735f-5 -0.00013821002 -0.00012064767 -6.682112f-5 9.107023f-5 -0.00010865947 0.000165432 2.7953936f-5 0.000111662564 -0.00017997801 9.7310796f-5 6.949559f-7 -4.0358398f-5 -3.835914f-5 8.4796935f-5 -3.9786995f-5 2.6161448f-5 6.898463f-5 3.2116983f-5 0.00016750969 1.2311393f-5 9.015526f-5 3.8362487f-5 -1.7658189f-5 -1.4041437f-5 0.0001073067 -0.00021934461 -0.00015529833 -2.3046841f-5; -0.00018201678 0.000111537855 2.0421401f-5 -7.945135f-5 9.379925f-5 5.6806635f-5 -0.00021890586 -2.6362584f-5 2.5304911f-5 5.5089895f-5 -0.00014823534 5.3122927f-5 5.9786275f-5 1.3522754f-5 3.2965887f-5 0.00010726983 -0.00016661259 6.1719766f-5 -7.961374f-5 -3.1378946f-5 7.293101f-5 -2.0026018f-6 7.428694f-5 -0.000117754294 0.00012978044 -9.4237876f-5 -7.5399544f-6 -0.00012910963 -0.00010126092 -5.7971003f-5 -0.00011798629 7.8529556f-5; 4.2768304f-5 -4.832417f-5 -0.000115359086 6.976663f-5 9.971627f-5 9.664107f-5 -0.00017607544 -2.768688f-5 2.9345974f-5 -9.572405f-5 1.1637174f-5 -1.1731825f-5 -4.887902f-5 -0.00023351783 -1.5329822f-5 -7.614302f-5 -4.4749573f-5 0.00016954573 -3.525669f-5 -8.85041f-6 -9.592646f-6 7.266988f-6 2.2705415f-5 -3.955776f-5 4.4421842f-5 -2.1999562f-5 -1.6397571f-5 2.6181053f-5 -1.9602065f-5 -7.093529f-6 -7.225003f-5 1.8151213f-5; -8.584452f-5 0.00016169886 7.849813f-6 5.803779f-5 3.0823085f-5 -4.7482492f-5 -6.1016166f-5 -0.000116666306 -0.000115385126 1.1436625f-5 0.00016305056 -6.206041f-5 1.5041932f-5 0.00011711511 -9.320504f-5 9.783228f-5 0.00011523519 9.387515f-6 -3.6379857f-5 -0.00016561167 5.3188454f-5 6.11087f-5 3.4601724f-6 -8.50778f-5 2.0845871f-5 7.022543f-5 0.0001314768 6.774676f-6 -0.00013715726 -0.0002632935 3.5925994f-5 9.850607f-5; -0.0001454137 3.206476f-5 -1.1053672f-5 0.00018343584 5.6252433f-5 8.2892824f-5 0.00013814024 -3.312873f-5 8.031763f-5 0.00010411673 3.489678f-5 0.000113673785 -0.00013202977 -0.00019910216 -8.387716f-5 -1.3000305f-5 -0.00010202678 3.009151f-5 -0.000103472375 0.00010090128 -8.799441f-5 -6.039398f-5 0.00010763874 -4.0098716f-5 1.0483766f-5 -0.00015482653 9.145126f-6 -1.9223453f-5 -6.6695175f-5 -8.873516f-5 2.9736932f-5 -2.254165f-5; 0.00012242534 -7.15827f-5 -0.00020725062 0.00010283006 -8.792169f-5 -0.0001542924 -4.0536204f-5 -0.00016312546 -3.7934744f-5 1.908449f-5 -4.0798262f-5 -0.00017095213 0.00012215179 2.933483f-6 0.00018197217 6.945291f-5 0.00010393522 0.0001849371 7.836749f-5 -8.646301f-5 -0.000105675135 -8.7900077f-7 -4.408606f-5 -0.0001046238 -5.820765f-5 -0.00019652562 1.492825f-5 2.5166126f-5 0.00010070595 5.17154f-5 -5.759544f-5 0.00012797053; 0.00017046182 1.7400327f-5 1.2456198f-5 -0.00012708726 -4.4641332f-5 0.00014573078 -0.00010779359 -3.119688f-5 -7.40571f-5 -8.9453795f-5 5.245635f-5 -2.9683653f-5 -4.7624857f-5 0.00021756359 -5.114664f-5 8.288301f-5 -0.00012866914 -0.00013842952 -2.6959231f-5 0.00011979272 -0.0001974335 0.00022922104 5.5280925f-5 -2.7247803f-5 -9.475581f-5 4.3299446f-5 8.666289f-5 -1.9706406f-5 -6.903031f-5 -7.5903496f-5 5.7076126f-5 5.3046315f-6; 8.701987f-6 -6.0259958f-5 -3.7817272f-6 4.2049614f-5 -5.7103593f-5 -3.3928376f-5 -3.7037742f-5 0.00015324245 -0.00012245278 -0.00018194885 4.0562838f-5 2.6914675f-5 -5.490405f-6 1.49722755f-5 -0.00013332775 3.566173f-5 2.4812762f-5 5.376021f-5 5.3730313f-5 -9.061036f-5 -4.4015007f-5 1.4062833f-5 -6.084003f-5 -7.701302f-5 -3.3083874f-5 -3.4778255f-5 -4.349851f-5 0.00012687895 -7.156675f-5 -3.1538107f-6 0.00019766546 -1.3793844f-5; 0.00010208835 0.00017959836 4.961881f-5 0.00012881854 7.832472f-5 -5.639709f-5 4.4187807f-5 -9.80037f-5 5.5934674f-5 4.0192317f-5 -0.00016684628 -8.418246f-5 0.00012109614 6.153561f-5 2.8626006f-5 -7.501748f-6 -0.0001115712 0.00019573502 3.9558017f-5 -2.197348f-5 -0.00016759409 5.0770093f-5 0.00014801703 -5.1241917f-5 7.0742426f-5 -7.733854f-5 6.426462f-5 -9.444992f-6 -5.644737f-5 0.00019367953 9.475188f-5 5.4191954f-5; 2.5045425f-5 -0.00010271443 2.6681319f-5 0.00019145523 -2.0527163f-5 0.00019827107 -1.389651f-5 -4.4932127f-5 -7.597522f-5 3.3556166f-6 -0.000115639414 -2.0613445f-5 -1.6774171f-5 0.00011014372 -0.00011638362 7.582333f-5 -0.00016161696 2.2098238f-5 0.00016069379 4.9760227f-5 3.1746415f-5 3.324416f-5 -2.1809157f-5 -4.7828686f-5 -9.350877f-5 -8.4020485f-6 9.008476f-5 0.00015497053 3.1863277f-5 0.000117950454 3.656068f-5 -3.0666386f-5], bias = Float32[0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0;;]), layer_4 = (weight = Float32[5.9550486f-5 -9.354967f-5 4.1423256f-5 3.691715f-5 6.0515267f-5 -6.0639186f-6 -5.09504f-5 4.4789806f-5 -0.00014342174 -0.00018457565 7.678534f-5 0.00013358358 0.00019866253 9.851624f-6 -2.986154f-5 -1.6134021f-5 0.00013175709 -1.389135f-5 0.00012773783 6.9341986f-6 -4.6266166f-5 -4.1305328f-5 0.00013003648 5.8267553f-5 9.727022f-5 -6.9905705f-5 -2.0713418f-5 -5.8746537f-5 2.1561207f-5 -4.7256377f-5 9.202529f-6 -0.00016365974; 6.226272f-5 -0.00012689558 -8.537052f-5 4.95613f-5 -0.00011306633 -0.00010219806 -0.0001758781 6.0754905f-5 -0.00020719894 -0.00012619491 0.0002730563 0.00011331702 -4.5387103f-5 1.6004436f-5 2.9948002f-5 5.9325506f-5 -3.2582386f-5 0.00010932802 -6.954669f-5 -5.0106806f-5 -6.1708524f-5 -5.5689517f-5 5.7878383f-6 0.00010834552 -0.0002944902 9.311119f-5 -1.0413251f-5 6.061254f-6 -0.00015765498 4.395207f-5 -0.0002514681 5.9487706f-5], bias = Float32[0.0; 0.0;;])), (layer_1 = NamedTuple(), layer_2 = NamedTuple(), layer_3 = NamedTuple(), layer_4 = NamedTuple()))
```


Similar to most DL frameworks, Lux defaults to using `Float32`, however, in this case we need Float64


```julia
const params = ComponentArray{Float64}(ps)
```


```
ComponentVector{Float64}(layer_1 = Float64[], layer_2 = (weight = [3.807963730650954e-5; -6.412919901777059e-5; -0.00012871017679572105; 0.00011008575529558584; 4.2652522097341716e-5; 8.253275882452726e-5; 0.00014346002717502415; 5.529345799004659e-5; 2.829365257639438e-5; -0.00013781797315459698; 0.00017177870904561132; -1.5050333786348347e-5; 0.00013536479673348367; -1.918132693390362e-5; 2.1330659365048632e-5; -0.00016628102457616478; -3.309684689156711e-5; -0.00015040468133520335; 6.712890808557859e-6; -7.498539343941957e-5; 0.0001640038244659081; -5.861396130057983e-5; 2.8640668460866436e-5; -3.195455064997077e-5; 3.9900655224300863e-7; 3.082339753746055e-5; 2.494831096555572e-5; -4.868935775448335e-6; 7.770120282657444e-5; 5.1021212129853666e-5; 1.5598361642332748e-5; 7.292844384210184e-5;;], bias = [0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0;;]), layer_3 = (weight = [-0.0001509361172793433 -2.9064109185128473e-5 5.263882121653296e-5 -5.422566391644068e-5 -0.00013629015302285552 -0.0001865234225988388 -9.536803554510698e-5 7.989588630152866e-5 8.910921314964071e-5 4.2434039642103016e-5 -0.00010590479359962046 0.00012179950863355771 8.763893856666982e-5 0.00021776634093839675 3.402527727303095e-5 7.595289207529277e-5 0.00010344431211706251 8.92825482878834e-5 -1.5130032807064708e-5 -2.7771400255005574e-6 0.00019369531946722418 5.950471677351743e-5 0.00018584939243737608 1.577067087055184e-5 -0.0001862826757133007 -0.00012589507969096303 8.97600912139751e-5 -0.00014956993982195854 -0.0001379220193484798 4.136169809498824e-5 1.847765815909952e-5 0.000168961618328467; -7.731976074865088e-5 9.311598842032254e-5 -1.3448936442728154e-5 -3.573625144781545e-5 -0.00018662137154024094 2.487106939952355e-5 -9.54983988776803e-6 8.603909009252675e-6 4.936874029226601e-5 -4.019361222162843e-5 1.3106086953484919e-5 2.287167490067077e-6 5.6098751883837394e-6 -9.391218918608502e-5 -0.00014813114830758423 -0.00023899385996628553 0.0001890129642561078 -0.0001870611304184422 -0.00018747126159723848 0.00014807218394707888 -8.648077346151695e-5 -8.964350854512304e-6 0.00010541149094933644 3.533244307618588e-5 5.547505679714959e-6 -1.161509226221824e-5 6.301008397713304e-5 0.00027343863621354103 -9.256679913960397e-5 2.115517418133095e-6 0.0001089477154891938 -5.762122600572184e-5; -3.6805726267630234e-5 -1.3732547813560814e-5 8.974230149760842e-5 -4.9972219130722806e-5 -5.2527961088344455e-5 -6.866135663585737e-5 0.00012941472232341766 1.8724922483670525e-5 8.487453305860981e-5 -6.291805766522884e-5 -0.00010740794095909223 -0.00010473724250914529 -8.630184311186895e-5 -8.601754962000996e-5 4.1336439608130604e-5 0.00021675573952961713 -1.1350126442266628e-5 0.00012962523032911122 7.337386341532692e-5 3.0394298846658785e-6 -4.6074925194261596e-5 -1.6721776773920283e-5 9.922903700498864e-5 -1.985684320970904e-5 6.737824151059613e-5 9.300780220655724e-5 0.0001244912709807977 -4.629214163287543e-5 -5.973361840005964e-5 0.00015211764548439533 -2.3686712665949017e-5 1.1923053534701467e-5; -0.00013493200822267681 -1.962906281960386e-7 -3.764946814044379e-5 3.755678335437551e-5 -3.538661258062348e-5 -0.00010448923421790823 -2.7916155886487104e-5 -2.7299347493681125e-5 0.0001029452178045176 -3.625518365879543e-5 2.917188248829916e-5 -5.358614089345792e-6 6.902902532601729e-5 -0.00014510260371025652 -2.729695916059427e-5 3.0265327950473875e-5 3.621424548327923e-5 1.7442374883103184e-5 1.2917951607960276e-5 5.977394903311506e-5 -0.00019048787362407893 2.5517332687741145e-5 2.6489822630537674e-5 -3.723879490280524e-5 -3.07836671709083e-5 0.00013050188135821372 5.24774040968623e-5 -1.1422608622524422e-5 -0.00024574119015596807 -0.00014343652583193034 -1.3486959687725175e-5 -0.00010481479694135487; -0.00010362612374592572 0.00013645227591041476 -1.3723709344048984e-5 -6.516744178952649e-5 -0.00024805747671052814 -0.00010481318895472214 4.9391663196729496e-5 -0.00010221890988759696 -2.9274886401253752e-5 -0.0001657322427490726 -2.9606655516545288e-5 6.982129707466811e-5 1.6594278349657543e-5 4.6161101636243984e-5 5.9772053646156564e-5 9.092705295188352e-5 -0.0001423447101842612 -7.69281541579403e-5 8.999476995086297e-5 -2.961496102216188e-5 -7.31375184841454e-5 -8.101946150418371e-5 3.3572698157513514e-5 -2.5615605409257114e-5 1.3074055686956854e-6 3.0948605854064226e-5 1.8942337192129344e-5 -0.00012804314610548317 7.644279685337096e-5 2.7200452677789144e-5 6.340852905850625e-6 -6.502697942778468e-5; -0.00010866966476896778 1.2001091818092391e-5 5.410950325313024e-5 -5.563955710385926e-5 9.917029092321172e-5 -2.024163222813513e-5 -2.026429501711391e-5 -0.00012219982454553246 2.6733832783065736e-6 5.6162916735047475e-5 -8.843747491482645e-5 4.178065501037054e-5 -0.00010134492913493887 0.00013626867439597845 -3.514942727633752e-5 4.896386235486716e-5 -6.765044963685796e-5 -7.606502185808495e-5 0.00015891324437689036 4.812190309166908e-5 -0.00015738478396087885 0.00011249716771999374 -4.243263538228348e-5 1.1133977750432678e-5 -5.869384767720476e-5 -0.00019598909420892596 -0.00011410925799282268 -6.563642818946391e-5 -6.116777512943372e-5 5.46585361007601e-5 -1.0227117854810786e-5 -6.829156063759001e-6; 0.0001685697352513671 0.00011239915329497308 2.4677381588844582e-5 4.5862172555644065e-5 7.128947618184611e-5 -5.476990918396041e-5 1.4382281733560376e-5 0.00011062554403906688 -4.55736335425172e-5 -0.00011032635666197166 2.3338576284004375e-5 7.534457108704373e-5 -0.00020907628640998155 -4.1690316720632836e-5 -9.811074414756149e-5 -0.00012368882016744465 -1.8405715309199877e-5 2.7938680432271212e-5 -7.935940084280446e-5 -7.091046427376568e-5 1.0140131962543819e-5 0.00016092340229079127 -3.966648364439607e-5 -6.254858453758061e-5 0.00016073249571491033 3.317677692393772e-5 -1.4677833860332612e-5 -0.000148355306009762 -5.715122460969724e-5 3.357244349899702e-5 -1.4687801922264043e-5 -0.00016377992869820446; -5.225904260441894e-6 0.00012013666128041223 0.0001513455790700391 4.3085899960715324e-5 -2.37618569371989e-5 -0.00011886948050232604 3.0775019695283845e-5 0.00011287628149148077 8.89899383764714e-5 -0.00012981457985006273 -8.597754640504718e-5 0.0001608626771485433 -3.235398480683216e-6 -0.00011332258873153478 -8.425027772318572e-5 0.0001472447329433635 5.5364776926580817e-5 1.5469762729480863e-5 2.9204311431385577e-5 6.177830073283985e-5 -2.7018762921215966e-5 6.395660602720454e-5 -6.687305722152814e-5 0.00015910524234641343 6.063092951080762e-5 0.00013114250032231212 -2.257122832816094e-5 -0.00011456949141575024 -0.00014027257566340268 -7.339259900618345e-5 -7.17822476872243e-5 1.5241967048496008e-5; -2.5296951207565144e-5 4.943887574881956e-7 7.534738688264042e-5 -9.492546087130904e-5 3.458065111772157e-5 -7.105850090738386e-5 4.8657875595381483e-5 -0.00013214866339694709 -0.00016303102893289179 6.555416621267796e-5 7.80836126068607e-6 0.00012275404878892004 -2.0946687072864734e-5 0.00017847950221039355 0.00015571320545859635 3.906471829395741e-5 0.00013938498159404844 -0.00011551028728717938 -0.00010428931273054332 1.482247080275556e-5 0.00011741004709620029 6.503728218376637e-5 -7.120997906895354e-5 -9.61922705755569e-5 4.578019434120506e-5 -0.00011100625852122903 -3.6466644814936444e-5 -7.054146067275724e-7 -0.000173980399267748 -5.458218583953567e-5 -0.00012718803191091865 -5.672515544574708e-5; -3.27984344039578e-5 0.0002148919738829136 0.00010214930807705969 4.7285746404668316e-5 4.396184522192925e-5 -0.0001717487903079018 0.00014916766667738557 0.00017095831572078168 -1.528438224340789e-5 -2.7472984584164806e-5 8.690108370501548e-5 -1.9552355297491886e-5 4.606854417943396e-5 -8.062674169195816e-6 1.1316804375383072e-5 -2.9966971851536073e-5 -0.00013823456538375467 8.652360702399164e-5 -0.00015690726286266 -4.7073594032553956e-5 -3.613503213273361e-5 -4.5571112423203886e-5 0.00011672812252072617 -4.183416604064405e-5 -2.7354530175216496e-5 -2.5083829768846044e-6 -6.01323445152957e-5 -0.00013218495587352663 6.841846334282309e-5 -0.00014789114356972277 5.942908319411799e-5 5.541434802580625e-5; 4.7227844333974645e-5 -7.526620902353898e-5 -6.497696449514478e-5 -0.00030973413959145546 -0.00015652862202841789 5.074861110188067e-5 0.0001870563137345016 -7.706580800004303e-5 4.2940431740134954e-5 0.0002212937397416681 -3.325726356706582e-5 -5.549202614929527e-5 0.00017104005382861942 0.00011630019434960559 5.986782707623206e-5 2.3440870791091584e-5 3.708796066348441e-5 0.00015094208356458694 -2.9890066798543558e-5 -0.0002574438985902816 -7.651737541891634e-5 -0.00017482982366345823 -2.273610698466655e-5 -0.00018205720698460937 8.796792826615274e-5 -7.823467058187816e-6 -3.9730468415655196e-5 -4.188120146864094e-5 -1.1787729818024673e-5 -0.0001506736734881997 1.2022447890558396e-6 -2.728061554080341e-5; 2.1933901734882966e-5 -0.00022303362493403256 6.384874723153189e-5 -2.0328168830019422e-5 -0.0001437963219359517 0.00012101382162654772 -6.561866484844359e-6 -7.508137787226588e-5 -7.398812886094674e-5 0.00014653756807092577 -0.000130107015138492 -1.891462306957692e-5 -7.58654423407279e-5 5.525109372683801e-5 -6.387160829035565e-5 -0.00010598005610518157 3.897836722899228e-5 7.922587974462658e-5 -0.0001530958543298766 -0.00018155749421566725 2.8436188586056232e-5 -7.809707312844694e-5 3.919430309906602e-5 -2.463706005073618e-5 0.00012490141671150923 0.00010815166751854122 4.43493299826514e-5 0.0001641665439819917 0.00017608178313821554 0.00019521833746694028 -0.00010393562843091786 -4.568816802930087e-5; -5.96232530369889e-5 2.130421853507869e-5 7.836445547582116e-6 5.059667455498129e-5 -0.00015515547420363873 7.220395491458476e-5 -0.00012274649634491652 1.6259362382697873e-5 -5.992372280161362e-6 -0.00014925727737136185 0.00011361268116161227 9.846210014075041e-5 4.1385686927242205e-5 -4.517482011578977e-5 -6.444253699555702e-7 -4.0933849959401414e-5 -4.8331927246181294e-5 3.624749297159724e-5 -5.541957580135204e-5 7.31834807083942e-5 -0.0001287838094867766 6.783718708902597e-5 4.113130216865102e-6 -0.0001031985884765163 7.25633290130645e-5 6.0086880694143474e-5 3.871304215863347e-5 3.820753772743046e-5 -1.915183565870393e-5 8.817062916932628e-5 -7.116077904356644e-5 4.878321124124341e-5; -1.9297380049465573e-7 -0.0002539202687330544 3.640757131506689e-5 6.101488907006569e-6 3.16144542011898e-5 3.5446169931674376e-5 7.632073902641423e-6 -8.580085705034435e-5 -1.5120845091587398e-5 -7.550834561698139e-5 0.0001277495175600052 -8.221057942137122e-5 -8.041341789066792e-5 -9.73554706433788e-5 -3.531688707880676e-5 1.0428783753013704e-5 3.025816477020271e-5 -8.032954792724922e-5 4.25310390710365e-5 7.788844231981784e-5 -1.7066531654563732e-5 -2.546464020269923e-5 -5.774357487098314e-5 -4.7827714297454804e-5 -1.9389673980185762e-5 1.1157912013004534e-5 2.0869416403002106e-5 -0.00011501363042043522 -0.00011330776760587469 0.00011979382543358952 -3.9550814108224586e-5 -7.540686056017876e-5; 6.878301792312413e-5 -0.00019514285668265074 -1.3035112715442665e-5 9.616086026653647e-5 -5.919568138779141e-5 4.749794243252836e-5 -1.4496084986603819e-5 -0.0001419642212567851 -0.00014118649414740503 6.753595516784117e-5 7.560140511486679e-5 4.4144322600914165e-5 7.125264528440312e-5 -3.2273961551254615e-5 -5.429029988590628e-5 -1.6579768271185458e-5 5.979273919365369e-5 -2.3815448457753519e-7 1.613841618564038e-6 -7.461060158675537e-5 -2.5812285457504913e-5 -3.279484008089639e-5 -5.143677844898775e-5 0.00016351202793885022 2.561341352702584e-5 -2.2128308046376333e-5 -7.765764894429594e-5 2.9022250600974075e-5 5.796456753159873e-5 -0.00017230914090760052 -7.798208389431238e-5 -2.4630160623928532e-5; -4.111233283765614e-5 -5.779128514404874e-6 -4.238509791321121e-5 -0.00018515133706387132 8.044401329243556e-5 0.00011586743494262919 -1.7141517673735507e-5 -2.153884997824207e-5 0.00011995423847110942 -3.759241008083336e-5 -9.461794252274558e-5 8.231225365307182e-5 -3.9474824006902054e-5 -0.00010271944483974949 -8.860910384100862e-6 6.988444965827512e-6 -2.832043173839338e-5 -0.000123975973110646 -2.3081271137925796e-5 8.62348242662847e-5 -0.00010002467024605721 2.9746457585133612e-5 -0.00017404137179255486 -0.00020783171930816025 1.3181347640056629e-5 0.00015034257376100868 7.324208127101883e-5 0.00011548670590855181 8.097084355540574e-5 0.00012829397746827453 6.236885383259505e-5 -1.950770638359245e-5; 2.5318733605672605e-5 -1.343497569905594e-5 -0.0001491179718868807 -1.8284400482571073e-7 -4.741958764498122e-5 -8.890344179235399e-5 7.929403363959864e-5 0.00014018223737366498 -6.232824671315029e-5 0.00015559871098957956 -1.3864891116099898e-5 -1.4290292710938957e-5 -0.0001897408365039155 1.7086156844925426e-7 0.0001270933571504429 -4.945354885421693e-5 -2.655677053553518e-5 -0.00026410375721752644 2.5068087779800408e-5 -7.521663792431355e-5 -2.358223900955636e-5 5.006093851989135e-5 -0.0001600259856786579 0.00017250792006962 0.0002269707911182195 5.584552127402276e-7 -0.00010813971312018111 8.634947153041139e-5 -3.233176175854169e-5 -4.076824097865028e-6 -4.4882417569169775e-5 -6.909467629157007e-5; -3.9010639738989994e-5 7.279311830643564e-5 3.4852608223445714e-5 -0.00015760808310005814 3.771279443753883e-5 -4.430199260241352e-5 5.034395871916786e-5 -5.884687925572507e-5 -4.0235081542050466e-5 0.00027936408878304064 5.114977102493867e-5 9.908814035952673e-7 -0.00010907887917710468 -0.00017963314894586802 -2.602142922114581e-5 -6.209625098563265e-6 -6.228328857105225e-5 -2.708540159801487e-5 3.167540126014501e-5 8.409927249886096e-5 4.956788689014502e-5 0.0002162414457416162 -7.023104990366846e-5 2.364371994190151e-6 -8.437519863946363e-5 -5.121718459122349e-6 -2.5338325940538198e-5 0.00023220269940793514 5.5855092796264216e-5 -2.7584712370298803e-5 0.00011563883163034916 -0.0002114965463988483; -2.6755731596495025e-5 -2.248801501991693e-5 0.00012122220505261794 7.826163346180692e-5 -0.0001355153799522668 -0.00010362489410908893 4.572943362290971e-5 8.081320629571564e-6 -4.2442148696864024e-5 9.497268183622509e-5 0.00014398149505723268 -1.62703545356635e-5 -0.0002030298492172733 -0.00013213099737185985 -3.7671761674573645e-5 -0.00010728274355642498 1.2317324944888242e-5 2.946354288724251e-5 -8.432393951807171e-5 -0.00010469432891113684 -3.93829723179806e-5 3.7838944990653545e-5 -0.00010970157745759934 -9.580510231899098e-5 -0.00015069822256918997 -2.3271641111932695e-5 9.7812750027515e-5 -9.732163744047284e-5 -6.576391024282202e-5 0.00018945631745737046 9.443683666177094e-5 0.00012563695781864226; 0.0002891524927690625 -0.00010636579099809751 7.764631845930126e-6 -7.020535849733278e-5 -3.275366179877892e-5 0.00014837093476671726 4.232008723192848e-5 0.0001715435937512666 4.276106847100891e-5 6.236366607481614e-5 5.272059206617996e-5 -0.00013456436863634735 -1.3785186638415325e-5 -7.397068111458793e-5 -6.394725642167032e-5 -0.00011326717503834516 -2.4314134861924686e-5 -0.00013279479753691703 -3.0249593692133203e-5 0.0001619297981960699 -0.0001178118764073588 0.00014618445129599422 -0.00012848024198319763 -7.638437818968669e-5 0.00010303942690370604 9.017199772642925e-5 -4.737645576824434e-5 5.630347368423827e-5 -0.00010726664186222479 0.00017067439330276102 7.975423795869574e-5 0.0002090329653583467; -0.0001368295488646254 0.00013837804726790637 4.251282007317059e-5 0.00010409032256575301 -0.00018533495313022286 6.74952389090322e-5 4.276961408322677e-5 -8.632578101241961e-5 2.9633225494762883e-5 3.507083238218911e-5 -4.8518399125896394e-5 -3.3108462957898155e-5 0.00010802155156852677 0.0001353635307168588 0.00014032181934453547 0.00012139851605752483 0.00010250879131490365 5.474459976539947e-5 -6.34491370874457e-5 -4.551512574835215e-6 -0.0001022782307700254 1.3255139492684975e-5 -6.282786489464343e-5 2.8364011086523533e-5 7.689509220654145e-5 -1.6510790374013595e-5 -1.6098934793262742e-5 6.232139185158303e-6 0.00021208819816820323 1.2078039901552984e-7 -1.7071837646653876e-5 0.000127477542264387; 0.0001417901657987386 6.254128675209358e-5 5.1513979997253045e-5 -1.4257931979955174e-5 -2.1821886548423208e-5 0.00011236561113037169 0.00012892528320662677 0.00017404966638423502 1.849343243520707e-5 8.483572310069576e-5 -0.00012367103772703558 -0.0001336350105702877 -7.92046994320117e-5 -0.0001128009898820892 -1.3451951417664532e-5 0.00011241703032283112 -2.5544963136781007e-5 -1.714506470307242e-5 -0.00012757678632624447 -5.968154800939374e-5 2.2000878743710928e-5 -3.194681630702689e-5 -7.612939953105524e-5 0.00016806133498903364 3.215272954548709e-5 6.68963766656816e-5 3.0221912311390042e-5 -7.941865987959318e-6 3.841433863271959e-5 0.00013983712415210903 1.0079792446049396e-5 0.0001067130287992768; 0.00010114064207300544 -6.312572804745287e-5 0.00011783586523961276 8.947349851951003e-5 -0.00013821001630276442 -0.00012064767361152917 -6.68211214360781e-5 9.107022924581543e-5 -0.0001086594711523503 0.00016543199308216572 2.795393629639875e-5 0.0001116625644499436 -0.00017997801478486508 9.731079626362771e-5 6.949558724045346e-7 -4.0358398109674454e-5 -3.835913958027959e-5 8.479693497065455e-5 -3.978699533035979e-5 2.6161447749473155e-5 6.898462743265554e-5 3.211698276572861e-5 0.00016750968643464148 1.2311393220443279e-5 9.015526302391663e-5 3.836248652078211e-5 -1.7658188880886883e-5 -1.4041436770639848e-5 0.00010730670328484848 -0.00021934461256023496 -0.0001552983303554356 -2.304684130649548e-5; -0.00018201678176410496 0.0001115378545364365 2.0421401131898165e-5 -7.94513471191749e-5 9.379925177199766e-5 5.680663525708951e-5 -0.00021890585776418447 -2.636258432175964e-5 2.530491110519506e-5 5.5089894885895774e-5 -0.00014823534002061933 5.3122927056392655e-5 5.9786274505313486e-5 1.352275376120815e-5 3.2965886930469424e-5 0.0001072698287316598 -0.00016661258996464312 6.171976565383375e-5 -7.961373921716586e-5 -3.137894600513391e-5 7.293101225513965e-5 -2.0026018319185823e-6 7.428693788824603e-5 -0.00011775429447880015 0.00012978044105693698 -9.42378756008111e-5 -7.539954367530299e-6 -0.00012910962686873972 -0.0001012609209283255 -5.797100311610848e-5 -0.00011798628838732839 7.8529556049034e-5; 4.276830441085622e-5 -4.8324171075364575e-5 -0.00011535908561199903 6.976663280511275e-5 9.971627150662243e-5 9.664107346907258e-5 -0.00017607543850317597 -2.7686879548127763e-5 2.9345974326133728e-5 -9.572404815116897e-5 1.1637173884082586e-5 -1.1731824997696094e-5 -4.8879021051106974e-5 -0.0002335178287466988 -1.532982241769787e-5 -7.614302012370899e-5 -4.4749573135050014e-5 0.00016954573220573366 -3.525668944348581e-5 -8.850410267768893e-6 -9.592646165401675e-6 7.266988177434541e-6 2.270541517646052e-5 -3.9557759009767324e-5 4.442184217623435e-5 -2.199956179538276e-5 -1.639757101656869e-5 2.6181052817264572e-5 -1.9602064639911987e-5 -7.0935288931650575e-6 -7.225003355415538e-5 1.8151213225792162e-5; -8.584452007198706e-5 0.00016169885930139571 7.849813300708774e-6 5.803778913104907e-5 3.082308467128314e-5 -4.748249193653464e-5 -6.101616600062698e-5 -0.00011666630598483607 -0.0001153851262643002 1.1436624845373444e-5 0.00016305055760312825 -6.206041143741459e-5 1.5041931874293368e-5 0.00011711510887835175 -9.320503886556253e-5 9.783227869775146e-5 0.00011523519060574472 9.387515092385001e-6 -3.6379857192514464e-5 -0.00016561166557949036 5.318845433066599e-5 6.110870162956417e-5 3.46017236552143e-6 -8.507780148647726e-5 2.0845871404162608e-5 7.022543286439031e-5 0.0001314768014708534 6.77467596688075e-6 -0.00013715725799556822 -0.00026329350657761097 3.5925993870478123e-5 9.850606875261292e-5; -0.00014541369455400854 3.2064759579952806e-5 -1.1053672096750233e-5 0.0001834358408814296 5.625243284157477e-5 8.289282413898036e-5 0.0001381402398692444 -3.312873013783246e-5 8.031762990867719e-5 0.00010411672701593488 3.489678056212142e-5 0.00011367378465365618 -0.00013202977424953133 -0.00019910215632990003 -8.387715934077278e-5 -1.3000305443711113e-5 -0.00010202678095083684 3.0091510780039243e-5 -0.00010347237548558041 0.00010090127761941403 -8.799441275186837e-5 -6.039398067514412e-5 0.00010763874161057174 -4.009871554444544e-5 1.0483766345714685e-5 -0.0001548265281599015 9.145125659415498e-6 -1.9223452909500338e-5 -6.669517460977659e-5 -8.873516344465315e-5 2.9736931537627243e-5 -2.2541649741469882e-5; 0.00012242533557582647 -7.15826972736977e-5 -0.00020725061767734587 0.00010283006122335792 -8.79216895555146e-5 -0.0001542924001114443 -4.053620432387106e-5 -0.00016312545631080866 -3.793474388658069e-5 1.908448939502705e-5 -4.0798262489261106e-5 -0.00017095213115680963 0.00012215178867336363 2.9334830742300255e-6 0.0001819721655920148 6.945290806470439e-5 0.00010393522097729146 0.0001849371037678793 7.836749136913568e-5 -8.646301284898072e-5 -0.00010567513527348638 -8.790007655079535e-7 -4.408606037031859e-5 -0.00010462380305398256 -5.8207649999530986e-5 -0.00019652562332339585 1.4928249584045261e-5 2.516612585168332e-5 0.00010070594726130366 5.1715400331886485e-5 -5.759544001193717e-5 0.00012797053204849362; 0.00017046181892510504 1.740032712405082e-5 1.2456198419386055e-5 -0.0001270872598979622 -4.4641332351602614e-5 0.00014573078078683466 -0.0001077935885405168 -3.11968797177542e-5 -7.405709766317159e-5 -8.945379522629082e-5 5.245635111350566e-5 -2.9683653337997384e-5 -4.762485696119256e-5 0.00021756358910351992 -5.114663872518577e-5 8.288300887215883e-5 -0.00012866914039477706 -0.0001384295173920691 -2.6959231036016718e-5 0.00011979271948803216 -0.00019743350276257843 0.00022922104108147323 5.528092515305616e-5 -2.7247802790952846e-5 -9.475580736761913e-5 4.32994456787128e-5 8.666289068059996e-5 -1.9706405510078184e-5 -6.9030313170515e-5 -7.590349559905007e-5 5.707612581318244e-5 5.304631486069411e-6; 8.701987098902464e-6 -6.025995753589086e-5 -3.7817271731910296e-6 4.2049614421557635e-5 -5.7103592553175986e-5 -3.392837606952526e-5 -3.7037742004031315e-5 0.00015324245032388717 -0.00012245278048794717 -0.00018194885342381895 4.056283796671778e-5 2.6914674890576862e-5 -5.490404873853549e-6 1.4972275494073983e-5 -0.00013332774688024074 3.566173108993098e-5 2.4812761694192886e-5 5.3760209993924946e-5 5.3730313084088266e-5 -9.061035962076858e-5 -4.401500700623728e-5 1.4062832633499056e-5 -6.084002961870283e-5 -7.701302092755213e-5 -3.308387385914102e-5 -3.477825521258637e-5 -4.3498508603079244e-5 0.00012687894923146814 -7.156674837460741e-5 -3.1538106668449473e-6 0.0001976654602913186 -1.3793844118481502e-5; 0.00010208835010416806 0.000179598355316557 4.961881131748669e-5 0.0001288185449084267 7.832472329027951e-5 -5.639708979288116e-5 4.418780736159533e-5 -9.800370025914162e-5 5.593467358266935e-5 4.01923171011731e-5 -0.00016684627917129546 -8.418245852226391e-5 0.0001210961418109946 6.153561116661876e-5 2.8626005587284453e-5 -7.501747859350871e-6 -0.0001115712002501823 0.00019573501776903868 3.955801730626263e-5 -2.1973479306325316e-5 -0.000167594087542966 5.0770093366736546e-5 0.00014801703218836337 -5.12419173901435e-5 7.074242603266612e-5 -7.733853999525309e-5 6.426461914088577e-5 -9.444992429052945e-6 -5.6447370297973976e-5 0.0001936795306392014 9.475187835050747e-5 5.419195440481417e-5; 2.504542499082163e-5 -0.00010271443170495331 2.6681318558985367e-5 0.00019145522674079984 -2.052716263278853e-5 0.00019827106734737754 -1.3896509699407034e-5 -4.4932126911589876e-5 -7.59752219892107e-5 3.3556166272319388e-6 -0.0001156394137069583 -2.0613444576156326e-5 -1.6774170944700018e-5 0.00011014372284989804 -0.00011638362047960982 7.5823329098057e-5 -0.00016161696112249047 2.2098238332546316e-5 0.00016069378762040287 4.976022682967596e-5 3.174641460645944e-5 3.3244159567402676e-5 -2.1809157260577194e-5 -4.78286856377963e-5 -9.3508766440209e-5 -8.402048479183577e-6 9.00847589946352e-5 0.00015497053391300142 3.1863277399679646e-5 0.00011795045429607853 3.656067929114215e-5 -3.066638601012528e-5], bias = [0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0;;]), layer_4 = (weight = [5.955048618488945e-5 -9.354967187391594e-5 4.142325633438304e-5 3.691715028253384e-5 6.051526725059375e-5 -6.063918590371031e-6 -5.0950398872373626e-5 4.478980554267764e-5 -0.00014342174108605832 -0.0001845756487455219 7.67853416618891e-5 0.00013358358410187066 0.00019866252841893584 9.851623872236814e-6 -2.9861539587727748e-5 -1.613402127986774e-5 0.00013175708591006696 -1.3891350135963876e-5 0.0001277378323720768 6.934198609087616e-6 -4.626616646419279e-5 -4.1305327613372356e-5 0.0001300364820053801 5.826755295856856e-5 9.727021824801341e-5 -6.990570545895025e-5 -2.071341805276461e-5 -5.874653652426787e-5 2.156120717700105e-5 -4.7256377001758665e-5 9.202529327012599e-6 -0.00016365974443033338; 6.226271943887696e-5 -0.00012689558207057416 -8.537052053725347e-5 4.9561298510525376e-5 -0.00011306632950436324 -0.00010219805699307472 -0.0001758780999807641 6.075490455259569e-5 -0.00020719894382636994 -0.0001261949073523283 0.0002730562991928309 0.00011331702262395993 -4.538710345514119e-5 1.600443647475913e-5 2.9948001611046493e-5 5.9325506299501285e-5 -3.2582385756541044e-5 0.00010932802251772955 -6.95466878823936e-5 -5.0106806156691164e-5 -6.170852429931983e-5 -5.568951746681705e-5 5.787838290416403e-6 0.0001083455208572559 -0.0002944901934824884 9.311119356425479e-5 -1.0413251402496826e-5 6.0612542256421875e-6 -0.00015765498392283916 4.39520699728746e-5 -0.00025146809639409184 5.948770558461547e-5], bias = [0.0; 0.0;;]))
```


Now we define a system of odes which describes motion of point like particle with Newtonian physics, uses


$$
u[1] = \chi
$$


$$
u[2] = \phi
$$


where, $p$, $M$, and $e$ are constants


```julia
function ODE_model(u, nn_params, t)
    χ, ϕ = u
    p, M, e = ode_model_params

    # In this example we know that `st` is am empty NamedTuple hence we can safely ignore
    # it, however, in general, we should use `st` to store the state of the neural network.
    y = 1 .+ first(nn([first(u)], nn_params, st))

    numer = (1 + e * cos(χ))^2
    denom = M * (p^(3 / 2))

    χ̇ = (numer / denom) * y[1]
    ϕ̇ = (numer / denom) * y[2]

    return [χ̇, ϕ̇]
end
```


```
ODE_model (generic function with 1 method)
```


Let us now simulate the neural network model and plot the results. We'll use the untrained neural network parameters to simulate the model.


```julia
prob_nn = ODEProblem(ODE_model, u0, tspan, params)
soln_nn = Array(solve(prob_nn, RK4(); u0, p=params, saveat=tsteps, dt, adaptive=false))
waveform_nn = first(compute_waveform(dt_data, soln_nn, mass_ratio, ode_model_params))

fig = with_theme(theme_web()) do
    fig = Figure()
    ax = CairoMakie.Axis(fig[1, 1]; xlabel="Time", ylabel="Waveform")

    l1 = lines!(ax, tsteps, waveform; linewidth=2, alpha=0.75)
    s1 = scatter!(ax, tsteps, waveform; markershape=:circle, markeralpha=0.25, alpha=0.5)

    l2 = lines!(ax, tsteps, waveform_nn; linewidth=2, alpha=0.75)
    s2 = scatter!(ax, tsteps, waveform_nn; markershape=:circle, markeralpha=0.25, alpha=0.5)

    axislegend(ax, [[l1, s1], [l2, s2]],
        ["Waveform Data", "Waveform Neural Net (Untrained)"]; position=:lb)

    return fig
end
```


![](1_GravitationalWaveForm-35.png)


<a id='Setting-Up-for-Training-the-Neural-Network'></a>

## Setting Up for Training the Neural Network


Next, we define the objective (loss) function to be minimized when training the neural differential equations.


```julia
function loss(θ)
    pred = Array(solve(prob_nn, RK4(); u0, p=θ, saveat=tsteps, dt, adaptive=false))
    pred_waveform = first(compute_waveform(dt_data, pred, mass_ratio, ode_model_params))
    loss = sum(abs2, waveform .- pred_waveform)
    return loss, pred_waveform
end
```


```
loss (generic function with 1 method)
```


Warmup the loss function


```julia
loss(params)
```


```
(0.17813199466804047, [-0.024237125087520375, -0.023453958303418936, -0.02267079151931755, -0.021347465307147463, -0.01945624946212443, -0.016956884869929318, -0.013796500214743665, -0.009906635141905817, -0.0052054845590171, 0.00040248733888436066, 0.007017393642712511, 0.014723040049251708, 0.02353937602981202, 0.03329402723191208, 0.04334348843356183, 0.05191316067198479, 0.05470039282771182, 0.04259882236167533, 0.002059798240425693, -0.06615425664351739, -0.11008438332712418, -0.07631348493005266, -0.007332017811010983, 0.038145267958814386, 0.053748796216036426, 0.05267251637036303, 0.04479482494583147, 0.03495319508087972, 0.025187518079199212, 0.016267585607026822, 0.008419144203137115, 0.0016503728902088747, -0.0041122238789997306, -0.008964232309552723, -0.012999761913649202, -0.01629988083444869, -0.018933814813507116, -0.020955683068605065, -0.02240653062384496, -0.02331510817301612, -0.02369876281988675, -0.023563724139968874, -0.022906264112805802, -0.021710427349175793, -0.019949896282317862, -0.017585683552053272, -0.01456519993197362, -0.010821527255756108, -0.00627240275682579, -0.0008214139925746594, 0.005634979676995574, 0.013192179749690771, 0.021889731967598147, 0.03160783005896708, 0.041812070731368715, 0.05096873163118512, 0.05526697484544593, 0.0463804778072696, 0.010789982165151214, -0.055412048764361274, -0.10808056029323541, -0.08560140826476775, -0.017300437733627376, 0.03299169169391777, 0.05237572726249513, 0.053223429129569504, 0.04615381942066479, 0.03657779576313028, 0.026830592919394384, 0.017822830820624188, 0.009838494357436946, 0.0029224893194272363, -0.002995039961301562, -0.0079941983521396, -0.012176025417627415, -0.015613643132403765, -0.018383726653268075, -0.020534640414831315, -0.022113925288722462, -0.023147130765615097, -0.02365546405627335, -0.02364498071757088, -0.023112302337602333, -0.02204421874173685, -0.02041536135106131, -0.018184738767517413, -0.015306486105646104, -0.011707452562676274, -0.00731348514786267, -0.002019423970755457, 0.004273542507861281, 0.0116768613427788, 0.02024218288345952, 0.029901540837913337, 0.04021141966202372, 0.049860438835780216, 0.055485955171221124, 0.04952693065096227, 0.018792600120805872, -0.04436005573019108, -0.10413742788413705, -0.09375003362423714, -0.027711430048822972, 0.02711413060879442, 0.05054155389536912, 0.053541412960199125, 0.04740630088446418, 0.038159691806549066, 0.02846643073100787, 0.01938290489657327, 0.011278148081482847, 0.004212546517450466, -0.001849475773466364, -0.0070012146414947666, -0.011322157103304371, -0.014902357318702063, -0.017803086452779556, -0.020087008944768024, -0.021791292110729294, -0.022951218268194074, -0.02358299018953091, -0.0236968035293637, -0.02329021814844003, -0.02234885629645635, -0.02085099748359414, -0.018755625649333085, -0.016017988444188058, -0.012565918246339264, -0.008326133558446223, -0.0031923382710364557, 0.002935834878006846, 0.0101777351375852, 0.018602075489227505, 0.028178829764355373, 0.038553915850657684, 0.048607831464201945, 0.05538912502961599, 0.052081755140004876, 0.026023817270652932, -0.03324126960361698, -0.09839953003317457, -0.10049191758393608, -0.03840918730796531, 0.020499827018296377, 0.04820997271559454, 0.05359847117227183, 0.048537641701068994, 0.03969290148323858, 0.030084122614071732, 0.020952760668480043, 0.012729006269398985, 0.005526978654745323, -0.0006862985488216403, -0.005976909506968255, -0.010444749512415748, -0.014161028184807477, -0.0171984289012995, -0.019607673421468224, -0.02144176526626044, -0.022725921047694476, -0.023482141270826182, -0.023719753780513123, -0.023438412773943935, -0.02262516532367535, -0.02125545257895619, -0.019299358152693614, -0.01669948624686, -0.013394606159992233, -0.00931146288352892, -0.004339879220383535, 0.0016234374990355984, 0.008699055360030244, 0.016969476378591666, 0.026446398925220847, 0.03684859282930622, 0.04722852562387234, 0.05501196858941631, 0.05408256753097039, 0.032476589900940316, -0.022295077734708558, -0.09104803469569743, -0.10559983249136065, -0.04920637556802028, 0.013158967758198086, 0.045334899800236854, 0.0533696800838589, 0.04953131363162459, 0.04116462165472379, 0.03168851325203458, 0.02251955980681234, 0.014194284160749287, 0.006856773325051025, 0.0005078423816804671, -0.004933410023464827, -0.009540154886061504, -0.01339510623141615, -0.016560408999150452, -0.019104204182014382, -0.021063250685815528, -0.022472596452495698, -0.02335151698995087, -0.023714138057496118, -0.02355753916736541, -0.02287046804339309, -0.021634741205575764, -0.01981026061016814, -0.017352421609010814, -0.014195038631352522, -0.010267077009883979, -0.005458667909805108, 0.00033547506745524284, 0.007239684560747931, 0.015350983785962837, 0.02470923606897491, 0.03510335685581916, 0.04573994490330237, 0.05438217823444665, 0.05557537995424584, 0.038147183030479426, -0.011703434485314785, -0.08232878830004489, -0.10889193813922395, -0.059871620782853206, 0.005103093973945089, 0.041886883427876616, 0.052821202353680624, 0.050369760744049995, 0.04256934929914497, 0.03326459846166882, 0.024086776447394247, 0.01567008377376452, 0.00820663124181459, 0.0017192165996873657, -0.0038636621615349273, -0.008609734989730247, -0.01260096519847616, -0.015898478712924755, -0.018571263515542922, -0.02065662666887154, -0.022190500687229456, -0.023192863369821515, -0.023679265761030372, -0.023647516458588275, -0.02308760260562958, -0.021982120027616993, -0.020292726232465745, -0.017975558405832752, -0.014965878452712817, -0.011193514983545271, -0.007421151514377581])
```


Now let us define a callback function to store the loss over time


```julia
const losses = Float64[]

function callback(θ, l, pred_waveform)
    push!(losses, l)
    println("Training || Iteration: $(length(losses)) || Loss: $(l)")
    return false
end
```


```
callback (generic function with 1 method)
```


<a id='Training-the-Neural-Network'></a>

## Training the Neural Network


Training uses the BFGS optimizers. This seems to give good results because the Newtonian model seems to give a very good initial guess


```julia
adtype = Optimization.AutoZygote()
optf = Optimization.OptimizationFunction((x, p) -> loss(x), adtype)
optprob = Optimization.OptimizationProblem(optf, params)
res = Optimization.solve(optprob,
    BFGS(; initial_stepnorm=0.01, linesearch=LineSearches.BackTracking());
    callback, maxiters=1000)
```


```
u: ComponentVector{Float64}(layer_1 = Float64[], layer_2 = (weight = [3.807963730646492e-5; -6.412919901768971e-5; -0.00012871017679558133; 0.000110085755295478; 4.265252209733025e-5; 8.253275882448669e-5; 0.00014346002717492603; 5.529345798997005e-5; 2.8293652576375236e-5; -0.0001378179731545402; 0.00017177870904583253; -1.5050333786359116e-5; 0.00013536479673339038; -1.918132693388691e-5; 2.1330659365045088e-5; -0.00016628102457601944; -3.309684689157184e-5; -0.00015040468133506864; 6.712890808557515e-6; -7.498539343936536e-5; 0.00016400382446580094; -5.86139613005455e-5; 2.8640668460848344e-5; -3.19545506499341e-5; 3.99006552242994e-7; 3.0823397537440425e-5; 2.494831096554326e-5; -4.868935775445972e-6; 7.770120282647964e-5; 5.102121212978978e-5; 1.5598361642323982e-5; 7.292844384198745e-5;;], bias = [5.2136401815088993e-17; -9.442182802382156e-17; -1.6245237306061586e-16; 1.2453529220440816e-16; 1.2949042408213369e-17; 4.817326733432075e-17; 1.176265777697029e-16; 8.864423747049372e-17; 2.2679899041472403e-17; -7.035535650924928e-17; -2.608293686733267e-16; 1.2975676552786032e-17; 1.1308130333407384e-16; -1.9620993010476565e-17; 4.334485662548492e-18; -1.713320609693482e-16; 6.082853130961504e-18; -1.6160147982744105e-16; 4.003868534067826e-19; -6.079512643853283e-17; 1.200847550073316e-16; -3.868996296495524e-17; 2.116985016329261e-17; -4.207125679578136e-17; 2.4314519783137185e-20; 2.359832663649843e-17; 1.4634968869385432e-17; -2.7221750113503483e-18; 1.107681170268348e-16; 7.485066210977668e-17; 1.0367146327097282e-17; 1.3409864484683023e-16;;]), layer_3 = (weight = [-0.00015093442324860324 -2.9062415154389918e-5 5.264051524726459e-5 -5.422396988570658e-5 -0.0001362884589921157 -0.00018652172856810175 -9.536634151437759e-5 7.989758033226781e-5 8.91109071803811e-5 4.243573367283328e-5 -0.00010590309956889605 0.00012180120266429842 8.764063259740044e-5 0.0002177680349691374 3.4026971303771546e-5 7.595458610601822e-5 0.00010344600614780272 8.928424231861166e-5 -1.5128338776323885e-5 -2.77544599476284e-6 0.00019369701349795007 5.950641080425638e-5 0.00018585108646811647 1.5772364901292123e-5 -0.00018628098168255988 -0.0001258933856602227 8.97617852447156e-5 -0.00014956824579121772 -0.00013792032531774234 4.136339212572765e-5 1.8479352189840236e-5 0.00016896331235920488; -7.732124560554296e-5 9.311450356343175e-5 -1.3450421299612857e-5 -3.573773630470232e-5 -0.0001866228563971329 2.4869584542634086e-5 -9.551324744650774e-6 8.602424152361383e-6 4.936725543537363e-5 -4.0195097078511954e-5 1.3104602096606532e-5 2.2856826331744045e-6 5.608390331499896e-6 -9.391367404297762e-5 -0.00014813263316447686 -0.00023899534482316482 0.0001890114793992155 -0.00018706261527532395 -0.0001874727464541313 0.00014807069909018882 -8.64822583183966e-5 -8.965835711403412e-6 0.00010541000609244405 3.53309582192936e-5 5.546020822822177e-6 -1.161657711911056e-5 6.300859912024055e-5 0.0002734371513566483 -9.256828399649383e-5 2.114032561241582e-6 0.00010894623063230114 -5.7622710862612025e-5; -3.6803801297716995e-5 -1.373062284364925e-5 8.974422646751214e-5 -4.997029416081627e-5 -5.252603611843145e-5 -6.865943166594753e-5 0.00012941664729331886 1.8726847453582755e-5 8.487645802852345e-5 -6.291613269532664e-5 -0.00010740601598919664 -0.0001047353175392313 -8.629991814196635e-5 -8.601562465009605e-5 4.133836457804446e-5 0.00021675766449951388 -1.1348201472353163e-5 0.00012962715529901112 7.337578838524102e-5 3.0413548545764916e-6 -4.6073000224364375e-5 -1.671985180400829e-5 9.923096197490228e-5 -1.9854918239795527e-5 6.738016648051025e-5 9.300972717647079e-5 0.0001244931959507115 -4.629021666296129e-5 -5.973169343014929e-5 0.00015211957045430785 -2.3684787696035018e-5 1.192497850461227e-5; -0.0001349351535710905 -1.9943597660700952e-7 -3.765261348884187e-5 3.755363800597283e-5 -3.538975792903682e-5 -0.00010449237956631642 -2.791930123488105e-5 -2.7302492842093193e-5 0.00010294207245610317 -3.625832900719101e-5 2.9168737139914456e-5 -5.361759437760782e-6 6.9025879977621e-5 -0.00014510574905867132 -2.7300104509009024e-5 3.0262182602087242e-5 3.6211100134865145e-5 1.743922953471135e-5 1.29148062595451e-5 5.977080368470566e-5 -0.0001904910189724663 2.551418733932947e-5 2.64866772821233e-5 -3.724194025121942e-5 -3.078681251932354e-5 0.0001304987360097995 5.2474258748447716e-5 -1.1425753970939623e-5 -0.00024574433550437704 -0.00014343967118034284 -1.3490105036140148e-5 -0.00010481794228976462; -0.00010362931668326846 0.00013644908297307483 -1.372690228137594e-5 -6.51706347268581e-5 -0.0002480606696478705 -0.00010481638189205927 4.938847025940673e-5 -0.00010222210282493802 -2.927807933859715e-5 -0.00016573543568639706 -2.9609848453858742e-5 6.98181041373241e-5 1.659108541233242e-5 4.615790869890014e-5 5.976886070881282e-5 9.092386001456812e-5 -0.00014234790312160425 -7.693134709526093e-5 8.999157701351878e-5 -2.961815395950024e-5 -7.314071142146158e-5 -8.102265444152434e-5 3.356950522017014e-5 -2.5618798346600285e-5 1.3042126313514536e-6 3.0945412916720994e-5 1.893914425478576e-5 -0.00012804633904282738 7.643960391603304e-5 2.7197259740447626e-5 6.337659968506646e-6 -6.503017236512336e-5; -0.00010867213661263144 1.1998619974430886e-5 5.410703140947882e-5 -5.564202894751428e-5 9.916781907954836e-5 -2.024410407179445e-5 -2.026676686076207e-5 -0.0001222022963891948 2.670911434642387e-6 5.616044489139802e-5 -8.843994675846737e-5 4.1778183166705895e-5 -0.00010134740097858885 0.00013626620255231394 -3.5151899120001985e-5 4.8961390511224724e-5 -6.76529214805219e-5 -7.606749370173149e-5 0.00015891077253322555 4.8119431248008804e-5 -0.0001573872558045219 0.00011249469587633171 -4.243510722594765e-5 1.113150590676867e-5 -5.8696319520869576e-5 -0.00019599156605259002 -0.00011411172983648701 -6.563890003312871e-5 -6.117024697309368e-5 5.465606425709737e-5 -1.0229589698475426e-5 -6.831627907419528e-6; 0.00016856852888292868 0.0001123979469265357 2.4676175220412146e-5 4.5860966187209874e-5 7.128826981340783e-5 -5.477111555239669e-5 1.4381075365129527e-5 0.0001106243376706291 -4.5574839910955864e-5 -0.00011032756303040315 2.3337369915577052e-5 7.534336471860483e-5 -0.0002090774927784133 -4.169152308907166e-5 -9.81119505160003e-5 -0.0001236900265358727 -1.840692167763842e-5 2.7937474063841172e-5 -7.936060721124343e-5 -7.091167064220244e-5 1.013892559411546e-5 0.00016092219592235362 -3.966769001283472e-5 -6.25497909060192e-5 0.00016073128934647135 3.317557055549912e-5 -1.4679040228771347e-5 -0.00014835651237820094 -5.7152430978133834e-5 3.3571237130559066e-5 -1.468900829070293e-5 -0.00016378113506664133; -5.224322954752433e-6 0.0001201382425861003 0.00015134716037572073 4.308748126639924e-5 -2.3760275631509627e-5 -0.00011886789919663936 3.0776601000963356e-5 0.00011287786279716937 8.899151968216118e-5 -0.00012981299854438236 -8.597596509937232e-5 0.00016086425845423342 -3.233817175002527e-6 -0.00011332100742584478 -8.424869641749576e-5 0.00014724631424903933 5.536635823227046e-5 1.5471344035159317e-5 2.9205892737075768e-5 6.177988203852714e-5 -2.7017181615539735e-5 6.395818733289296e-5 -6.687147591583836e-5 0.00015910682365210315 6.0632510816497836e-5 0.0001311440816280019 -2.2569647022471052e-5 -0.00011456791011006007 -0.00014027099435771556 -7.339101770049461e-5 -7.178066638153423e-5 1.5243548354183458e-5; -2.5298416400061652e-5 4.929235649929673e-7 7.53459216901512e-5 -9.492692606380044e-5 3.4579185925225244e-5 -7.105996609987779e-5 4.865641040289419e-5 -0.0001321501285894428 -0.00016303249412538858 6.555270102018987e-5 7.80689606820306e-6 0.00012275258359642296 -2.094815226535312e-5 0.00017847803701789654 0.0001557117402660994 3.90632531014735e-5 0.00013938351640155179 -0.00011551175247966572 -0.0001042907779230405 1.482100561026106e-5 0.000117408581903716 6.50358169912708e-5 -7.121144426145036e-5 -9.619373576805363e-5 4.577872914870785e-5 -0.00011100772371372578 -3.646811000743335e-5 -7.068797992247674e-7 -0.00017398186446024227 -5.458365103203162e-5 -0.00012718949710341571 -5.6726620638241726e-5; -3.279793613492469e-5 0.00021489247215194623 0.00010214980634609031 4.7286244673699664e-5 4.3962343490962314e-5 -0.0001717482920388696 0.00014916816494641553 0.0001709588139898145 -1.5283883974374682e-5 -2.747248631513459e-5 8.690158197404396e-5 -1.9551857028458587e-5 4.606904244846429e-5 -8.062175900162535e-6 1.1317302644416337e-5 -2.9966473582507273e-5 -0.00013823406711472154 8.652410529302128e-5 -0.00015690676459362667 -4.707309576352153e-5 -3.61345338637047e-5 -4.55706141541711e-5 0.00011672862078975939 -4.1833667771610866e-5 -2.7354031906183156e-5 -2.50788470785142e-6 -6.013184624626245e-5 -0.0001321844576044933 6.841896161185543e-5 -0.00014789064530068986 5.942958146315131e-5 5.541484629483873e-5; 4.722528271248407e-5 -7.526877064502728e-5 -6.497952611662253e-5 -0.00030973670121293696 -0.0001565311836499082 5.0746049480394633e-5 0.0001870537521130272 -7.706836962153224e-5 4.293787011864383e-5 0.0002212911781201924 -3.325982518853262e-5 -5.5494587770786904e-5 0.00017103749220714307 0.0001162976327281141 5.9865265454740624e-5 2.3438309169623206e-5 3.708539904199352e-5 0.00015093952194311427 -2.989262842003533e-5 -0.0002574464602117686 -7.651993704038538e-5 -0.00017483238528494713 -2.273866860615766e-5 -0.00018205976860610033 8.796536664466095e-5 -7.826028679678818e-6 -3.973303003714649e-5 -4.188376309013274e-5 -1.1790291439511366e-5 -0.00015067623510968932 1.1996831675642378e-6 -2.7283177162290717e-5; 2.1933389822036133e-5 -0.00022303413684687898 6.38482353186876e-5 -2.0328680742864465e-5 -0.0001437968338487985 0.0001210133097137018 -6.562378397687981e-6 -7.508188978511242e-5 -7.398864077379367e-5 0.00014653705615808184 -0.00013010752705133413 -1.8915134982423958e-5 -7.586595425357188e-5 5.525058181399098e-5 -6.387212020320263e-5 -0.00010598056801802401 3.897785531614538e-5 7.92253678317833e-5 -0.00015309636624272367 -0.0001815580061285134 2.8435676673213672e-5 -7.809758504129343e-5 3.9193791186219075e-5 -2.463757196358309e-5 0.00012490090479866215 0.0001081511556056943 4.4348818069804426e-5 0.00016416603206914464 0.00017608127122536944 0.00019521782555409362 -0.00010393614034376486 -4.568867994214706e-5; -5.962350242770606e-5 2.1303969144361736e-5 7.836196156866176e-6 5.0596425164264995e-5 -0.00015515572359435585 7.220370552386802e-5 -0.00012274674573563212 1.6259112991980838e-5 -5.992621670878583e-6 -0.00014925752676207756 0.00011361243177089738 9.846185075003316e-5 4.13854375365264e-5 -4.517506950650703e-5 -6.446747606728195e-7 -4.0934099350116456e-5 -4.833217663689849e-5 3.624724358088179e-5 -5.541982519206932e-5 7.318323131767737e-5 -0.0001287840588774917 6.783693769830897e-5 4.112880826147882e-6 -0.0001031988378672335 7.256307962234722e-5 6.008663130342626e-5 3.871279276791623e-5 3.820728833671318e-5 -1.915208504942073e-5 8.81703797786092e-5 -7.116102843428369e-5 4.8782961850526555e-5; -1.9624107518708025e-7 -0.00025392353600774397 3.64043040403907e-5 6.0982216323256046e-6 3.1611186926497765e-5 3.544290265698771e-5 7.628806627969547e-6 -8.580412432503503e-5 -1.512411236628052e-5 -7.551161289165498e-5 0.00012774625028534289 -8.221384669606497e-5 -8.041668516534224e-5 -9.735873791807236e-5 -3.532015435350026e-5 1.0425516478349422e-5 3.025489749550991e-5 -8.033281520191892e-5 4.252777179634256e-5 7.78851750451299e-5 -1.7069798929228823e-5 -2.546790747738952e-5 -5.774684214567624e-5 -4.7830981572147694e-5 -1.9392941254879743e-5 1.115464473831157e-5 2.0866149128308792e-5 -0.00011501689769512915 -0.00011331103488056221 0.00011979055815889834 -3.955408138291831e-5 -7.541012783486703e-5; 6.878122643941384e-5 -0.00019514464816635947 -1.3036904199144039e-5 9.615906878283248e-5 -5.919747287150149e-5 4.7496150948821226e-5 -1.4497876470302823e-5 -0.0001419660127404944 -0.00014118828563111567 6.753416368414124e-5 7.559961363117306e-5 4.414253111720315e-5 7.125085380070277e-5 -3.227575303496555e-5 -5.429209136961717e-5 -1.658155975488029e-5 5.979094770994318e-5 -2.399459682753343e-7 1.6120501348529138e-6 -7.46123930704632e-5 -2.581407694120019e-5 -3.279663156460552e-5 -5.143856993269842e-5 0.0001635102364551397 2.561162204331469e-5 -2.2130099530086924e-5 -7.765944042800674e-5 2.9020459117262935e-5 5.796277604789114e-5 -0.0001723109323913101 -7.79838753780234e-5 -2.463195210763655e-5; -4.1112878838507293e-5 -5.779674515255539e-6 -4.238564391405963e-5 -0.00018515188306472057 8.044346729158448e-5 0.00011586688894177902 -1.7142063674583204e-5 -2.1539395979092918e-5 0.00011995369247025817 -3.759295608168135e-5 -9.461848852359166e-5 8.231170765222046e-5 -3.947537000775016e-5 -0.00010271999084060081 -8.861456384952186e-6 6.987898964981084e-6 -2.832097773924459e-5 -0.00012397651911149338 -2.308181713877719e-5 8.623427826543431e-5 -0.00010002521624690377 2.974591158428283e-5 -0.00017404191779340613 -0.0002078322653090115 1.3180801639205221e-5 0.00015034202776015743 7.324153527016753e-5 0.00011548615990770042 8.097029755455542e-5 0.00012829343146742356 6.23683078317437e-5 -1.9508252384442894e-5; 2.531720340089597e-5 -1.343650590383124e-5 -0.00014911950209164983 -1.8437420959701132e-7 -4.742111784975766e-5 -8.890497199712794e-5 7.929250343483155e-5 0.00014018070716888912 -6.232977691792723e-5 0.00015559718078481168 -1.3866421320862507e-5 -1.42918229157162e-5 -0.0001897423667086837 1.6933136367208148e-7 0.00012709182694566577 -4.945507905898047e-5 -2.655830074031199e-5 -0.00026410528742229245 2.5066557575023072e-5 -7.521816812908811e-5 -2.358376921432028e-5 5.005940831511572e-5 -0.00016002751588343485 0.00017250638986484313 0.00022696926091344215 5.569250079633457e-7 -0.00010814124332495816 8.634794132563405e-5 -3.233329196331603e-5 -4.078354302641084e-6 -4.4883947773947e-5 -6.909620649634478e-5; -3.901004118631595e-5 7.279371685910918e-5 3.485320677611677e-5 -0.0001576074845473862 3.771339299021281e-5 -4.430139404974053e-5 5.034455727183813e-5 -5.884628070305135e-5 -4.0234482989376285e-5 0.00027936468733571123 5.115036957760717e-5 9.91479956269548e-7 -0.000109078280624434 -0.0001796325503931937 -2.6020830668471577e-5 -6.209026545894404e-6 -6.228269001837813e-5 -2.7084803045345018e-5 3.167599981281934e-5 8.40998710515342e-5 4.956848544281403e-5 0.00021624204429428984 -7.023045135099428e-5 2.3649705468642746e-6 -8.43746000867893e-5 -5.121119906448211e-6 -2.5337727387864e-5 0.0002322032979606095 5.5855691348937354e-5 -2.758411381762499e-5 0.00011563943018302345 -0.00021149594784617502; -2.675801986197119e-5 -2.2490303285391115e-5 0.00012121991678715302 7.825934519633874e-5 -0.00013551766821774273 -0.00010362718237456111 4.572714535744782e-5 8.079032364096598e-6 -4.244443696234068e-5 9.497039357076199e-5 0.00014397920679177744 -1.6272642801140572e-5 -0.00020303213748273685 -0.00013213328563733683 -3.7674049940050554e-5 -0.00010728503182188157 1.2315036679411808e-5 2.946125462178215e-5 -8.432622778354895e-5 -0.0001046966171766099 -3.938526058343777e-5 3.7836656725178865e-5 -0.00010970386572307601 -9.580739058446746e-5 -0.00015070051083466724 -2.3273929377409238e-5 9.781046176203821e-5 -9.732392570595009e-5 -6.576619850829477e-5 0.00018945402919189514 9.443454839629388e-5 0.00012563466955316897; 0.0002891549140430687 -0.00010636336972409354 7.767053119924209e-6 -7.020293722333514e-5 -3.275124052477313e-5 0.0001483733560407191 4.232250850591937e-5 0.00017154601502527146 4.2763489745015514e-5 6.236608734880827e-5 5.2723013340163755e-5 -0.00013456194736234024 -1.378276536442264e-5 -7.396825984058097e-5 -6.394483514766342e-5 -0.00011326475376435988 -2.4311713587918313e-5 -0.00013279237626292773 -3.0247172418125997e-5 0.00016193221947007267 -0.00011780945513337292 0.00014618687256999879 -0.00012847782070919098 -7.638195691568027e-5 0.00010304184817771328 9.017441900043575e-5 -4.737403449423759e-5 5.630589495824549e-5 -0.00010726422058822233 0.00017067681457676623 7.97566592327028e-5 0.00020903538663234977; -0.00013682606147544775 0.000138381534657081 4.25163074623309e-5 0.00010409380995491844 -0.00018533146574104564 6.74987262982037e-5 4.2773101472382484e-5 -8.632229362324379e-5 2.9636712883941273e-5 3.5074319771346646e-5 -4.8514911736750886e-5 -3.31049755687191e-5 0.0001080250389576851 0.00013536701810603767 0.00014032530673371426 0.00012140200344667245 0.0001025122787040817 5.474808715455285e-5 -6.344564969826643e-5 -4.548025185662351e-6 -0.00010227474338087692 1.3258626881860347e-5 -6.282437750546505e-5 2.8367498475701666e-5 7.689857959572076e-5 -1.650730298483538e-5 -1.609544740408415e-5 6.235626574337583e-6 0.0002120916855573756 1.2426778819185517e-7 -1.7068350257474852e-5 0.00012748102965356024; 0.00014179298024288465 6.254410119623718e-5 5.151679444138512e-5 -1.4255117535818985e-5 -2.1819072104277494e-5 0.00011236842557451281 0.00012892809765075513 0.00017405248082837961 1.8496246879353722e-5 8.48385375448256e-5 -0.00012366822328291547 -0.00013363219612614049 -7.920188498788123e-5 -0.00011279817543794215 -1.3449136973517555e-5 0.00011241984476695295 -2.5542148692634625e-5 -1.7142250258945948e-5 -0.0001275739718820971 -5.9678733565251546e-5 2.2003693187833447e-5 -3.194400186288267e-5 -7.61265850869086e-5 0.00016806414943318007 3.215554398963449e-5 6.689919110982813e-5 3.0224726755536858e-5 -7.939051543811941e-6 3.8417153076861396e-5 0.00013983993859625402 1.0082606890196566e-5 0.00010671584324341929; 0.00010114154205863237 -6.312482806182672e-5 0.00011783676522523524 8.947439850513384e-5 -0.0001382091163171376 -0.00012064677362590381 -6.68202214504568e-5 9.10711292314419e-5 -0.00010865857116672319 0.00016543289306778753 2.7954836282017435e-5 0.0001116634644355709 -0.00017997711479924308 9.731169624925496e-5 6.958558580317663e-7 -4.035749812405524e-5 -3.835823959465255e-5 8.479783495627524e-5 -3.978609534473244e-5 2.6162347735098865e-5 6.8985527418275e-5 3.2117882751354955e-5 0.0001675105864202686 1.2312293206070344e-5 9.015616300954398e-5 3.836338650640919e-5 -1.76572888952597e-5 -1.4040536785012486e-5 0.0001073076032704741 -0.00021934371257460836 -0.00015529743036980833 -2.304594132086968e-5; -0.0001820189974849947 0.00011153563881554874 2.041918541101948e-5 -7.945356284005683e-5 9.379703605110822e-5 5.680441953620371e-5 -0.00021890807348506027 -2.6364800042648186e-5 2.530269538430488e-5 5.508767916501885e-5 -0.00014823755574148856 5.312071133550206e-5 5.978405878443607e-5 1.352053804031765e-5 3.296367120957898e-5 0.00010726761301078921 -0.00016661480568553314 6.171754993295949e-5 -7.96159549380566e-5 -3.1381161726020586e-5 7.292879653426849e-5 -2.004817552806846e-6 7.428472216735586e-5 -0.00011775651019969017 0.00012977822533604617 -9.424009132170116e-5 -7.542170088420614e-6 -0.0001291118425896305 -0.00010126313664921185 -5.797321883699736e-5 -0.00011798850410821898 7.852734032814712e-5; 4.2766143651227825e-5 -4.83263318349911e-5 -0.00011536124637161683 6.976447204549181e-5 9.97141107469943e-5 9.663891270944793e-5 -0.000176077599262791 -2.768904030775502e-5 2.9343813566504885e-5 -9.572620891078506e-5 1.1635013124473845e-5 -1.173398575732534e-5 -4.888118181072355e-5 -0.00023351998950632793 -1.5331983177326956e-5 -7.614518088331902e-5 -4.475173389467865e-5 0.00016954357144612008 -3.5258850203115186e-5 -8.85257102739436e-6 -9.594806925012242e-6 7.2648274178075436e-6 2.2703254416831694e-5 -3.955991976939602e-5 4.441968141660494e-5 -2.2001722555011498e-5 -1.6399731776197655e-5 2.6178892057635184e-5 -1.9604225399537153e-5 -7.095689652792638e-6 -7.225219431378463e-5 1.814905246616649e-5; -8.584452074525172e-5 0.00016169885862813102 7.849812627444111e-6 5.803778845778441e-5 3.082308399801848e-5 -4.74824926097993e-5 -6.101616667389164e-5 -0.00011666630665810072 -0.00011538512693756485 1.1436624172108781e-5 0.0001630505569298636 -6.206041211067924e-5 1.5041931201028705e-5 0.0001171151082050871 -9.320503953882718e-5 9.783227802448681e-5 0.00011523518993248007 9.387514419120342e-6 -3.6379857865779124e-5 -0.00016561166625275506 5.318845365740134e-5 6.110870095629951e-5 3.4601716922567617e-6 -8.507780215974191e-5 2.0845870730897938e-5 7.022543219112566e-5 0.0001314768007975887 6.7746752936160815e-6 -0.0001371572586688329 -0.00026329350725087564 3.5925993197213464e-5 9.850606807934827e-5; -0.0001454147662444887 3.206368788947359e-5 -1.1054743787225066e-5 0.0001834347691909532 5.625136115109474e-5 8.289175244850207e-5 0.00013813916817877097 -3.312980182831205e-5 8.03165582181968e-5 0.0001041156553254609 3.489570887165115e-5 0.00011367271296317559 -0.00013203084594000554 -0.00019910322802038058 -8.387823103125329e-5 -1.300137713418204e-5 -0.00010202785264131713 3.0090439089566544e-5 -0.00010347344717606108 0.00010090020592893532 -8.799548444233956e-5 -6.0395052365623584e-5 0.00010763766992009136 -4.009978723492575e-5 1.0482694655234014e-5 -0.0001548275998503818 9.144053968935047e-6 -1.9224524599981003e-5 -6.669624630025515e-5 -8.873623513513292e-5 2.9735859847146652e-5 -2.2542721431948677e-5; 0.00012242397330172915 -7.158405954779382e-5 -0.0002072519799514364 0.00010282869894926543 -8.792305182961173e-5 -0.00015429376238553917 -4.0537566597959755e-5 -0.00016312681858490525 -3.7936106160678254e-5 1.9083127120937647e-5 -4.079962476334578e-5 -0.00017095349343090744 0.0001221504263992739 2.932120800132258e-6 0.00018197080331791706 6.945154579061885e-5 0.00010393385870319402 0.00018493574149379153 7.836612909503775e-5 -8.646437512307613e-5 -0.00010567649754757223 -8.803630396043439e-7 -4.408742264441614e-5 -0.00010462516532808004 -5.820901227362892e-5 -0.00019652698559749338 1.4926887309947608e-5 2.5164763577585396e-5 0.00010070458498720843 5.171403805778972e-5 -5.759680228603499e-5 0.00012796916977439804; 0.00017046144752309918 1.7399955722045253e-5 1.2455827017382005e-5 -0.00012708763129996677 -4.464170375360846e-5 0.0001457304093848294 -0.00010779395994252036 -3.119725111975988e-5 -7.405746906517758e-5 -8.945416662829458e-5 5.245597971150318e-5 -2.968402474000342e-5 -4.7625228363196394e-5 0.0002175632177015139 -5.114701012719177e-5 8.288263747015614e-5 -0.00012866951179678297 -0.00013842988879407244 -2.6959602438022777e-5 0.00011979234808602678 -0.00019743387416458122 0.0002292206696794676 5.528055375105021e-5 -2.724817419295879e-5 -9.475617876962521e-5 4.3299074276706855e-5 8.666251927859395e-5 -1.9706776912084248e-5 -6.903068457252033e-5 -7.590386700105584e-5 5.707575441117642e-5 5.304260084063996e-6; 8.700647546379271e-6 -6.026129708841287e-5 -3.783066725707543e-6 4.2048274869039166e-5 -5.710493210569902e-5 -3.3929715622046084e-5 -3.703908155654605e-5 0.00015324111077136466 -0.0001224541200404707 -0.00018195019297633438 4.0561498414206994e-5 2.691333533805313e-5 -5.491744426369286e-6 1.4970935941550313e-5 -0.0001333290864327644 3.566039153741936e-5 2.4811422141669538e-5 5.375887044141111e-5 5.372897353156445e-5 -9.061169917328995e-5 -4.4016346558749234e-5 1.406149308097674e-5 -6.084136917122631e-5 -7.701436048007552e-5 -3.308521341166486e-5 -3.477959476510979e-5 -4.349984815560281e-5 0.00012687760967894428 -7.156808792712861e-5 -3.1551502193676308e-6 0.0001976641207387948 -1.3795183671002987e-5; 0.00010209225626393402 0.00017960226147631955 4.962271747723342e-5 0.00012882245106817907 7.8328629450045e-5 -5.639318363312202e-5 4.419171352133694e-5 -9.799979409937771e-5 5.593857974243614e-5 4.019622326091674e-5 -0.00016684237301156518 -8.417855236249639e-5 0.0001211000479707391 6.153951732638611e-5 2.8629911747051674e-5 -7.497841699618253e-6 -0.00011156729409041589 0.00019573892392877768 3.956192346603038e-5 -2.1969573146564672e-5 -0.0001675901813832324 5.077399952649998e-5 0.00014802093834813014 -5.123801123037699e-5 7.074633219243394e-5 -7.733463383548649e-5 6.426852530065279e-5 -9.441086269285176e-6 -5.644346413821385e-5 0.00019368343679896592 9.475578451027498e-5 5.4195860564575206e-5; 2.5047379072160254e-5 -0.00010271247762361641 2.668327264031419e-5 0.00019145718082213157 -2.0525208551450144e-5 0.0001982730214287127 -1.389455561808081e-5 -4.4930172830252285e-5 -7.597326790787167e-5 3.357570708559191e-6 -0.00011563745962563787 -2.061149049481691e-5 -1.6772216863372337e-5 0.00011014567693123734 -0.00011638166639827057 7.582528317937863e-5 -0.00016161500704115161 2.210019241387122e-5 0.0001606957417017424 4.976218091101187e-5 3.174836868778156e-5 3.3246113648740016e-5 -2.180720317923816e-5 -4.7826731556457385e-5 -9.350681235886946e-5 -8.400094397844628e-6 9.008671307597433e-5 0.00015497248799434097 3.1865231481015305e-5 0.0001179524083774164 3.656263337248156e-5 -3.066443192878915e-5], bias = [1.6940307408475592e-9; -1.4848568927830322e-9; 1.9249699141541424e-9; -3.145348415223685e-9; -3.192937344232049e-9; -2.471843664834736e-9; -1.2063684389794445e-9; 1.581305690215956e-9; -1.465192497206514e-9; 4.982690333404976e-10; -2.56162149180832e-9; -5.119128470793982e-10; -2.4939071728629065e-10; -3.2672746939820765e-9; -1.7914837111514554e-9; -5.460008514044866e-10; -1.5302047773565755e-9; 5.985526743252603e-10; -2.28826547725056e-9; 2.421274007241014e-9; 3.487389179308811e-9; 2.8144441473962837e-9; 8.99985627365734e-10; -2.2157208907689917e-9; -2.1607596294035636e-9; -6.732646679748069e-13; -1.0716904806708177e-9; -1.3622740979328615e-9; -3.7140200606041935e-10; -1.3395525238340064e-9; 3.906159767801244e-9; 1.954081339565226e-9;;]), layer_4 = (weight = [-0.0006419578732739887 -0.0007950580426578635 -0.0006600850882688314 -0.0006645910764139705 -0.000640992958889968 -0.0007075722171175325 -0.0007524587846473439 -0.0006567185606211761 -0.0008449301127106782 -0.000886084057076217 -0.000624722946119478 -0.0005679248243329283 -0.000502845883740814 -0.0006916565871138517 -0.0007313698911350098 -0.0007176424288137409 -0.0005697512849415372 -0.000715399756477499 -0.0005737704863431797 -0.0006945741043413292 -0.0007477743471995482 -0.0007428135895652451 -0.0005714719165107338 -0.0006432407677109804 -0.000604238112105099 -0.0007714141187198507 -0.0007222218094024904 -0.0007602549138635516 -0.00067994720353371 -0.0007487647555007189 -0.000692305603860144 -0.0008651680806430633; 0.00032198668767511544 0.00013282839034504715 0.00017435344222063612 0.00030928521778387537 0.00014665758956271708 0.00015752588877383135 8.384587796243455e-5 0.00032047887526198975 5.252502890007706e-5 0.0001335290789089507 0.0005327802409922874 0.0003730410089230289 0.00021433688421782903 0.0002757283499561728 0.00028967196693148125 0.00031904949226659485 0.00022714158668039387 0.0003690520080451046 0.000190177265324826 0.00020961714124084015 0.00019801537803095144 0.00020403441481351288 0.0002655118209311038 0.0003680694747874753 -3.476623598160554e-5 0.00035283518164339127 0.0002493107285962036 0.00026578522905802867 0.00010206900321579283 0.00030367604523273494 8.25578839664733e-6 0.0003192116652538241], bias = [-0.00070150841326091; 0.0002597239880791402;;]))
```


<a id='Visualizing-the-Results'></a>

## Visualizing the Results


Let us now plot the loss over time


```julia
fig = with_theme(theme_web()) do
    fig = Figure()
    ax = CairoMakie.Axis(fig[1, 1]; xlabel="Iteration", ylabel="Loss")

    lines!(ax, losses; linewidth=2, alpha=0.75)

    return fig
end
```


![](1_GravitationalWaveForm-48.png)


Finally let us visualize the results


```julia
prob_nn = ODEProblem(ODE_model, u0, tspan, res.u)
soln_nn = Array(solve(prob_nn, RK4(); u0, p=res.u, saveat=tsteps, dt, adaptive=false))
waveform_nn_trained = first(compute_waveform(dt_data, soln_nn, mass_ratio,
    ode_model_params))

fig = with_theme(theme_web()) do
    fig = Figure()
    ax = CairoMakie.Axis(fig[1, 1]; xlabel="Time", ylabel="Waveform")

    l1 = lines!(ax, tsteps, waveform; linewidth=2, alpha=0.75)
    s1 = scatter!(ax, tsteps, waveform; markershape=:circle, markeralpha=0.25, alpha=0.5)

    l2 = lines!(ax, tsteps, waveform_nn; linewidth=2, alpha=0.75)
    s2 = scatter!(ax, tsteps, waveform_nn; markershape=:circle, markeralpha=0.25, alpha=0.5)

    l3 = lines!(ax, tsteps, waveform_nn_trained; linewidth=2, alpha=0.75)
    s3 = scatter!(ax, tsteps, waveform_nn_trained; markershape=:circle, markeralpha=0.25,
        alpha=0.5)

    axislegend(ax, [[l1, s1], [l2, s2], [l3, s3]],
        ["Waveform Data", "Waveform Neural Net (Untrained)", "Waveform Neural Net"];
        position=:lb)

    return fig
end
```


![](1_GravitationalWaveForm-50.png)


---


*This page was generated using [Literate.jl](https://github.com/fredrikekre/Literate.jl).*

