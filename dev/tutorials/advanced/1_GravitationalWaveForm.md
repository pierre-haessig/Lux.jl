


<a id='Training-a-Neural-ODE-to-Model-Gravitational-Waveforms'></a>

# Training a Neural ODE to Model Gravitational Waveforms


This code is adapted from [Astroinformatics/ScientificMachineLearning](https://github.com/Astroinformatics/ScientificMachineLearning/blob/c93aac3a460d70b4cce98836b677fd9b732e94b7/neuralode_gw.ipynb)


The code has been minimally adapted from [Keith et. al. 2021](https://arxiv.org/abs/2102.12695) which originally used Flux.jl


<a id='Package-Imports'></a>

## Package Imports


```julia
using Lux, ComponentArrays, LineSearches, LuxAMDGPU, LuxCUDA, OrdinaryDiffEq,
    Optimization, OptimizationOptimJL, Random, SciMLSensitivity
using CairoMakie, MakiePublication
CUDA.allowscalar(false)
```


<a id='Define-some-Utility-Functions'></a>

## Define some Utility Functions


::: tip


This section can be skipped. It defines functions to simulate the model, however, from a scientific machine learning perspective, isn't super relevant.


:::


We need a very crude 2-body path. Assume the 1-body motion is a newtonian 2-body position vector $r = r_1 - r_2$ and use Newtonian formulas to get $r_1$, $r_2$ (e.g. Theoretical Mechanics of Particles and Continua 4.3)


```julia
function one2two(path, m₁, m₂)
    M = m₁ + m₂
    r₁ = m₂ / M .* path
    r₂ = -m₁ / M .* path
    return r₁, r₂
end
```


```
one2two (generic function with 1 method)
```


Next we define a function to perform the change of variables: $(\chi(t),\phi(t)) \mapsto (x(t),y(t))$


```julia
@views function soln2orbit(soln, model_params=nothing)
    @assert size(soln, 1) ∈ [2, 4] "size(soln,1) must be either 2 or 4"

    if size(soln, 1) == 2
        χ = soln[1, :]
        ϕ = soln[2, :]

        @assert length(model_params)==3 "model_params must have length 3 when size(soln,2) = 2"
        p, M, e = model_params
    else
        χ = soln[1, :]
        ϕ = soln[2, :]
        p = soln[3, :]
        e = soln[4, :]
    end

    r = p ./ (1 .+ e .* cos.(χ))
    x = r .* cos.(ϕ)
    y = r .* sin.(ϕ)

    orbit = vcat(x', y')
    return orbit
end
```


```
soln2orbit (generic function with 2 methods)
```


This function uses second-order one-sided difference stencils at the endpoints; see https://doi.org/10.1090/S0025-5718-1988-0935077-0


```julia
function d_dt(v::AbstractVector, dt)
    a = -3 / 2 * v[1] + 2 * v[2] - 1 / 2 * v[3]
    b = (v[3:end] .- v[1:(end - 2)]) / 2
    c = 3 / 2 * v[end] - 2 * v[end - 1] + 1 / 2 * v[end - 2]
    return [a; b; c] / dt
end
```


```
d_dt (generic function with 1 method)
```


This function uses second-order one-sided difference stencils at the endpoints; see https://doi.org/10.1090/S0025-5718-1988-0935077-0


```julia
function d2_dt2(v::AbstractVector, dt)
    a = 2 * v[1] - 5 * v[2] + 4 * v[3] - v[4]
    b = v[1:(end - 2)] .- 2 * v[2:(end - 1)] .+ v[3:end]
    c = 2 * v[end] - 5 * v[end - 1] + 4 * v[end - 2] - v[end - 3]
    return [a; b; c] / (dt^2)
end
```


```
d2_dt2 (generic function with 1 method)
```


Now we define a function to compute the trace-free moment tensor from the orbit


```julia
function orbit2tensor(orbit, component, mass=1)
    x = orbit[1, :]
    y = orbit[2, :]

    Ixx = x .^ 2
    Iyy = y .^ 2
    Ixy = x .* y
    trace = Ixx .+ Iyy

    if component[1] == 1 && component[2] == 1
        tmp = Ixx .- trace ./ 3
    elseif component[1] == 2 && component[2] == 2
        tmp = Iyy .- trace ./ 3
    else
        tmp = Ixy
    end

    return mass .* tmp
end

function h_22_quadrupole_components(dt, orbit, component, mass=1)
    mtensor = orbit2tensor(orbit, component, mass)
    mtensor_ddot = d2_dt2(mtensor, dt)
    return 2 * mtensor_ddot
end

function h_22_quadrupole(dt, orbit, mass=1)
    h11 = h_22_quadrupole_components(dt, orbit, (1, 1), mass)
    h22 = h_22_quadrupole_components(dt, orbit, (2, 2), mass)
    h12 = h_22_quadrupole_components(dt, orbit, (1, 2), mass)
    return h11, h12, h22
end

function h_22_strain_one_body(dt::T, orbit) where {T}
    h11, h12, h22 = h_22_quadrupole(dt, orbit)

    h₊ = h11 - h22
    hₓ = T(2) * h12

    scaling_const = √(T(π) / 5)
    return scaling_const * h₊, -scaling_const * hₓ
end

function h_22_quadrupole_two_body(dt, orbit1, mass1, orbit2, mass2)
    h11_1, h12_1, h22_1 = h_22_quadrupole(dt, orbit1, mass1)
    h11_2, h12_2, h22_2 = h_22_quadrupole(dt, orbit2, mass2)
    h11 = h11_1 + h11_2
    h12 = h12_1 + h12_2
    h22 = h22_1 + h22_2
    return h11, h12, h22
end

function h_22_strain_two_body(dt::T, orbit1, mass1, orbit2, mass2) where {T}
    # compute (2,2) mode strain from orbits of BH 1 of mass1 and BH2 of mass 2

    @assert abs(mass1 + mass2 - 1.0)<1e-12 "Masses do not sum to unity"

    h11, h12, h22 = h_22_quadrupole_two_body(dt, orbit1, mass1, orbit2, mass2)

    h₊ = h11 - h22
    hₓ = T(2) * h12

    scaling_const = √(T(π) / 5)
    return scaling_const * h₊, -scaling_const * hₓ
end

function compute_waveform(dt::T, soln, mass_ratio, model_params=nothing) where {T}
    @assert mass_ratio≤1 "mass_ratio must be <= 1"
    @assert mass_ratio≥0 "mass_ratio must be non-negative"

    orbit = soln2orbit(soln, model_params)
    if mass_ratio > 0
        m₂ = inv(T(1) + mass_ratio)
        m₁ = mass_ratio * m₂

        orbit₁, orbit₂ = one2two(orbit, m₁, m₂)
        waveform = h_22_strain_two_body(dt, orbit1, mass1, orbit2, mass2)
    else
        waveform = h_22_strain_one_body(dt, orbit)
    end
    return waveform
end
```


```
compute_waveform (generic function with 2 methods)
```


<a id='Simulating-the-True-Model'></a>

## Simulating the True Model


`RelativisticOrbitModel` defines system of odes which describes motion of point like particle in schwarzschild background, uses


$$
u[1] = \chi
$$


$$
u[2] = \phi
$$


where, $p$, $M$, and $e$ are constants


```julia
function RelativisticOrbitModel(u, (p, M, e), t)
    χ, ϕ = u

    numer = (p - 2 - 2 * e * cos(χ)) * (1 + e * cos(χ))^2
    denom = sqrt((p - 2)^2 - 4 * e^2)

    χ̇ = numer * sqrt(p - 6 - 2 * e * cos(χ)) / (M * (p^2) * denom)
    ϕ̇ = numer / (M * (p^(3 / 2)) * denom)

    return [χ̇, ϕ̇]
end

mass_ratio = 0.0         # test particle
u0 = Float64[π, 0.0]     # initial conditions
datasize = 250
tspan = (0.0f0, 6.0f4)   # timespace for GW waveform
tsteps = range(tspan[1], tspan[2]; length=datasize)  # time at each timestep
dt_data = tsteps[2] - tsteps[1]
dt = 100.0
const ode_model_params = [100.0, 1.0, 0.5]; # p, M, e
```


Let's simulate the true model and plot the results using `OrdinaryDiffEq.jl`


```julia
prob = ODEProblem(RelativisticOrbitModel, u0, tspan, ode_model_params)
soln = Array(solve(prob, RK4(); saveat=tsteps, dt, adaptive=false))
waveform = first(compute_waveform(dt_data, soln, mass_ratio, ode_model_params))

fig = with_theme(theme_web()) do
    fig = Figure()
    ax = CairoMakie.Axis(fig[1, 1]; xlabel="Time", ylabel="Waveform")

    l = lines!(ax, tsteps, waveform; linewidth=2, alpha=0.75)
    s = scatter!(ax, tsteps, waveform; markershape=:circle, markeralpha=0.25, alpha=0.5)

    axislegend(ax, [[l, s]], ["Waveform Data"])

    return fig
end
```


![](1_GravitationalWaveForm-24.png)


<a id='Defiing-a-Neural-Network-Model'></a>

## Defiing a Neural Network Model


Next, we define the neural network model that takes 1 input (time) and has two outputs. We'll make a function `ODE_model` that takes the initial conditions, neural network parameters and a time as inputs and returns the derivatives.


It is typically never recommended to use globals but incase you do use them, make sure to mark them as `const`.


We will deviate from the standard Neural Network initialization and use `WeightInitializers.jl`,


```julia
const nn = Chain(Base.Fix1(broadcast, cos),
    Dense(1 => 32, cos; init_weight=truncated_normal(; std=1e-4)),
    Dense(32 => 32, cos; init_weight=truncated_normal(; std=1e-4)),
    Dense(32 => 2; init_weight=truncated_normal(; std=1e-4)))
ps, st = Lux.setup(MersenneTwister(), nn)
```


```
((layer_1 = NamedTuple(), layer_2 = (weight = Float32[-7.155509f-5; -0.00010446948; 0.00010252016; -4.8601374f-5; 2.8771885f-5; -4.0343875f-5; -0.00016620927; 6.7962f-5; -1.4444782f-5; 8.310581f-5; 0.00022202225; 2.5437757f-5; 0.00010417162; -3.0584244f-5; 0.00015150856; -0.000115195784; 2.9612213f-5; 0.00015001238; -0.00025686415; -8.352951f-5; 0.00012459634; 4.763888f-5; 4.944892f-5; 2.3762103f-5; -8.0352285f-5; 5.1717892f-5; 3.9890838f-5; 4.7659046f-6; -5.1250096f-5; -4.9361046f-5; 6.263568f-5; -3.5069686f-5;;], bias = Float32[0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0;;]), layer_3 = (weight = Float32[0.00016788972 -7.281037f-5 -3.4757526f-5 -4.6406458f-5 5.356927f-5 -0.00012610876 -5.287077f-5 -9.425129f-5 -6.496856f-6 -8.114437f-5 0.00010337622 8.159548f-5 1.3262193f-5 -6.066135f-5 -0.00018410973 7.8721474f-5 8.232941f-5 -6.55711f-5 6.718167f-5 2.9512728f-5 0.00012258848 3.8734717f-5 -8.8819004f-5 0.00017601324 -0.00020038277 4.960322f-7 6.190355f-5 2.2029257f-5 0.00015630269 -1.7592947f-6 4.503492f-5 0.00017044164; -1.34948305f-5 8.3498424f-5 5.8667618f-5 0.00010080603 5.641394f-5 -3.575578f-5 2.9119816f-5 3.7490867f-5 0.00019686994 -2.5702275f-6 4.1288895f-5 -0.00012270182 -2.5620608f-5 -6.214475f-6 -0.00012207062 -8.7041226f-5 9.366582f-5 -0.00016186254 -3.289494f-5 -9.051174f-5 -1.6249976f-5 2.7186468f-5 -5.301113f-5 -6.971667f-5 5.9242542f-5 -8.89369f-5 -3.3880333f-5 0.000119379176 1.433286f-5 2.0321671f-5 -0.00012577524 0.00012691745; 7.700417f-5 4.411135f-5 -8.2937826f-5 -3.735043f-5 3.1359832f-5 0.00024315657 0.00015689027 9.186047f-5 1.9125815f-5 0.00014442259 -0.00023981353 7.72514f-5 7.126304f-5 -0.00016185766 0.00017890873 -0.000112250294 4.4102526f-5 0.00015077491 7.847482f-5 5.2266932f-5 -3.5819397f-5 6.3105595f-5 -8.1741084f-5 -5.1414645f-5 -0.00010237073 0.0001055519 1.2070859f-6 6.120078f-5 -6.2584863f-6 -3.9693416f-5 -0.00018983637 -4.893853f-5; -9.067773f-5 0.0001145514 0.00023800277 -5.691134f-5 -0.00010857205 1.2847055f-5 -0.000117352385 3.4836034f-5 -0.00010811178 2.7914166f-5 9.360676f-5 4.9558697f-5 0.00026346705 1.02427675f-5 2.2013339f-5 -1.3034902f-5 -7.647358f-6 -4.0469353f-5 7.135664f-5 -3.994996f-5 -5.7457863f-5 -0.00015199384 0.00017758104 5.7156292f-5 -7.273179f-5 -9.888223f-5 2.466355f-5 -7.719025f-5 1.9181327f-5 5.888547f-5 5.012903f-5 3.4982045f-6; 1.8229015f-5 6.711406f-5 7.4552714f-5 -0.00010517778 -1.3497152f-5 2.4281173f-5 2.8175611f-5 5.5528104f-5 6.067446f-5 6.809701f-5 0.0001830965 -1.4514928f-5 -1.9245126f-5 6.1808976f-5 0.00016741217 9.618378f-5 -4.015764f-7 3.5716792f-5 6.5342945f-5 -0.00012383472 -1.9084306f-5 -9.305732f-5 9.140672f-5 4.5719546f-5 -3.234036f-5 -3.2214408f-5 3.183264f-7 -2.3436883f-6 6.5830616f-5 0.00017748121 -9.534073f-5 -0.00012482936; 8.519204f-5 8.130071f-5 0.00015394464 9.720128f-5 -2.5115083f-5 -0.00010094827 0.00013726165 0.00018363744 -3.6977617f-5 -0.00011249857 8.898133f-5 2.7029051f-5 0.00019729145 0.00013460244 0.00010912629 9.109244f-5 -1.6228782f-5 7.258857f-5 3.2331478f-5 8.683361f-6 2.6108513f-5 0.00018525627 -5.4177315f-5 4.863302f-5 -4.4198383f-5 0.0002122039 5.1137f-5 -7.5470605f-5 9.244171f-5 7.026119f-5 -6.653402f-5 -4.770667f-5; -2.5696885f-5 9.916267f-5 -6.763647f-5 0.00010304379 -0.0002357643 -0.00012774506 6.355808f-5 7.217627f-5 -5.146789f-5 3.9063107f-5 -0.00018093162 -9.470564f-5 -6.777961f-5 1.6730868f-5 1.0619945f-5 0.00020895866 -8.2263334f-8 -0.00014963718 3.797918f-8 -4.2999094f-5 -0.0001284756 -6.7468594f-5 5.7482783f-5 0.00022357237 -6.8072f-5 -0.00023684648 -0.00010816422 -8.7614244f-5 2.1522703f-5 4.8859696f-5 5.9130896f-5 0.00018577164; 9.678173f-5 -4.5373457f-5 9.4468625f-5 2.457127f-5 -3.9246548f-5 1.8049974f-5 -1.7630085f-5 1.1948337f-6 -0.0001131775 8.8355904f-5 -0.00022172944 -6.953801f-5 0.00014747429 5.2915104f-5 5.94268f-5 -0.00023429975 1.1352164f-6 -5.2230916f-6 0.00011640851 3.5199414f-6 9.839913f-6 -6.1419414f-5 -0.00014549072 5.977802f-5 4.2179865f-5 -7.051863f-5 0.00013016758 -4.1963875f-5 0.00014682356 -0.00011086444 9.7668795f-5 -5.363447f-5; -8.611796f-6 -6.649462f-5 1.6857635f-5 -7.3104015f-6 -2.9465602f-5 -7.244915f-5 0.00014709744 1.6589685f-6 -1.30020835f-5 -6.685605f-5 0.00011399594 -4.8412276f-5 9.664865f-5 0.00013560908 -3.1946944f-5 -0.00011685164 0.00010410892 0.00015027702 5.789014f-5 -2.4813933f-5 -8.706405f-5 -4.2864427f-5 -4.5170837f-6 6.256654f-5 -4.1688232f-5 -8.993185f-5 0.00015809834 0.0001198318 8.10769f-5 -1.530237f-5 3.5296376f-5 -5.0377133f-5; 0.00010349453 -3.4815683f-5 3.2227155f-5 3.4623576f-5 5.0026294f-5 -6.6347755f-5 -1.400085f-5 -4.1142608f-5 -0.000114760995 -0.00010998618 -0.0001057534 -0.00013786495 -0.000114432165 -4.934974f-5 -3.7090264f-5 0.00014832693 -6.693226f-5 0.00015169026 -2.8509812f-5 -6.54272f-5 5.029631f-5 6.1950064f-5 3.741436f-5 -5.696041f-6 7.363511f-5 6.432624f-5 -3.44796f-5 4.411837f-5 0.00015251868 -0.000116800795 -4.6724334f-5 2.433919f-5; 9.546465f-5 -2.6657104f-5 -9.9762954f-5 5.3500196f-5 1.1500982f-6 9.224111f-5 -1.2152344f-5 0.0001912738 -0.00014923543 8.810828f-5 -5.6468816f-5 0.00019726592 2.1377891f-5 -4.4618093f-5 1.246168f-5 -5.465295f-5 0.00024741018 6.5885106f-5 0.00012697035 -5.4891184f-6 -2.455501f-5 0.00012948614 1.0435784f-5 7.519872f-5 8.416811f-5 4.7496975f-5 0.00016749949 0.00011486491 6.3805666f-5 3.966936f-5 -3.0343104f-5 -7.1545364f-5; -7.9427424f-5 -4.497299f-5 0.0002573938 -0.00016335853 6.045054f-5 3.6326037f-5 3.1138155f-5 -6.0494094f-5 5.216731f-5 -9.078357f-5 4.1676987f-5 0.00010054686 -0.00017119483 -3.8943454f-5 -1.4789149f-5 -5.4797372f-5 3.54715f-5 -4.9995342f-5 1.0227358f-5 -9.298229f-5 -3.9828883f-5 4.6139696f-5 3.7926416f-6 0.0001783678 -0.00027761012 -2.9058841f-5 -0.00012680574 -1.8277326f-5 -0.00013664691 -7.5880984f-5 5.7035195f-5 5.316371f-5; 3.0572563f-5 -5.5694647f-5 -3.559907f-5 0.000106678555 -0.0001408759 4.5689892f-5 -0.0001846512 8.419507f-5 -0.00015859179 4.6940408f-5 2.6846765f-5 -6.115805f-5 8.98129f-5 -4.270656f-5 0.00016700514 -9.601421f-5 -8.1750855f-5 -8.629372f-6 -5.708773f-5 -0.00016664912 0.00013403967 -0.00013517092 -0.00024501697 -2.7237136f-5 -2.8011113f-5 5.2925967f-5 -0.0001297733 -7.77717f-5 -7.146804f-5 0.00012116908 -3.625311f-5 -5.0251074f-6; -6.310976f-5 -1.3683954f-5 -1.0145628f-5 -1.0411088f-5 -3.6363737f-5 -7.033223f-5 9.502895f-5 5.4288914f-5 -7.0745664f-6 -0.0001957746 8.660479f-5 -3.3990545f-5 -5.903412f-5 -6.257744f-5 -3.3094355f-5 0.0001341241 7.763289f-5 -0.00013445597 -8.934546f-5 0.00012808196 -8.05595f-5 2.477098f-5 1.6957421f-5 -9.736296f-5 9.332381f-5 -8.855532f-5 4.051985f-5 -4.1901425f-5 7.178035f-5 3.8598315f-5 2.4498872f-6 -0.00013052745; 5.051807f-5 5.414434f-5 -2.9358765f-5 0.0001571523 -4.3118198f-5 5.8199756f-5 0.00018146889 4.0243085f-5 -9.175468f-5 -6.77237f-6 3.1087253f-5 -9.876576f-6 -2.3548997f-5 0.00010833811 -1.2679887f-5 -0.00013269096 -3.4817597f-6 7.653187f-5 -4.3640182f-5 -0.00022713485 -4.872819f-5 -4.6385227f-5 -2.6463611f-5 -2.6141504f-5 5.814178f-6 6.44899f-5 -5.9685262f-5 -0.00013726488 -1.7330616f-5 -1.08720105f-5 2.9513727f-5 -7.6213455f-6; -9.040575f-5 3.0237896f-5 0.000121817204 -0.00011448946 0.00013098035 0.00013417171 3.3635934f-5 8.976474f-5 4.5613684f-5 -8.0794256f-5 -3.3077722f-5 0.00013253905 -0.00015856574 -0.00025512694 -7.581747f-5 0.00018226053 -5.3303957f-6 -3.8073853f-5 -5.0436814f-5 9.8105236f-5 3.4899447f-5 9.051291f-5 -6.0539493f-5 -6.3025975f-5 -3.370114f-5 -0.00016418494 9.624511f-5 -9.0921814f-5 0.00016573719 -7.459387f-5 -0.00014209095 0.00017451728; 0.00014323603 -8.9383066f-5 -0.00010965675 0.00013226288 0.00021273932 6.951879f-5 -1.2352402f-5 -4.9401315f-5 3.3694894f-6 1.877194f-5 4.641068f-5 3.6649894f-6 2.7391105f-5 -9.277646f-5 -5.694637f-5 -0.00016453004 0.00013646175 -6.023907f-5 1.5523534f-5 -8.656966f-6 5.5956407f-5 -0.00010965915 0.00015940185 -1.0159294f-5 6.866321f-5 9.47915f-6 1.4488596f-5 -3.7015085f-5 0.00019446634 -0.00014218032 -8.470578f-5 -0.0002427911; 8.553643f-6 0.00022048873 4.540668f-5 -0.000102095444 -0.00021196232 -5.4923003f-5 -0.00023721345 5.1384362f-5 -0.00016276076 0.00014353139 -8.892146f-5 -9.2993025f-5 3.387207f-5 -3.912855f-5 -2.3710438f-5 9.694462f-5 0.0002759928 -4.7125664f-6 7.039642f-5 4.1579457f-5 -5.4427226f-5 -1.3312658f-5 3.8744478f-5 -0.0002063548 -4.9566705f-5 4.696036f-5 0.00014029798 8.546972f-5 0.00015416047 -2.0456826f-5 -4.9249707f-6 -9.969402f-5; 9.620086f-5 0.00018057911 0.00011114337 4.0307154f-5 -4.1706324f-5 -0.00018809833 -7.33493f-5 2.6786765f-5 -0.00013925422 6.0610284f-5 -8.657884f-5 -4.2538464f-5 2.6766726f-5 1.41106975f-5 4.2129824f-7 0.0001487221 3.1818043f-5 1.7609081f-7 3.2249376f-5 6.539168f-6 -2.4412913f-5 3.6785164f-5 0.000103044455 -0.00016824955 -4.9237784f-5 -0.00012902454 0.00014499975 -4.234607f-5 -8.975732f-5 -6.0836217f-5 6.424644f-5 -4.918726f-5; 7.744888f-5 -0.00015931697 0.00010755015 0.0001608226 -3.1502143f-5 3.5890647f-5 -3.141982f-5 5.8872214f-5 1.0878563f-5 -5.337804f-5 -0.00018028116 3.6778172f-6 2.3946688f-5 -1.0531871f-5 4.692146f-5 0.00018054417 -4.127393f-5 -0.00012387936 -9.27182f-6 -7.389461f-5 -7.1568684f-5 8.489788f-5 -7.018124f-5 -4.1726173f-5 0.00021023137 -6.781109f-5 3.857147f-5 -0.00014392979 0.00010070168 -5.459235f-5 -2.1835167f-5 3.9135582f-5; 0.00011107678 -7.5216514f-5 5.174683f-5 -5.689841f-5 7.887371f-5 -0.0001889344 -2.1165433f-5 8.278898f-6 6.849136f-5 -3.562731f-5 -7.525843f-5 3.804719f-5 2.9110151f-5 7.687285f-5 -1.1952487f-5 -0.0001066212 3.669687f-5 0.00012179493 -0.00029809898 -1.2461409f-5 0.00025228577 2.0877877f-5 4.9798786f-5 3.8691658f-5 7.424481f-5 3.220396f-5 3.1603176f-5 0.00010908023 -2.1500562f-5 0.00019051594 5.1815063f-5 -5.3839638f-5; 0.00013876415 0.00019792432 -2.4857602f-5 0.00022348043 4.85615f-5 -1.729452f-5 -9.142174f-5 -0.00013400915 -0.00011826833 2.1783126f-6 0.0001454223 -0.0002065827 1.036386f-5 -6.166418f-5 -0.00015664307 2.936719f-5 7.071361f-6 -1.036393f-6 -2.3961695f-5 2.1478025f-5 -0.00010034569 -0.00015277773 -5.912367f-5 0.00015411156 2.8966404f-5 0.00014665256 -3.1698808f-5 -0.0001473296 -4.25876f-5 -0.00025761183 3.7666887f-5 -3.7534406f-5; -0.00012077479 0.00010330257 -5.5023203f-5 5.65839f-6 -0.00019004852 -6.5875305f-5 5.182159f-6 7.046959f-5 4.1188203f-5 -5.828292f-5 -1.2261626f-5 0.00014709118 -8.470352f-5 7.381603f-5 2.7434322f-5 -8.520652f-5 7.35481f-5 0.00012650977 0.0001162128 8.760043f-5 0.00013961933 -0.0001842895 -1.0225796f-5 -0.00011576231 -4.0966832f-5 0.00014824036 5.6878403f-6 3.2759053f-5 -5.221569f-5 0.000107919106 -8.861748f-5 0.00012954634; -9.092543f-5 3.515289f-5 -5.3461376f-5 -0.00015747146 -0.0001520786 -0.00010558733 -0.00013869492 -8.793915f-5 0.0001377228 8.253649f-5 -7.272346f-5 -9.965709f-5 6.6402968f-6 4.8941256f-6 -3.166098f-5 -1.8922867f-5 -3.2910175f-5 0.00012385144 -0.00013275201 -8.636977f-5 2.5063278f-5 6.372427f-5 2.1189484f-5 1.197861f-5 4.6046283f-5 0.00013020872 0.00015882985 1.9736599f-5 -7.6607146f-5 6.7986846f-5 -9.756984f-6 5.5188586f-5; -6.1245795f-5 0.00020134357 3.8291673f-5 2.4462106f-6 9.955919f-5 -6.4796244f-5 7.799379f-5 3.7670125f-5 2.5466185f-5 -9.7223085f-5 -8.392279f-5 -0.00020340466 -0.00019697608 1.2992621f-5 8.589385f-5 4.0273706f-5 0.0001437047 -1.5973897f-5 0.00014963563 -0.00012278199 -9.385155f-5 5.2689382f-5 -4.703007f-5 -3.24473f-5 0.00012561401 6.604654f-5 -5.647558f-5 -8.19662f-5 -4.3946773f-5 -6.732808f-5 7.6496275f-5 8.325988f-5; 0.00015000289 -7.688686f-6 -0.00014835647 6.821745f-5 1.38467285f-5 -3.7787144f-5 -0.00013367092 0.00016361038 5.821186f-5 -4.7418518f-5 -3.456809f-5 -6.71464f-5 9.326536f-5 -4.3505865f-5 -3.2765864f-5 -5.63518f-5 5.86492f-5 -4.7186924f-5 -8.82627f-5 -2.0737933f-5 -0.00016789106 2.007821f-5 0.0001507173 -3.4070083f-5 -3.0484844f-5 3.9278082f-5 -3.7754668f-5 -2.4393958f-6 -6.228805f-7 0.00016120492 -0.000102590086 -8.529586f-5; -7.8614634f-5 -0.00012134054 -0.0001041472 -3.446248f-5 6.8302643f-6 0.00015603764 9.0518224f-5 7.193125f-5 0.0001303336 -0.0001575294 -0.00012209541 -4.082265f-5 1.41891705f-5 4.1970663f-5 9.2949886f-5 -0.00015037422 9.695152f-7 -4.347798f-5 -3.407138f-5 6.287112f-5 8.013405f-5 6.061897f-5 1.9694493f-5 -5.358241f-5 -0.00014767377 5.6933546f-5 2.6799713f-5 6.49615f-5 -9.084594f-5 1.6083286f-5 4.0388255f-5 -9.0133464f-5; -2.0846055f-5 -2.4880932f-5 4.452077f-5 -2.3971135f-5 8.2773395f-6 1.777748f-5 -9.8696626f-5 8.257519f-5 -3.307466f-5 -8.552338f-5 -9.292085f-5 5.072268f-5 -1.8525016f-5 -7.684788f-5 0.00015601474 -6.587661f-5 0.0001807743 5.8981343f-5 -0.00017419239 -6.793829f-5 -7.237376f-5 0.000100946134 -2.610907f-5 -0.0001497585 -5.0404105f-5 -6.415207f-5 -0.00019856245 -0.00017651859 8.1182625f-5 -1.9353869f-5 1.7631663f-5 -1.2915372f-6; -0.00016421347 -5.9369053f-5 -0.00015168289 0.00015581463 -6.651486f-5 -9.933993f-5 7.108536f-5 5.784157f-6 0.00016647733 2.8894896f-5 2.7511931f-5 -3.0824776f-5 2.6382006f-6 -0.00015356996 -3.2079734f-5 7.666278f-5 0.00012875356 3.367663f-5 -6.737269f-5 -2.935187f-6 5.9819504f-5 -4.5206456f-5 -0.00010969716 8.511476f-6 -0.00016575123 -5.326933f-5 9.1548434f-5 -7.89409f-5 0.00012399067 1.2393534f-5 0.00014070442 -0.00010780305; 6.558104f-7 0.000118357326 3.2509353f-5 0.00015047584 6.429632f-6 -4.144859f-5 9.453187f-6 -0.00010999362 3.309262f-5 3.0319732f-5 1.4594262f-5 -0.0001935477 -7.650715f-6 6.5996403f-7 -0.00010796025 3.182958f-5 -7.832497f-5 7.170726f-5 7.1791774f-6 0.000105191706 -5.1313178f-5 2.9397609f-6 0.00014999948 7.029693f-6 3.94183f-5 3.0877707f-6 0.00011645171 -1.831476f-5 -6.169374f-5 -2.0303978f-5 5.7560876f-5 -4.8845788f-5; 1.6413593f-5 -1.0320751f-5 -3.7281043f-5 -0.00012905443 -4.716909f-5 2.2464908f-5 2.455107f-5 -0.00017304924 7.9006735f-5 4.655736f-5 9.56507f-5 -6.5270826f-5 9.693487f-5 0.0001523612 2.1671658f-5 -3.260643f-5 9.44142f-5 0.000108343855 4.247645f-7 8.080921f-5 4.7967365f-5 2.5645157f-5 5.8970996f-5 7.215316f-5 0.00042928054 5.494135f-5 0.000179557 -7.5970034f-5 0.00012186855 -0.00017688233 -8.5362f-5 6.0911276f-5; 4.6279303f-5 -7.764581f-5 4.4363278f-5 0.00016677935 -0.00015650656 -5.7617945f-5 -3.2071744f-5 -0.000117451076 0.00013088009 -0.000100822814 4.9571197f-5 6.4043044f-5 8.508748f-6 -9.6508265f-5 0.000112834925 -7.4574896f-6 -9.5179996f-5 7.4065f-5 0.00013701113 -8.430535f-5 -8.294196f-5 -1.9059384f-5 0.00013233177 0.0001024359 -0.00012652161 5.9188955f-5 6.7487395f-6 -0.00019509754 0.00016227065 0.00015813255 -1.5722084f-5 -0.00019883935], bias = Float32[0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0;;]), layer_4 = (weight = Float32[3.0588377f-5 -0.00011662035 -8.66615f-5 3.1931843f-6 7.8242765f-6 -6.8603236f-5 9.9124816f-5 -0.000112514725 0.0002335306 -3.3416884f-5 0.000117334006 -8.8648594f-5 -2.13409f-5 5.0759452f-5 7.724689f-5 7.363675f-5 -8.105793f-5 2.4017912f-5 0.00010034391 -2.586626f-5 -0.00022780207 -0.00015493063 -5.7617803f-5 -0.000120399025 0.0001339231 0.00016335525 -8.729135f-5 -6.6914734f-5 -0.00016911975 7.078426f-5 0.00016903739 0.00015373905; -6.0984963f-5 0.00012847941 0.00017167427 3.22061f-5 -4.2578602f-5 -0.00028910954 -8.678245f-5 0.00010542384 -0.000242439 -0.00021166299 -3.4589166f-6 -1.2406994f-5 -1.4728516f-7 -4.6108853f-5 3.0797142f-5 7.285384f-6 -8.63031f-5 -0.00012452155 -1.28611555f-5 0.000112388756 0.00016220257 0.00018081014 0.00013031285 -4.8067628f-5 -7.5893775f-5 -1.3903057f-5 0.00013855268 -3.8111575f-5 0.0001434179 0.00020458124 9.6850345f-5 0.00015105496], bias = Float32[0.0; 0.0;;])), (layer_1 = NamedTuple(), layer_2 = NamedTuple(), layer_3 = NamedTuple(), layer_4 = NamedTuple()))
```


Similar to most DL frameworks, Lux defaults to using `Float32`, however, in this case we need Float64


```julia
const params = ComponentArray{Float64}(ps)
```


```
ComponentVector{Float64}(layer_1 = Float64[], layer_2 = (weight = [-7.155509229050949e-5; -0.00010446947999298573; 0.00010252016363665462; -4.860137414652854e-5; 2.8771884899470024e-5; -4.0343875298276544e-5; -0.0001662092690821737; 6.796199886593968e-5; -1.4444782209466211e-5; 8.310581324622035e-5; 0.00022202225227374583; 2.5437757358304225e-5; 0.00010417161684017628; -3.0584244086639956e-5; 0.0001515085605205968; -0.0001151957840193063; 2.961221252917312e-5; 0.0001500123762525618; -0.00025686415028758347; -8.352950681000948e-5; 0.00012459633580874652; 4.76388813694939e-5; 4.944892134517431e-5; 2.376210250076838e-5; -8.035228529479355e-5; 5.171789234736934e-5; 3.989083779742941e-5; 4.765904577652691e-6; -5.125009556650184e-5; -4.936104596708901e-5; 6.263567775022238e-5; -3.5069686418864876e-5;;], bias = [0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0;;]), layer_3 = (weight = [0.0001678897242527455 -7.281036960193887e-5 -3.4757526009343565e-5 -4.640645784093067e-5 5.356927067623474e-5 -0.00012610876001417637 -5.2870771469315514e-5 -9.425129246665165e-5 -6.49685580356163e-6 -8.11443678685464e-5 0.00010337621642975137 8.159547724062577e-5 1.3262192624097224e-5 -6.066135028959252e-5 -0.00018410972552374005 7.872147398302332e-5 8.232941036112607e-5 -6.557109736604616e-5 6.718166696373373e-5 2.951272836071439e-5 0.0001225884770974517 3.873471723636612e-5 -8.881900430424139e-5 0.00017601324361748993 -0.000200382768525742 4.960322144142992e-7 6.19035490672104e-5 2.2029256797395647e-5 0.00015630268899258226 -1.7592947187949903e-6 4.503492164076306e-5 0.0001704416354186833; -1.3494830454874318e-5 8.349842391908169e-5 5.866761785000563e-5 0.00010080602805828676 5.641394091071561e-5 -3.5755780118051916e-5 2.9119815735612065e-5 3.749086681636982e-5 0.00019686993618961424 -2.5702274797367863e-6 4.128889486310072e-5 -0.00012270182196516544 -2.5620607630116865e-5 -6.214474979060469e-6 -0.0001220706180902198 -8.704122592462227e-5 9.366581798531115e-5 -0.00016186253924388438 -3.289493906777352e-5 -9.051174129126593e-5 -1.6249976397375576e-5 2.7186468287254684e-5 -5.301112832967192e-5 -6.971666880417615e-5 5.924254219280556e-5 -8.8936896645464e-5 -3.3880332921398804e-5 0.00011937917588511482 1.4332859791466035e-5 2.0321671399869956e-5 -0.00012577524466905743 0.0001269174535991624; 7.700417336309329e-5 4.411135159898549e-5 -8.293782593682408e-5 -3.7350429920479655e-5 3.135983206448145e-5 0.00024315656628459692 0.00015689026622567326 9.186047100229189e-5 1.9125815015286207e-5 0.00014442259271163493 -0.00023981352569535375 7.725140312686563e-5 7.126304262783378e-5 -0.00016185766435228288 0.00017890872550196946 -0.0001122502944781445 4.410252586239949e-5 0.00015077491116244346 7.84748190199025e-5 5.226693247095682e-5 -3.581939745345153e-5 6.310559547273442e-5 -8.174108370440081e-5 -5.1414644985925406e-5 -0.00010237073001917452 0.00010555190237937495 1.2070859156665392e-6 6.120077887317166e-5 -6.258486337173963e-6 -3.969341560150497e-5 -0.00018983636982738972 -4.893853110843338e-5; -9.06777277123183e-5 0.00011455140338512138 0.00023800277267582715 -5.691133992513642e-5 -0.00010857205052161589 1.2847054676967673e-5 -0.00011735238513210788 3.4836033592000604e-5 -0.00010811178071890026 2.7914165912079625e-5 9.360675903735682e-5 4.9558697355678305e-5 0.00026346705271862447 1.0242767530144192e-5 2.2013338821125217e-5 -1.3034901712671854e-5 -7.647357961104717e-6 -4.0469352825311944e-5 7.135664054658264e-5 -3.994995859102346e-5 -5.7457862567389384e-5 -0.00015199383778963238 0.00017758103786036372 5.7156292314175516e-5 -7.273178925970569e-5 -9.888222848530859e-5 2.466354999342002e-5 -7.719024870311841e-5 1.918132693390362e-5 5.88854709349107e-5 5.012903056922369e-5 3.498204478091793e-6; 1.8229015040560625e-5 6.711405876558274e-5 7.455271406797692e-5 -0.00010517777991481125 -1.3497152394847944e-5 2.428117295494303e-5 2.8175611078040674e-5 5.55281039851252e-5 6.067446156521328e-5 6.809701153542846e-5 0.00018309650477021933 -1.451492789783515e-5 -1.9245126168243587e-5 6.180897617014125e-5 0.0001674121740506962 9.618377953302115e-5 -4.015763863662869e-7 3.5716791899176314e-5 6.534294516313821e-5 -0.00012383471766952425 -1.908430567709729e-5 -9.305732237407938e-5 9.140672045759857e-5 4.5719545596512035e-5 -3.2340358302462846e-5 -3.2214407838182524e-5 3.183264141171094e-7 -2.343688265682431e-6 6.583061622222885e-5 0.00017748121172189713 -9.534072887618095e-5 -0.00012482935562729836; 8.519204129697755e-5 8.130070636980236e-5 0.00015394463844131678 9.720127854961902e-5 -2.511508319003042e-5 -0.00010094827302964404 0.00013726165343541652 0.0001836374431150034 -3.697761712828651e-5 -0.00011249857197981328 8.898133091861382e-5 2.7029051125282422e-5 0.0001972914469661191 0.00013460243644658476 0.0001091262893169187 9.109244274441153e-5 -1.622878153284546e-5 7.25885693100281e-5 3.2331477996194735e-5 8.683360647410154e-6 2.6108513338840567e-5 0.00018525627092458308 -5.417731517809443e-5 4.863302092417143e-5 -4.419838296598755e-5 0.00021220390044618398 5.113700171932578e-5 -7.547060522483662e-5 9.244171087630093e-5 7.026118692010641e-5 -6.653401942458004e-5 -4.770667146658525e-5; -2.5696885131765157e-5 9.916267299558967e-5 -6.763647252228111e-5 0.00010304379247827455 -0.00023576429521199316 -0.0001277450646739453 6.355808000080287e-5 7.217626989586279e-5 -5.1467890443746e-5 3.906310666934587e-5 -0.0001809316163416952 -9.470563963986933e-5 -6.777961243642494e-5 1.6730868082959205e-5 1.0619944987411145e-5 0.00020895866327919066 -8.226333392258312e-8 -0.00014963718422222883 3.797918068926265e-8 -4.299909414839931e-5 -0.00012847559992223978 -6.746859435224906e-5 5.748278272221796e-5 0.00022357236593961716 -6.80719967931509e-5 -0.00023684647749178112 -0.00010816421854542568 -8.761424396652728e-5 2.1522702809306793e-5 4.88596961076837e-5 5.913089626119472e-5 0.00018577164155431092; 9.678173228166997e-5 -4.5373457396635786e-5 9.446862532058731e-5 2.4571270841988735e-5 -3.924654811271466e-5 1.804997373255901e-5 -1.76300854946021e-5 1.1948336577916052e-6 -0.00011317749886075035 8.835590415401384e-5 -0.00022172943863552064 -6.953800766495988e-5 0.00014747428940609097 5.2915103879058734e-5 5.942679854342714e-5 -0.00023429974680766463 1.1352163937772275e-6 -5.223091648076661e-6 0.00011640851153060794 3.519941401464166e-6 9.839913218456786e-6 -6.141941412352026e-5 -0.0001454907178413123 5.9778019931400195e-5 4.217986497678794e-5 -7.051863212836906e-5 0.00013016758020967245 -4.19638745370321e-5 0.00014682355686090887 -0.00011086444283137098 9.766879520611838e-5 -5.3634470532415435e-5; -8.61179614730645e-6 -6.649462011409923e-5 1.685763527348172e-5 -7.310401542781619e-6 -2.9465601983247325e-5 -7.244914741022512e-5 0.00014709743845742196 1.6589684719292563e-6 -1.300208350585308e-5 -6.68560533085838e-5 0.00011399594222893938 -4.841227564611472e-5 9.664864774094895e-5 0.00013560907973442227 -3.194694363628514e-5 -0.00011685163917718455 0.00010410891991341487 0.0001502770173829049 5.789014176116325e-5 -2.481393312336877e-5 -8.706405060365796e-5 -4.2864427086897194e-5 -4.5170836528996006e-6 6.256654160097241e-5 -4.168823215877637e-5 -8.993184746941552e-5 0.00015809833712410182 0.00011983179865637794 8.107689791359007e-5 -1.5302370229619555e-5 3.5296376154292375e-5 -5.037713344790973e-5; 0.0001034945307765156 -3.481568273855373e-5 3.222715531592257e-5 3.462357562966645e-5 5.002629404771142e-5 -6.634775490965694e-5 -1.400084966007853e-5 -4.114260809728876e-5 -0.00011476099462015554 -0.00010998617653967813 -0.00010575340274954215 -0.00013786494673695415 -0.00011443216499174014 -4.934973912895657e-5 -3.70902635040693e-5 0.00014832692977506667 -6.693226168863475e-5 0.0001516902557341382 -2.850981218216475e-5 -6.542720075231045e-5 5.029630847275257e-5 6.195006426423788e-5 3.741436012205668e-5 -5.6960411711770575e-6 7.363510667346418e-5 6.432623922592029e-5 -3.4479598980396986e-5 4.411836926010437e-5 0.0001525186817161739 -0.00011680079478537664 -4.672433351515792e-5 2.4339189621969126e-5; 9.546465298626572e-5 -2.6657104172045365e-5 -9.976295405067503e-5 5.350019637262449e-5 1.1500982282086625e-6 9.22411127248779e-5 -1.2152344424976036e-5 0.00019127379346173257 -0.00014923543494660407 8.810828148853034e-5 -5.646881618304178e-5 0.00019726592290680856 2.1377891243901104e-5 -4.461809294298291e-5 1.246167994395364e-5 -5.4652951803291216e-5 0.0002474101784173399 6.588510586880147e-5 0.0001269703498110175 -5.4891183935978916e-6 -2.455501089571044e-5 0.0001294861431233585 1.043578413373325e-5 7.519871724070981e-5 8.416811033384874e-5 4.7496974730165675e-5 0.0001674994855420664 0.00011486490984680131 6.380566628649831e-5 3.9669361285632476e-5 -3.034310429939069e-5 -7.154536433517933e-5; -7.942742377053946e-5 -4.497298868955113e-5 0.00025739381089806557 -0.0001633585343370214 6.0450540331657976e-5 3.632603693404235e-5 3.1138155463850126e-5 -6.049409421393648e-5 5.216731005930342e-5 -9.078357106773183e-5 4.167698716628365e-5 0.00010054685844806954 -0.00017119482799898833 -3.8943453546380624e-5 -1.4789148735872004e-5 -5.479737228597514e-5 3.5471501178108156e-5 -4.999534212402068e-5 1.0227357961412054e-5 -9.298229269916192e-5 -3.982888301834464e-5 4.6139695768943056e-5 3.7926415643596556e-6 0.0001783678017091006 -0.00027761011733673513 -2.9058841391815804e-5 -0.00012680573854595423 -1.82773255801294e-5 -0.00013664690777659416 -7.588098378619179e-5 5.7035194913623855e-5 5.316370879882015e-5; 3.0572562536690384e-5 -5.569464701693505e-5 -3.5599070542957634e-5 0.0001066785553121008 -0.00014087589806877077 4.568989243125543e-5 -0.00018465120228938758 8.41950677568093e-5 -0.00015859179256949574 4.694040762842633e-5 2.684676474018488e-5 -6.115804717410356e-5 8.981290011433885e-5 -4.2706560634542257e-5 0.00016700514242984354 -9.601421334082261e-5 -8.175085531547666e-5 -8.629372132418212e-6 -5.7087730965577066e-5 -0.00016664911527186632 0.00013403967022895813 -0.00013517092156689614 -0.0002450169704388827 -2.7237136237090454e-5 -2.801111259032041e-5 5.292596688377671e-5 -0.00012977329606655985 -7.777169957989827e-5 -7.14680427336134e-5 0.00012116908328607678 -3.625311001087539e-5 -5.025107384426519e-6; -6.310975732048973e-5 -1.3683954421139788e-5 -1.0145628039026633e-5 -1.0411087714601308e-5 -3.636373730842024e-5 -7.03322293702513e-5 9.502894681645557e-5 5.428891381598078e-5 -7.074566383380443e-6 -0.00019577459897845984 8.66047921590507e-5 -3.399054548935965e-5 -5.903411874896847e-5 -6.257744098547846e-5 -3.309435487608425e-5 0.00013412410044111311 7.763288886053488e-5 -0.00013445597141981125 -8.934546349337325e-5 0.00012808195606339723 -8.055949729168788e-5 2.4770979507593438e-5 1.6957421394181438e-5 -9.736295760376379e-5 9.332381159765646e-5 -8.855532360030338e-5 4.0519851609133184e-5 -4.190142499282956e-5 7.1780348662287e-5 3.8598314858973026e-5 2.4498872335243504e-6 -0.00013052744907326996; 5.051806874689646e-5 5.414434053818695e-5 -2.9358765459619462e-5 0.00015715230256319046 -4.3118197936564684e-5 5.81997555855196e-5 0.00018146888760384172 4.024308509542607e-5 -9.175467857858166e-5 -6.772369943064405e-6 3.10872528643813e-5 -9.876575859379955e-6 -2.354899697820656e-5 0.00010833810665644705 -1.2679886822297703e-5 -0.0001326909550698474 -3.4817596770153614e-6 7.65318691264838e-5 -4.364018241176382e-5 -0.0002271348494105041 -4.872819044976495e-5 -4.638522659661248e-5 -2.6463610993232578e-5 -2.6141504349652678e-5 5.8141781664744485e-6 6.448989734053612e-5 -5.968526238575578e-5 -0.00013726488396059722 -1.7330616174149327e-5 -1.087201053451281e-5 2.9513726985896938e-5 -7.62134550313931e-6; -9.040575241670012e-5 3.0237895771279e-5 0.0001218172037624754 -0.00011448946315795183 0.00013098034833092242 0.00013417171430774033 3.363593350513838e-5 8.976474055089056e-5 4.561368405120447e-5 -8.07942560641095e-5 -3.307772203697823e-5 0.00013253904762677848 -0.00015856574464123696 -0.00025512694264762104 -7.581747195217758e-5 0.0001822605263441801 -5.3303956519812346e-6 -3.8073852920206264e-5 -5.043681449024007e-5 9.810523624764755e-5 3.489944720058702e-5 9.051291272044182e-5 -6.0539492551470175e-5 -6.302597466856241e-5 -3.3701140637276694e-5 -0.00016418493760284036 9.62451085797511e-5 -9.092181426240131e-5 0.00016573719040025026 -7.459386688424274e-5 -0.00014209095388650894 0.00017451727762818336; 0.0001432360295439139 -8.938306564232334e-5 -0.00010965675028273836 0.00013226288137957454 0.0002127393236150965 6.951879186090082e-5 -1.235240233654622e-5 -4.940131475450471e-5 3.3694893772917567e-6 1.877193972177338e-5 4.6410681534325704e-5 3.6649894354923163e-6 2.7391104595153593e-5 -9.277646313421428e-5 -5.69463700230699e-5 -0.00016453003627248108 0.00013646174920722842 -6.023906826158054e-5 1.552353387523908e-5 -8.656966201670002e-6 5.5956406868062913e-5 -0.00010965915134875104 0.00015940185403451324 -1.0159294106415473e-5 6.866321200504899e-5 9.479150321567431e-6 1.448859620722942e-5 -3.701508467202075e-5 0.00019446633814368397 -0.00014218031719792634 -8.470578177366406e-5 -0.0002427910949336365; 8.553643056075089e-6 0.00022048872779123485 4.540667941910215e-5 -0.00010209544416284189 -0.00021196232410147786 -5.492300260812044e-5 -0.00023721344769001007 5.1384362450335175e-5 -0.00016276075621135533 0.00014353138976730406 -8.89214570634067e-5 -9.299302473664284e-5 3.38720710715279e-5 -3.9128550270106643e-5 -2.3710437744739465e-5 9.69446191447787e-5 0.000275992788374424 -4.712566351372516e-6 7.039641786832362e-5 4.157945659244433e-5 -5.44272261322476e-5 -1.3312657756614499e-5 3.874447793350555e-5 -0.0002063548017758876 -4.9566704547032714e-5 4.696035830420442e-5 0.0001402979833073914 8.546972094336525e-5 0.00015416047244798392 -2.045682595053222e-5 -4.924970653519267e-6 -9.969402162823826e-5; 9.620086348149925e-5 0.00018057911074720323 0.0001111433666665107 4.030715354019776e-5 -4.170632382738404e-5 -0.00018809833272825927 -7.334929978242144e-5 2.678676537470892e-5 -0.00013925421808380634 6.061028398107737e-5 -8.657883881824091e-5 -4.253846418578178e-5 2.6766725568450056e-5 1.4110697520663962e-5 4.2129823896175367e-7 0.0001487221015850082 3.181804277119227e-5 1.7609080771308072e-7 3.224937609047629e-5 6.539168225572212e-6 -2.441291326249484e-5 3.678516441141255e-5 0.00010304445459041744 -0.00016824954946059734 -4.923778396914713e-5 -0.00012902454182039946 0.00014499975077342242 -4.234606967656873e-5 -8.97573190741241e-5 -6.0836217016913e-5 6.424643652280793e-5 -4.918725971947424e-5; 7.744887989247218e-5 -0.00015931697271298617 0.00010755014955066144 0.00016082260117400438 -3.1502142519457266e-5 3.589064726838842e-5 -3.141981869703159e-5 5.887221414013766e-5 1.0878563443839084e-5 -5.337804032023996e-5 -0.00018028116028290242 3.677817176139797e-6 2.3946688088472e-5 -1.0531871339480858e-5 4.6921461034798995e-5 0.00018054417159873992 -4.127392821828835e-5 -0.00012387936294544488 -9.27182009036187e-6 -7.389461097773165e-5 -7.156868377933279e-5 8.489788160659373e-5 -7.018123869784176e-5 -4.172617263975553e-5 0.00021023137378506362 -6.78110882290639e-5 3.8571470213355497e-5 -0.0001439297921024263 0.00010070168355014175 -5.459235035232268e-5 -2.1835166990058497e-5 3.913558248314075e-5; 0.0001110767771024257 -7.52165142330341e-5 5.174682883080095e-5 -5.689841054845601e-5 7.887370884418488e-5 -0.00018893439846578985 -2.1165433281566948e-5 8.278898349090014e-6 6.849136116215959e-5 -3.562730853445828e-5 -7.525843102484941e-5 3.804719017352909e-5 2.9110151444911025e-5 7.687284960411489e-5 -1.1952486602240242e-5 -0.00010662119893822819 3.6696870665764436e-5 0.00012179493205621839 -0.000298098981147632 -1.2461408914532512e-5 0.0002522857685107738 2.0877876522717997e-5 4.979878576705232e-5 3.8691658119205385e-5 7.424481009365991e-5 3.2203959563048556e-5 3.160317646688782e-5 0.00010908023250522092 -2.1500562070286833e-5 0.00019051594426855445 5.181506276130676e-5 -5.383963798522018e-5; 0.00013876415323466063 0.000197924324311316 -2.4857601601979695e-5 0.00022348042693920434 4.856149826082401e-5 -1.7294520148425363e-5 -9.142173803411424e-5 -0.00013400915486272424 -0.00011826833360828459 2.178312570322305e-6 0.0001454222947359085 -0.00020658269932027906 1.0363860383222345e-5 -6.166417733766139e-5 -0.000156643072841689 2.9367189199547283e-5 7.071360869304044e-6 -1.0363929732193355e-6 -2.3961694751051255e-5 2.14780247915769e-5 -0.0001003456927719526 -0.00015277773491106927 -5.912367123528384e-5 0.00015411156346090138 2.896640398830641e-5 0.00014665255730506033 -3.169880801578984e-5 -0.00014732959971297532 -4.258759872755036e-5 -0.00025761182769201696 3.766688678297214e-5 -3.753440614673309e-5; -0.00012077479186700657 0.0001033025691867806 -5.502320345840417e-5 5.658389909513062e-6 -0.00019004852219950408 -6.587530515389517e-5 5.1821589295286685e-6 7.046959217404947e-5 4.118820288567804e-5 -5.8282919781049713e-5 -1.2261625670362264e-5 0.00014709118113387376 -8.470351895084605e-5 7.381603063549846e-5 2.743432196439244e-5 -8.520652045262977e-5 7.354810077231377e-5 0.00012650976714212447 0.00011621280282270163 8.760042692301795e-5 0.00013961932563688606 -0.0001842894998844713 -1.022579635900911e-5 -0.00011576231190701947 -4.096683187526651e-5 0.00014824036043137312 5.687840257451171e-6 3.275905328337103e-5 -5.221569153945893e-5 0.00010791910608531907 -8.861748210620135e-5 0.00012954634439665824; -9.092543041333556e-5 3.515289063216187e-5 -5.346137550077401e-5 -0.000157471455167979 -0.00015207860269583762 -0.00010558732901699841 -0.00013869491522200406 -8.793915185378864e-5 0.00013772280362900347 8.253649139078334e-5 -7.272345828823745e-5 -9.965708886738867e-5 6.640296760451747e-6 4.894125595455989e-6 -3.16609803121537e-5 -1.892286672955379e-5 -3.291017492301762e-5 0.00012385143782012165 -0.00013275201490614563 -8.636977145215496e-5 2.5063278371817432e-5 6.372427014866844e-5 2.118948395946063e-5 1.1978610018559266e-5 4.604628338711336e-5 0.00013020871847402304 0.0001588298473507166 1.9736598915187642e-5 -7.660714618396014e-5 6.798684626119211e-5 -9.756983672559727e-6 5.518858597497456e-5; -6.124579522293061e-5 0.00020134357328061014 3.829167326330207e-5 2.4462106011924334e-6 9.955919085768983e-5 -6.47962442599237e-5 7.79937909101136e-5 3.7670124584110454e-5 2.546618452470284e-5 -9.722308459458873e-5 -8.392278687097132e-5 -0.00020340466289781034 -0.00019697607785928994 1.2992621122975834e-5 8.589385106461123e-5 4.027370596304536e-5 0.0001437047030776739 -1.5973897461663e-5 0.0001496356271672994 -0.0001227819884661585 -9.385155135532841e-5 5.268938184599392e-5 -4.703006925410591e-5 -3.2447300327476114e-5 0.00012561400944832712 6.604653754038736e-5 -5.6475579185644165e-5 -8.196620183298364e-5 -4.394677307573147e-5 -6.732808105880395e-5 7.649627514183521e-5 8.325988164870068e-5; 0.0001500028884038329 -7.68868630984798e-6 -0.00014835647016298026 6.821745046181604e-5 1.3846728506905492e-5 -3.7787143810419366e-5 -0.00013367092469707131 0.00016361038433387876 5.821185914101079e-5 -4.7418518079211935e-5 -3.4568089176900685e-5 -6.714640039717779e-5 9.326535655418411e-5 -4.3505864596227184e-5 -3.276586357969791e-5 -5.6351800594711676e-5 5.864919876330532e-5 -4.718692434835248e-5 -8.826269913697615e-5 -2.0737932572956197e-5 -0.00016789106302894652 2.0078210582141764e-5 0.00015071730013005435 -3.407008262001909e-5 -3.048484359169379e-5 3.9278082113014534e-5 -3.775466757360846e-5 -2.439395757392049e-6 -6.228805204955279e-7 0.00016120492364279926 -0.00010259008558932692 -8.529586193617433e-5; -7.861463382141665e-5 -0.00012134054122725502 -0.00010414719872642308 -3.446247865213081e-5 6.830264283053111e-6 0.0001560376404086128 9.051822416950017e-5 7.193125202320516e-5 0.0001303336030105129 -0.00015752940089441836 -0.00012209541455376893 -4.082265149918385e-5 1.4189170542522334e-5 4.197066300548613e-5 9.294988558394834e-5 -0.00015037422417663038 9.695152130007045e-7 -4.3477979488670826e-5 -3.4071381378453225e-5 6.287112046265975e-5 8.013405022211373e-5 6.061897147446871e-5 1.9694492948474362e-5 -5.358241105568595e-5 -0.00014767376706004143 5.6933546147774905e-5 2.679971294128336e-5 6.496150308521464e-5 -9.084594057640061e-5 1.6083286027424037e-5 4.0388255001744255e-5 -9.013346425490454e-5; -2.0846055122092366e-5 -2.4880931960069574e-5 4.4520769733935595e-5 -2.3971135306055658e-5 8.277339475171175e-6 1.7777480024960823e-5 -9.869662608252838e-5 8.257519220933318e-5 -3.307465885882266e-5 -8.552338113076985e-5 -9.292084723711014e-5 5.072267958894372e-5 -1.8525015548220836e-5 -7.684787851758301e-5 0.00015601473569404334 -6.587660755030811e-5 0.00018077429558616132 5.898134259041399e-5 -0.00017419239156879485 -6.793828652007505e-5 -7.237376121338457e-5 0.00010094613389810547 -2.610906994959805e-5 -0.00014975850353948772 -5.0404105422785506e-5 -6.415206735255197e-5 -0.00019856245489791036 -0.00017651858797762543 8.118262485368177e-5 -1.9353868992766365e-5 1.7631662558414973e-5 -1.2915371598865022e-6; -0.0001642134739086032 -5.936905290582217e-5 -0.00015168289246503264 0.00015581463230773807 -6.651486182818189e-5 -9.933992987498641e-5 7.108535646693781e-5 5.784157110610977e-6 0.00016647732991259545 2.8894895876874216e-5 2.7511930966284126e-5 -3.082477633142844e-5 2.638200612636865e-6 -0.0001535699557280168 -3.2079733500722796e-5 7.666277815587819e-5 0.00012875355605501682 3.367663157405332e-5 -6.73726899549365e-5 -2.935187012553797e-6 5.981950380373746e-5 -4.520645597949624e-5 -0.00010969716095132753 8.51147615321679e-6 -0.00016575123299844563 -5.3269330237526447e-5 9.154843428405002e-5 -7.894090231275186e-5 0.00012399067054502666 1.23935342344339e-5 0.0001407044182997197 -0.00010780304728541523; 6.558104246323637e-7 0.00011835732584586367 3.250935333198868e-5 0.00015047584020067006 6.429631866922136e-6 -4.144859121879563e-5 9.45318697631592e-6 -0.00010999361984431744 3.309261956019327e-5 3.0319732104544528e-5 1.4594262211176101e-5 -0.00019354770483914763 -7.650714906048961e-6 6.599640300919418e-7 -0.00010796025162562728 3.1829578801989555e-5 -7.832497067283839e-5 7.170726166805252e-5 7.179177373473067e-6 0.0001051917060976848 -5.131317811901681e-5 2.939760861409013e-6 0.00014999948325566947 7.029692824289668e-6 3.941830073017627e-5 3.087770664933487e-6 0.00011645170889096335 -1.8314760382054374e-5 -6.169373955344781e-5 -2.0303978089941666e-5 5.756087557529099e-5 -4.884578811470419e-5; 1.6413592675235122e-5 -1.032075124385301e-5 -3.7281042750691995e-5 -0.00012905443145427853 -4.716909097624011e-5 2.2464908397523686e-5 2.4551069145672955e-5 -0.00017304923676420003 7.900673517724499e-5 4.6557361201848835e-5 9.565069922246039e-5 -6.527082587126642e-5 9.693486936157569e-5 0.0001523612008895725 2.167165803257376e-5 -3.260642915847711e-5 9.441420115763322e-5 0.00010834385466296226 4.247644938004669e-7 8.080920815700665e-5 4.7967365389922634e-5 2.564515671110712e-5 5.897099617868662e-5 7.215316145448014e-5 0.00042928053881041706 5.4941348935244605e-5 0.00017955699877347797 -7.597003423143178e-5 0.0001218685501953587 -0.0001768823276506737 -8.536200039088726e-5 6.091127579566091e-5; 4.62793032056652e-5 -7.764581096125767e-5 4.436327799339779e-5 0.0001667793549131602 -0.00015650656132493168 -5.761794454883784e-5 -3.207174449926242e-5 -0.00011745107622118667 0.00013088008563499898 -0.00010082281369250268 4.957119745085947e-5 6.404304440366104e-5 8.508747669111472e-6 -9.650826541474089e-5 0.00011283492494840175 -7.457489573425846e-6 -9.517999569652602e-5 7.406499935314059e-5 0.00013701112766284496 -8.430534944636747e-5 -8.294195868074894e-5 -1.905938370327931e-5 0.00013233177014626563 0.00010243590077152476 -0.00012652161240112036 5.91889547649771e-5 6.7487394517229404e-6 -0.0001950975420186296 0.00016227064770646393 0.0001581325486768037 -1.5722083844593726e-5 -0.00019883934874087572], bias = [0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0; 0.0;;]), layer_4 = (weight = [3.058837683056481e-5 -0.00011662035103654489 -8.666150097269565e-5 3.1931842841004254e-6 7.824276508472394e-6 -6.860323628643528e-5 9.912481618812308e-5 -0.00011251472460571676 0.0002335306053282693 -3.3416883525205776e-5 0.00011733400606317446 -8.86485941009596e-5 -2.1340900275390595e-5 5.07594522787258e-5 7.724689203314483e-5 7.363675103988498e-5 -8.10579294920899e-5 2.4017912437557243e-5 0.00010034391016233712 -2.586626033007633e-5 -0.00022780206927563995 -0.00015493063256144524 -5.7617802667664364e-5 -0.00012039902503602207 0.00013392309483606368 0.0001633552456041798 -8.729135151952505e-5 -6.691473390674219e-5 -0.00016911975399125367 7.078426278894767e-5 0.00016903739015106112 0.00015373904898297042; -6.0984963056398556e-5 0.0001284794125240296 0.00017167426995001733 3.2206098694587126e-5 -4.257860200596042e-5 -0.0002891095355153084 -8.678244921611622e-5 0.00010542383824940771 -0.00024243899679277092 -0.00021166299120523036 -3.458916580711957e-6 -1.2406993846525438e-5 -1.472851636208361e-7 -4.610885298461653e-5 3.079714224440977e-5 7.285384072019951e-6 -8.63031018525362e-5 -0.00012452155351638794 -1.286115548282396e-5 0.00011238875595154241 0.00016220257384702563 0.00018081013695336878 0.00013031285197939724 -4.806762808584608e-5 -7.589377491967753e-5 -1.3903057151765097e-5 0.000138552684802562 -3.8111575122457e-5 0.00014341789938043803 0.0002045812434516847 9.685034456197172e-5 0.00015105496277101338], bias = [0.0; 0.0;;]))
```


Now we define a system of odes which describes motion of point like particle with Newtonian physics, uses


$$
u[1] = \chi
$$


$$
u[2] = \phi
$$


where, $p$, $M$, and $e$ are constants


```julia
function ODE_model(u, nn_params, t)
    χ, ϕ = u
    p, M, e = ode_model_params

    # In this example we know that `st` is am empty NamedTuple hence we can safely ignore
    # it, however, in general, we should use `st` to store the state of the neural network.
    y = 1 .+ first(nn([first(u)], nn_params, st))

    numer = (1 + e * cos(χ))^2
    denom = M * (p^(3 / 2))

    χ̇ = (numer / denom) * y[1]
    ϕ̇ = (numer / denom) * y[2]

    return [χ̇, ϕ̇]
end
```


```
ODE_model (generic function with 1 method)
```


Let us now simulate the neural network model and plot the results. We'll use the untrained neural network parameters to simulate the model.


```julia
prob_nn = ODEProblem(ODE_model, u0, tspan, params)
soln_nn = Array(solve(prob_nn, RK4(); u0, p=params, saveat=tsteps, dt, adaptive=false))
waveform_nn = first(compute_waveform(dt_data, soln_nn, mass_ratio, ode_model_params))

fig = with_theme(theme_web()) do
    fig = Figure()
    ax = CairoMakie.Axis(fig[1, 1]; xlabel="Time", ylabel="Waveform")

    l1 = lines!(ax, tsteps, waveform; linewidth=2, alpha=0.75)
    s1 = scatter!(ax, tsteps, waveform; markershape=:circle, markeralpha=0.25, alpha=0.5)

    l2 = lines!(ax, tsteps, waveform_nn; linewidth=2, alpha=0.75)
    s2 = scatter!(ax, tsteps, waveform_nn; markershape=:circle, markeralpha=0.25, alpha=0.5)

    axislegend(ax, [[l1, s1], [l2, s2]],
        ["Waveform Data", "Waveform Neural Net (Untrained)"]; position=:lb)

    return fig
end
```


![](1_GravitationalWaveForm-35.png)


<a id='Setting-Up-for-Training-the-Neural-Network'></a>

## Setting Up for Training the Neural Network


Next, we define the objective (loss) function to be minimized when training the neural differential equations.


```julia
function loss(θ)
    pred = Array(solve(prob_nn, RK4(); u0, p=θ, saveat=tsteps, dt, adaptive=false))
    pred_waveform = first(compute_waveform(dt_data, pred, mass_ratio, ode_model_params))
    loss = sum(abs2, waveform .- pred_waveform)
    return loss, pred_waveform
end
```


```
loss (generic function with 1 method)
```


Warmup the loss function


```julia
loss(params)
```


```
(0.1815764592497145, [-0.024274772292344968, -0.02348922980104538, -0.0227036873097454, -0.021376375369327693, -0.019479526739011318, -0.01697283592366782, -0.013803385032157679, -0.009902680268698488, -0.00518892640086138, 0.0004333096526647235, 0.007063849069774359, 0.01478584410468435, 0.023617900235550385, 0.03338501074661843, 0.043438647616104546, 0.05199495994519871, 0.054735356107684804, 0.04253022864243751, 0.0018135023001380856, -0.06659253907797334, -0.11043268892150175, -0.07606123042922097, -0.00651540670320118, 0.039016555796039555, 0.05434894391238408, 0.0529431123611871, 0.04479090359447647, 0.0347509804217082, 0.024853850871153108, 0.015854406429087285, 0.007965164649505344, 0.0011841540239593623, -0.004569582027374261, -0.00939702577300665, -0.013396180368399272, -0.0166509595725606, -0.01923267396214019, -0.021197004589591957, -0.02258618928368942, -0.023429921126064884, -0.023746325319648577, -0.02354231126322284, -0.022814850383661617, -0.02154863323960482, -0.019718192148082615, -0.017285548052859336, -0.014199451409187493, -0.01039482570159059, -0.005792000092485654, -0.00029828837708538545, 0.006184424855943527, 0.013743543536835098, 0.022406828038470303, 0.0320372336132218, 0.04207621726442397, 0.0509603832711998, 0.054856721118221735, 0.04547198137079721, 0.009471399512364495, -0.05670471807165601, -0.10865579780484134, -0.08484758530077523, -0.015465704219096975, 0.034887420943764284, 0.05366167123543637, 0.053787300101490354, 0.04612686800242874, 0.03613260783885882, 0.026114937889692887, 0.016949141181278007, 0.008888775499011311, 0.0019561285258892676, -0.003935150439793221, -0.008876798985813086, -0.012978143558725142, -0.01631836208324706, -0.018978334727239293, -0.021009818131487282, -0.02246256781787455, -0.023364288006907524, -0.023737483511020896, -0.023589879370056483, -0.02291913322843811, -0.021713693026836796, -0.019949685311252137, -0.017588042730320066, -0.014585705917587122, -0.01087288076402524, -0.006380486561168467, -0.0010102688107178402, 0.005326495954174914, 0.012726624503657805, 0.021220618484427096, 0.030709735370175174, 0.040708563621885116, 0.049854319367889234, 0.05474816497321689, 0.0478898042990082, 0.016425105967788536, -0.04664091286012749, -0.1051621432169039, -0.09270348283014195, -0.0249399603420285, 0.030099031580745506, 0.05263242313798273, 0.05450841948240961, 0.047438538689328485, 0.03752695228794071, 0.027403136564252466, 0.018067118066014295, 0.009839742072647534, 0.0027446207664530865, -0.00327986369862878, -0.008345653987847286, -0.012545434844941113, -0.01597855335518028, -0.01871328344790211, -0.020817035849720077, -0.02233107149171652, -0.02329324054230502, -0.02372255161200973, -0.02363086714415869, -0.02301817713284408, -0.021871751457491286, -0.020172657812852962, -0.01788241186688616, -0.014960384429865555, -0.011339212190974956, -0.006952879411704094, -0.0017048834681490693, 0.00449087930978228, 0.01173318668503579, 0.020061110237259365, 0.02940171129604463, 0.03934211992305149, 0.048690152275012305, 0.05443745689875209, 0.04983507487443836, 0.02266011282233791, -0.03661058375898602, -0.10008707476628882, -0.09937571012153945, -0.034819018654722166, 0.024614465034745812, 0.051220720333691995, 0.0550832721552218, 0.04871748424374765, 0.038933591796833235, 0.028711453536906035, 0.019216804255035455, 0.010811213677624236, 0.003557941002853417, -0.002613106704167246, -0.007794218651172182, -0.012103743806716563, -0.015626072177527137, -0.018443285697084044, -0.02061352123845278, -0.02219435070859974, -0.02321544921788508, -0.023701843983184874, -0.023666294679808648, -0.023110216996256826, -0.022023995696028708, -0.020385910007265237, -0.01817027277147363, -0.015323815663898285, -0.011792267718037243, -0.007511372046737038, -0.002383212408224275, 0.003677341695438847, 0.010764979309249748, 0.01892519848036613, 0.028115478575894467, 0.037980379082758066, 0.04747871004754481, 0.053955834432883286, 0.051349478936651934, 0.028194249664090523, -0.026816413208220605, -0.09359818405473913, -0.10464567064065457, -0.04495066368884517, 0.018415356043912652, 0.049373792616287396, 0.05549038100901143, 0.04995341410548837, 0.040345032751376644, 0.030049932329413345, 0.020388188707941422, 0.01180910511353641, 0.004388943197038423, -0.0019200535819000075, -0.007233459550721952, -0.01164861043530079, -0.01526546174516096, -0.01815905853542462, -0.020405993026071344, -0.022050213539114617, -0.023131713695131867, -0.023674707791517296, -0.02369582452739549, -0.02319619602260723, -0.022167626263771546, -0.020596379116618314, -0.018445895559807413, -0.015678098804282996, -0.012234337533854403, -0.008054491413620945, -0.003043193914324157, 0.0028832729137301992, 0.009818689274990565, 0.017816262929703834, 0.02685184518479113, 0.03662590496767879, 0.04623124101948425, 0.05332488576941512, 0.05248067334716873, 0.033044702418241145, -0.017403584584380474, -0.08592173028661944, -0.10833559205761953, -0.055134862218780424, 0.011480559526797425, 0.047051377942253024, 0.05569873168412235, 0.051134728629483345, 0.041762035884059905, 0.031407381848729744, 0.021588809452504597, 0.012832119296125401, 0.005244380098443046, -0.001212923058702193, -0.0066551435435096545, -0.011180478790277868, -0.014892645934292391, -0.017868953246763488, -0.020189055251548564, -0.021899194553745636, -0.023041482838318274, -0.023641949410204293, -0.0237192425787944, -0.023276042787851312, -0.022305972283950492, -0.02079686994351579, -0.018714470687779594, -0.01602246859140772, -0.012664770188211015, -0.008583721340895398, -0.004502672493580053])
```


Now let us define a callback function to store the loss over time


```julia
const losses = Float64[]

function callback(θ, l, pred_waveform)
    push!(losses, l)
    println("Training || Iteration: $(length(losses)) || Loss: $(l)")
    return false
end
```


```
callback (generic function with 1 method)
```


<a id='Training-the-Neural-Network'></a>

## Training the Neural Network


Training uses the BFGS optimizers. This seems to give good results because the Newtonian model seems to give a very good initial guess


```julia
adtype = Optimization.AutoZygote()
optf = Optimization.OptimizationFunction((x, p) -> loss(x), adtype)
optprob = Optimization.OptimizationProblem(optf, params)
res = Optimization.solve(optprob,
    BFGS(; initial_stepnorm=0.01, linesearch=LineSearches.BackTracking());
    callback, maxiters=1000)
```


```
u: ComponentVector{Float64}(layer_1 = Float64[], layer_2 = (weight = [-7.15550922904335e-5; -0.00010446947999295069; 0.00010252016363661015; -4.860137414655276e-5; 2.8771884899457095e-5; -4.034387529827566e-5; -0.0001662092690819323; 6.796199886588797e-5; -1.4444782209465314e-5; 8.310581324618271e-5; 0.00022202225227354366; 2.5437757358270557e-5; 0.00010417161684000433; -3.058424408659541e-5; 0.0001515085605205375; -0.00011519578401931415; 2.9612212529142624e-5; 0.00015001237625231748; -0.0002568641502871922; -8.352950680993451e-5; 0.00012459633580866187; 4.763888136943717e-5; 4.944892134513571e-5; 2.376210250075207e-5; -8.035228529466308e-5; 5.171789234729992e-5; 3.989083779732916e-5; 4.765904577647372e-6; -5.1250095566431056e-5; -4.9361045967066535e-5; 6.263567775028994e-5; -3.50696864188822e-5;;], bias = [-8.492903656442372e-17; -4.0359052406336285e-17; 5.2717095893417314e-17; 2.459260332695893e-17; 1.4292142803027087e-17; 3.4223178826258993e-19; -2.7091298357844425e-16; 6.027378190813252e-17; -8.198235109099886e-19; 3.816777513877427e-17; 2.298754335510422e-16; 3.701631637954752e-17; 1.934975564422093e-16; -4.9799944626304726e-17; 6.742550902825725e-17; 5.474791068497152e-18; 3.2872140962619884e-17; 2.676598926554782e-16; -4.3223903403719475e-16; -8.181806997651256e-17; 9.282660010025264e-17; 6.366327526913151e-17; 4.132671363746218e-17; 1.8139341563596306e-17; -1.390907833503826e-16; 7.837200431858887e-17; 1.0993669658206891e-16; 5.774116924128901e-18; -7.843708211693538e-17; -2.6133194347844332e-17; -7.433765502322694e-17; 1.9791504368691255e-17;;]), layer_3 = (weight = [0.00016789113620672752 -7.280895764795947e-5 -3.475611405536399e-5 -4.640504588694738e-5 5.3570682630218726e-5 -0.00012610734806019273 -5.286935951534375e-5 -9.424988051266937e-5 -6.495443849577351e-6 -8.114295591456517e-5 0.00010337762838371322 8.159688919460987e-5 1.3263604578076648e-5 -6.065993833560858e-5 -0.00018410831356976617 7.872288593700165e-5 8.233082231511004e-5 -6.556968541207204e-5 6.718307891768801e-5 2.9514140314695578e-5 0.000122589889051429 3.8736129190349455e-5 -8.881759235025813e-5 0.00017601465557147403 -0.0002003813565717606 4.97444168397452e-7 6.190496102119406e-5 2.2030668751380015e-5 0.00015630410094656544 -1.7578827648117291e-6 4.5036333594745646e-5 0.0001704430473726671; -1.3494919078642624e-5 8.349833529531356e-5 5.866752922623748e-5 0.00010080593943451838 5.641385228694718e-5 -3.575586874182033e-5 2.9119727111844404e-5 3.749077819260149e-5 0.00019686984756584576 -2.570316103505042e-6 4.128880623933369e-5 -0.00012270191058893392 -2.562069625388501e-5 -6.214563602828898e-6 -0.0001220707067139876 -8.704131454839033e-5 9.366572936154271e-5 -0.00016186262786765221 -3.2895027691540077e-5 -9.051182991503418e-5 -1.6250065021143585e-5 2.7186379663486288e-5 -5.301121695344031e-5 -6.97167574279446e-5 5.924245356903729e-5 -8.893698526923236e-5 -3.3880421545167216e-5 0.00011937908726134637 1.4332771167697656e-5 2.0321582776101567e-5 -0.0001257753332928258 0.00012691736497539395; 7.700610338231263e-5 4.411328161820115e-5 -8.293589591760815e-5 -3.73484999012586e-5 3.136176208370348e-5 0.0002431584963038185 0.00015689219624487834 9.186240102151153e-5 1.9127745034508627e-5 0.0001444245227308531 -0.00023981159567616235 7.725333314608776e-5 7.126497264704949e-5 -0.00016185573433306086 0.00017891065552117752 -0.00011224836445893033 4.410445588162149e-5 0.0001507768411816518 7.847674903908336e-5 5.226886249017495e-5 -3.581746743423879e-5 6.310752549195554e-5 -8.173915368517979e-5 -5.141271496670321e-5 -0.00010236879999995604 0.00010555383239859582 1.2090159348880848e-6 6.120270889239421e-5 -6.256556317953072e-6 -3.969148558228397e-5 -0.00018983443980816967 -4.893660108921161e-5; -9.067659109228148e-5 0.00011455254000515605 0.00023800390929586197 -5.6910203305098575e-5 -0.00010857091390157747 1.2848191297005778e-5 -0.00011735124851207936 3.4837170212037606e-5 -0.00010811064409886161 2.7915302532115783e-5 9.360789565737734e-5 4.955983397571678e-5 0.0002634681893386593 1.0243904150182551e-5 2.2014475441155463e-5 -1.3033765092638043e-5 -7.646221341066333e-6 -4.0468216205281535e-5 7.135777716659703e-5 -3.994882197098733e-5 -5.7456725947356394e-5 -0.00015199270116959452 0.0001775821744804015 5.7157428934214016e-5 -7.273065263966937e-5 -9.888109186527087e-5 2.466468661345813e-5 -7.71891120830797e-5 1.9182463553941353e-5 5.8886607554948515e-5 5.0130167189260946e-5 3.4993410981300436e-6; 1.8231830489294504e-5 6.71168742143113e-5 7.455552951670588e-5 -0.00010517496446607484 -1.3494336946110158e-5 2.428398840368009e-5 2.8178426526754044e-5 5.553091943385953e-5 6.0677277013951635e-5 6.809982698416073e-5 0.00018309932021891293 -1.4512112449097196e-5 -1.9242310719514933e-5 6.181179161887896e-5 0.00016741498949941378 9.61865949817476e-5 -3.9876093762854293e-7 3.571960734789436e-5 6.534576061181665e-5 -0.00012383190222079208 -1.908149022837289e-5 -9.305450692534288e-5 9.140953590633491e-5 4.5722361045250067e-5 -3.233754285373019e-5 -3.221159238944642e-5 3.2114186285420245e-7 -2.340872816943908e-6 6.583343167096504e-5 0.00017748402717063344 -9.533791342744597e-5 -0.00012482654017856093; 8.519840400368914e-5 8.130706907650207e-5 0.0001539510011480173 9.720764125633623e-5 -2.5108720483310034e-5 -0.00010094191032292531 0.000137268016142082 0.00018364380582171598 -3.697125442156487e-5 -0.00011249220927310535 8.898769362523485e-5 2.703541383200317e-5 0.00019729780967281892 0.00013460879915330493 0.00010913265202359372 9.10988054511064e-5 -1.6222418826125187e-5 7.259493201670407e-5 3.2337840702781586e-5 8.68972335411793e-6 2.6114876045530824e-5 0.00018526263363130056 -5.417095247137737e-5 4.863938363089235e-5 -4.4192020259278704e-5 0.0002122102631529006 5.11433644260446e-5 -7.546424251811462e-5 9.24480735830176e-5 7.026754962682347e-5 -6.652765671786601e-5 -4.7700308759865684e-5; -2.5699027955099657e-5 9.916053017225918e-5 -6.763861534561187e-5 0.00010304164965493815 -0.00023576643803533063 -0.0001277472074972822 6.35559371774839e-5 7.217412707252793e-5 -5.147003326708388e-5 3.9060963846012594e-5 -0.0001809337591649992 -9.470778246320694e-5 -6.778175525975549e-5 1.672872525962182e-5 1.061780216408895e-5 0.00020895652045586178 -8.440615726001145e-8 -0.00014963932704555133 3.5836357396745635e-8 -4.300123697173254e-5 -0.00012847774274556711 -6.747073717558551e-5 5.7480639898881616e-5 0.0002235702231162795 -6.80741396164845e-5 -0.0002368486203151173 -0.00010816636136876263 -8.761638678986531e-5 2.1520559985970572e-5 4.885755328434735e-5 5.912875343785941e-5 0.00018576949873097374; 9.67815810532637e-5 -4.5373608625041764e-5 9.44684740921813e-5 2.4571119613582344e-5 -3.9246699341121136e-5 1.8049822504152582e-5 -1.7630236723007244e-5 1.1946824293853209e-6 -0.00011317765008915685 8.835575292560766e-5 -0.00022172958986392468 -6.953815889336637e-5 0.000147474138177685 5.291495265065227e-5 5.942664731502176e-5 -0.0002342998980360705 1.1350651653707583e-6 -5.2232428764820595e-6 0.0001164083603022047 3.519790173057999e-6 9.839761990051037e-6 -6.141956535192667e-5 -0.0001454908690697187 5.977786870299371e-5 4.217971374838175e-5 -7.051878335677546e-5 0.00013016742898126603 -4.196402576543862e-5 0.00014682340563250247 -0.00011086459405977738 9.766864397771204e-5 -5.363462176082188e-5; -8.609869827527063e-6 -6.649269379432341e-5 1.68595615932578e-5 -7.308475223000537e-6 -2.9463675663465304e-5 -7.244722109044361e-5 0.00014709936477718752 1.6608947917089525e-6 -1.3000157186070677e-5 -6.685412698880552e-5 0.00011399786854869168 -4.841034932633259e-5 9.665057406072481e-5 0.00013561100605420423 -3.19450173165167e-5 -0.00011684971285741018 0.00010411084623319686 0.0001502789437026736 5.789206808090528e-5 -2.4812006803590523e-5 -8.706212428388496e-5 -4.286250076711606e-5 -4.51515733311857e-6 6.256846792075458e-5 -4.1686305838997804e-5 -8.992992114963464e-5 0.00015810026344388337 0.00011983372497616045 8.107882423337097e-5 -1.5300443909838514e-5 3.5298302474072495e-5 -5.037520712812796e-5; 0.00010349389141383243 -3.481632210123572e-5 3.2226515953240506e-5 3.46229362669827e-5 5.002565468502736e-5 -6.634839427234082e-5 -1.4001489022757063e-5 -4.114324745997205e-5 -0.0001147616339828397 -0.00010998681590236092 -0.00010575404211221618 -0.00013786558609963823 -0.00011443280435442213 -4.935037849164061e-5 -3.7090902866748784e-5 0.00014832629041238514 -6.693290105131879e-5 0.0001516896163714586 -2.8510451544835373e-5 -6.542784011499325e-5 5.029566911007155e-5 6.194942490155413e-5 3.741372075937295e-5 -5.696680533861167e-6 7.363446731078128e-5 6.432559986323662e-5 -3.4480238343080896e-5 4.4117729897420144e-5 0.0001525180423534902 -0.00011680143414806035 -4.672497287784136e-5 2.433855025928515e-5; 9.54700900333405e-5 -2.665166712498072e-5 -9.975751700360968e-5 5.3505633419704136e-5 1.155535275290997e-6 9.22465497719588e-5 -1.2146907377940698e-5 0.00019127923050880829 -0.00014922999789952066 8.811371853560198e-5 -5.646337913604444e-5 0.0001972713599538912 2.138332829096586e-5 -4.461265589590076e-5 1.246711699099717e-5 -5.46475147562307e-5 0.00024741561546442217 6.589054291584582e-5 0.00012697578685798557 -5.483681346526341e-6 -2.454957384865388e-5 0.0001294915801704383 1.0441221180812747e-5 7.520415428779259e-5 8.41735473809212e-5 4.750241177724476e-5 0.0001675049225891474 0.00011487034689388504 6.381110333357748e-5 3.9674798332712e-5 -3.0337667252313787e-5 -7.153992728809771e-5; -7.942976280928784e-5 -4.49753277282951e-5 0.00025739147185932135 -0.0001633608733757719 6.0448201292906335e-5 3.632369789529131e-5 3.113581642511889e-5 -6.049643325268523e-5 5.216497102055131e-5 -9.078591010647882e-5 4.1674648127568915e-5 0.00010054451940931778 -0.00017119716703773235 -3.894579258513218e-5 -1.4791487774606797e-5 -5.479971132471732e-5 3.5469162139356556e-5 -4.999768116275583e-5 1.0225018922709998e-5 -9.298463173790887e-5 -3.9831222057085094e-5 4.613735673019252e-5 3.790302525609254e-6 0.00017836546267034877 -0.0002776124563754825 -2.906118043056603e-5 -0.0001268080775847053 -1.8279664618881647e-5 -0.00013664924681534442 -7.58833228249422e-5 5.7032855874874565e-5 5.316136976006882e-5; 3.056887147549428e-5 -5.56983380781242e-5 -3.5602761604147284e-5 0.00010667486425090141 -0.00014087958912997202 4.568620137005516e-5 -0.0001846548933505567 8.41913766956126e-5 -0.0001585954836306977 4.693671656723238e-5 2.6843073679041706e-5 -6.1161738235305e-5 8.980920905314964e-5 -4.271025169574335e-5 0.0001670014513686688 -9.601790440200894e-5 -8.175454637667782e-5 -8.633063193593479e-6 -5.709142202670027e-5 -0.00016665280633306018 0.00013403597916777452 -0.00013517461262809572 -0.00024502066150008196 -2.7240827298291996e-5 -2.8014803651514897e-5 5.292227582257769e-5 -0.00012977698712776021 -7.777539064110047e-5 -7.147173379481249e-5 0.00012116539222487748 -3.625680107207291e-5 -5.028798445627265e-6; -6.311132989796204e-5 -1.3685526998609177e-5 -1.0147200616496227e-5 -1.0412660292075036e-5 -3.636530988589474e-5 -7.03338019477254e-5 9.502737423899469e-5 5.4287341238508184e-5 -7.076138960855268e-6 -0.00019577617155593126 8.660321958160084e-5 -3.3992118066834246e-5 -5.90356913264379e-5 -6.257901356295291e-5 -3.3095927453547535e-5 0.0001341225278636449 7.763131628306039e-5 -0.00013445754399727473 -8.934703607081465e-5 0.00012808038348592586 -8.056106986915491e-5 2.4769406930119666e-5 1.6955848816707754e-5 -9.736453018123843e-5 9.332223902018481e-5 -8.855689617777696e-5 4.0518279031659067e-5 -4.1902997570304485e-5 7.17787760848134e-5 3.859674228149933e-5 2.4483146560514117e-6 -0.0001305290216507443; 5.0517481829543885e-5 5.4143753620835475e-5 -2.9359352376971015e-5 0.00015715171564583734 -4.311878485391807e-5 5.819916866816636e-5 0.00018146830068649337 4.0242498178073384e-5 -9.175526549593515e-5 -6.7729568604166445e-6 3.1086665947037105e-5 -9.877162776733384e-6 -2.3549583895558048e-5 0.00010833751973909368 -1.2680473739646896e-5 -0.00013269154198719847 -3.482346594368745e-6 7.653128220913455e-5 -4.364076932910485e-5 -0.00022713543632785633 -4.872877736711555e-5 -4.63858135139656e-5 -2.6464197910585668e-5 -2.6142091267006124e-5 5.813591249122123e-6 6.448931042318309e-5 -5.9685849303109023e-5 -0.00013726547087795077 -1.733120309150238e-5 -1.0872597451865896e-5 2.951314006854413e-5 -7.621932420492627e-6; -9.040563314903065e-5 3.0238015038948227e-5 0.00012181732303014464 -0.00011448934389028227 0.000130980467598592 0.0001341718335754099 3.363605277280696e-5 8.976485981856005e-5 4.561380331887411e-5 -8.079413679644011e-5 -3.307760276931047e-5 0.00013253916689444806 -0.00015856562537356776 -0.00025512682337995146 -7.58173526845088e-5 0.0001822606456118492 -5.330276384311619e-6 -3.807373365253748e-5 -5.043669522257296e-5 9.810535551531694e-5 3.489956646825608e-5 9.05130319881114e-5 -6.053937328380062e-5 -6.302585540089278e-5 -3.3701021369607284e-5 -0.00016418481833517084 9.62452278474207e-5 -9.092169499473165e-5 0.00016573730966791978 -7.459374761657318e-5 -0.00014209083461883947 0.00017451739689585294; 0.00014323619112381115 -8.938290406242635e-5 -0.00010965658870284134 0.00013226304295947195 0.000212739485194994 6.951895344079828e-5 -1.2352240756650123e-5 -4.940115317460741e-5 3.3696509571892873e-6 1.877210130167056e-5 4.641084311422066e-5 3.665151015389824e-6 2.7391266175050563e-5 -9.277630155431678e-5 -5.694620844317356e-5 -0.00016452987469258424 0.00013646191078712591 -6.0238906681684174e-5 1.5523695455133162e-5 -8.656804621772827e-6 5.595656844795965e-5 -0.0001096589897688536 0.00015940201561441065 -1.0159132526517957e-5 6.866337358494623e-5 9.479311901464834e-6 1.4488757787126883e-5 -3.70149230921232e-5 0.00019446649972358135 -0.00014218015561802893 -8.470562019376669e-5 -0.000242790933353739; 8.553589707423814e-6 0.00022048867444258367 4.540662607045097e-5 -0.00010209549751149322 -0.0002119623774501292 -5.492305595677177e-5 -0.00023721350103866095 5.138430910168389e-5 -0.0001627608095600067 0.0001435313364186528 -8.892151041205722e-5 -9.29930780852942e-5 3.3872017722876725e-5 -3.9128603618757986e-5 -2.3710491093390432e-5 9.694456579612759e-5 0.00027599273502577264 -4.712619700023489e-6 7.039636451967339e-5 4.157940324379309e-5 -5.442727948089868e-5 -1.3312711105265821e-5 3.8744424584854234e-5 -0.00020635485512453895 -4.9566757895683955e-5 4.696030495555311e-5 0.00014029792995874006 8.546966759471389e-5 0.0001541604190993326 -2.0456879299183543e-5 -4.92502400217056e-6 -9.969407497688962e-5; 9.620062619748671e-5 0.00018057887346319113 0.00011114312938249855 4.0306916256184995e-5 -4.170656111139692e-5 -0.0001880985700122721 -7.334953706643225e-5 2.678652809069633e-5 -0.00013925445536781925 6.061004669706496e-5 -8.657907610225007e-5 -4.253870146979467e-5 2.676648828443794e-5 1.411046023665109e-5 4.2106095495056616e-7 0.00014872186430099627 3.1817805487179395e-5 1.7585352370185864e-7 3.2249138806468404e-5 6.538930941559801e-6 -2.4413150546506595e-5 3.678492712739978e-5 0.00010304421730640467 -0.00016824978674461022 -4.923802125315957e-5 -0.0001290247791044122 0.0001449995134894096 -4.234630696058167e-5 -8.975755635813686e-5 -6.0836454300925755e-5 6.424619923879528e-5 -4.9187497003487094e-5; 7.744885529939478e-5 -0.00015931699730606353 0.00010755012495758407 0.00016082257658092696 -3.1502167112534705e-5 3.589062267531099e-5 -3.1419843290108816e-5 5.8872189547060246e-5 1.0878538850761629e-5 -5.337806491331735e-5 -0.00018028118487597948 3.677792583062347e-6 2.3946663495394634e-5 -1.053189593255831e-5 4.692143644172173e-5 0.0001805441470056626 -4.1273952811365786e-5 -0.00012387938753852216 -9.271844683438798e-6 -7.389463557080904e-5 -7.15687083724101e-5 8.48978570135163e-5 -7.018126329091919e-5 -4.172619723283297e-5 0.00021023134919198624 -6.781111282214132e-5 3.8571445620278064e-5 -0.0001439298166955037 0.00010070165895706433 -5.459237494540011e-5 -2.183519158313592e-5 3.913555789006331e-5; 0.00011107870695826273 -7.521458437720078e-5 5.174875868663455e-5 -5.6896480692617233e-5 7.887563870002464e-5 -0.0001889324686099506 -2.1163503425744228e-5 8.280828204927359e-6 6.849329101799975e-5 -3.5625378678622387e-5 -7.525650116904044e-5 3.804912002936896e-5 2.9112081300744405e-5 7.687477945995458e-5 -1.1950556746414552e-5 -0.00010661926908239634 3.669880052160416e-5 0.00012179686191204437 -0.0002980970512918337 -1.2459479058696668e-5 0.0002522876983666042 2.0879806378556838e-5 4.980071562289105e-5 3.86935879750453e-5 7.42467399494961e-5 3.220588941888714e-5 3.160510632272709e-5 0.00010908216236106121 -2.149863221444823e-5 0.00019051787412439322 5.181699261714456e-5 -5.383770812938068e-5; 0.0001387623581706059 0.00019792252924726462 -2.485939666603128e-5 0.00022347863187514793 4.855970319676671e-5 -1.729631521248219e-5 -9.142353309815573e-5 -0.0001340109499267793 -0.00011827012867234225 2.176517506268596e-6 0.00014542049967187983 -0.00020658449438433647 1.0362065319170962e-5 -6.166597240171862e-5 -0.00015664486790573328 2.9365394135497325e-5 7.06956580524678e-6 -1.038188037263848e-6 -2.396348981507013e-5 2.147622972752323e-5 -0.00010034748783600123 -0.0001527795299751257 -5.912546629934017e-5 0.00015410976839684394 2.8964608924252437e-5 0.00014665076224100413 -3.170060307984668e-5 -0.00014733139477703312 -4.25893937916066e-5 -0.00025761362275607334 3.766509171891667e-5 -3.7536201210790143e-5; -0.00012077371620953843 0.00010330364484424671 -5.502212780093793e-5 5.659465566982151e-6 -0.00019004744654203443 -6.587422949642581e-5 5.183234586988887e-6 7.047066783151777e-5 4.11892785431479e-5 -5.8281844123582224e-5 -1.2260550012909655e-5 0.00014709225679134346 -8.470244329337993e-5 7.381710629296805e-5 2.7435397621854297e-5 -8.520544479516451e-5 7.354917642978339e-5 0.0001265108427995865 0.00011621387848014837 8.760150258048542e-5 0.0001396204012943505 -0.00018428842422700217 -1.0224720701540051e-5 -0.00011576123624954974 -4.0965756217798855e-5 0.0001482414360888421 5.68891591492053e-6 3.2760128940840947e-5 -5.221461588198993e-5 0.00010792018174278816 -8.861640644873279e-5 0.00012954742005412775; -9.09268116805692e-5 3.515150936493084e-5 -5.346275676800522e-5 -0.00015747283643521387 -0.00015207998396307316 -0.00010558871028423359 -0.00013869629648922762 -8.79405331210225e-5 0.00013772142236176765 8.253511012355052e-5 -7.272483955545122e-5 -9.96584701346243e-5 6.638915493220684e-6 4.892744328220467e-6 -3.1662361579379315e-5 -1.8924247996783764e-5 -3.291155619025317e-5 0.00012385005655289583 -0.00013275339617335185 -8.637115271938776e-5 2.5061897104588467e-5 6.372288888143353e-5 2.1188102692225784e-5 1.1977228751323579e-5 4.604490211988032e-5 0.0001302073372067883 0.00015882846608348137 1.9735217647951714e-5 -7.660852745119489e-5 6.798546499395729e-5 -9.758364939793903e-6 5.518720470773916e-5; -6.124559248446752e-5 0.00020134377601907288 3.829187600176482e-5 2.446413339655708e-6 9.95593935961532e-5 -6.479604152146038e-5 7.799399364857523e-5 3.767032732257359e-5 2.5466387263166257e-5 -9.722288185612576e-5 -8.392258413251109e-5 -0.00020340446015934693 -0.0001969758751208272 1.2992823861439197e-5 8.589405380307315e-5 4.027390870150793e-5 0.0001437049058161373 -1.5973694723201043e-5 0.0001496358299057585 -0.00012278178572769553 -9.3851348616866e-5 5.268958458445721e-5 -4.702986651564264e-5 -3.244709758901272e-5 0.00012561421218679013 6.604674027885061e-5 -5.647537644718084e-5 -8.196599909452022e-5 -4.394657033726821e-5 -6.732787832034067e-5 7.649647788029838e-5 8.326008438716403e-5; 0.00015000187514856367 -7.689699565115311e-6 -0.00014835748341824768 6.821643720654592e-5 1.3845715251634874e-5 -3.778815706568973e-5 -0.00013367193795233315 0.00016360937107860938 5.8210845885739966e-5 -4.741953133448057e-5 -3.45691024321555e-5 -6.714741365244846e-5 9.326434329891677e-5 -4.3506877851497765e-5 -3.276687683496131e-5 -5.635281384997824e-5 5.864818550803472e-5 -4.7187937603616024e-5 -8.826371239222554e-5 -2.0738945828224813e-5 -0.00016789207628421234 2.0077197326871617e-5 0.00015071628687478427 -3.40710958752898e-5 -3.0485856846962574e-5 3.9277068857744515e-5 -3.7755680828878836e-5 -2.4404090126629304e-6 -6.238937757655599e-7 0.00016120391038752918 -0.00010259109884459655 -8.529687519144482e-5; -7.861553920185557e-5 -0.00012134144660769221 -0.0001041481041068604 -3.446338403257054e-5 6.82935890261294e-6 0.0001560367350281729 9.051731878906795e-5 7.19303466427661e-5 0.0001303326976300726 -0.00015753030627485668 -0.0001220963199341947 -4.082355687962407e-5 1.4188265162085128e-5 4.196975762504599e-5 9.294898020351473e-5 -0.00015037512955706685 9.68609832560547e-7 -4.347888486910459e-5 -3.4072286758874115e-5 6.287021508222137e-5 8.013314484167792e-5 6.061806609402896e-5 1.9693587568034675e-5 -5.35833164361262e-5 -0.00014767467244047988 5.693264076733527e-5 2.6798807560843416e-5 6.496059770477423e-5 -9.084684595684024e-5 1.6082380646984347e-5 4.0387349621304995e-5 -9.013436963534462e-5; -2.0848955372964724e-5 -2.4883832210936474e-5 4.4517869483068316e-5 -2.397403555693062e-5 8.274439224294772e-6 1.777457977408518e-5 -9.869952633337956e-5 8.257229195846033e-5 -3.307755910969964e-5 -8.552628138164053e-5 -9.29237474879409e-5 5.0719779338067144e-5 -1.852791579908779e-5 -7.68507787684593e-5 0.00015601183544318784 -6.587950780117279e-5 0.000180771395335285 5.8978442339558005e-5 -0.00017419529181960983 -6.794118677094568e-5 -7.237666146424714e-5 0.00010094323364723043 -2.611197020047293e-5 -0.00014976140379036434 -5.040700567365659e-5 -6.415496760342663e-5 -0.000198565355148786 -0.0001765214882285026 8.117972460280707e-5 -1.9356769243641254e-5 1.762876230754149e-5 -1.2944374107625251e-6; -0.0001642144391309133 -5.9370018128130516e-5 -0.00015168385768734102 0.00015581366708542708 -6.651582705049343e-5 -9.93408950972977e-5 7.108439124463478e-5 5.7831918883006545e-6 0.0001664763646902838 2.8893930654564615e-5 2.751096574398797e-5 -3.082574155374002e-5 2.6372353903285177e-6 -0.00015357092095032821 -3.208069872302731e-5 7.666181293357062e-5 0.00012875259083270537 3.367566635174865e-5 -6.737365517722738e-5 -2.9361522348633723e-6 5.981853858143059e-5 -4.52074212018073e-5 -0.00010969812617363855 8.510510930905184e-6 -0.00016575219822075534 -5.3270295459837386e-5 9.154746906173872e-5 -7.894186753506366e-5 0.00012398970532271578 1.2392569012122889e-5 0.0001407034530774092 -0.00010780401250772665; 6.567957527981915e-7 0.00011835831117402766 3.251033866015278e-5 0.00015047682552883672 6.4306171950893405e-6 -4.144760589062868e-5 9.454172304474531e-6 -0.00010999263451615143 3.309360488836066e-5 3.0320717432709782e-5 1.4595247539327766e-5 -0.00019354671951098042 -7.64972957788497e-6 6.609493582591113e-7 -0.00010795926629746715 3.183056413015277e-5 -7.83239853446712e-5 7.170824699621279e-5 7.180162701619383e-6 0.00010519269142585004 -5.131219279085431e-5 2.9407461895757548e-6 0.0001500004685838361 7.0306781524569555e-6 3.941928605834167e-5 3.088755993100099e-6 0.00011645269421913032 -1.831377505388691e-5 -6.169275422528119e-5 -2.0302992761774985e-5 5.7561860903457206e-5 -4.8844802786537125e-5; 1.6417867165888252e-5 -1.031647675320788e-5 -3.727676826004631e-5 -0.0001290501569636216 -4.7164816485581054e-5 2.2469182888181637e-5 2.4555343636295012e-5 -0.00017304496227354618 7.901100966790488e-5 4.656163569249949e-5 9.565497371305256e-5 -6.526655138060713e-5 9.693914385222094e-5 0.00015236547538023142 2.167593252320227e-5 -3.260215466783523e-5 9.44184756482922e-5 0.0001083481291535914 4.2903898436959626e-7 8.08134826476572e-5 4.7971639880561405e-5 2.564943120176418e-5 5.8975270669343435e-5 7.215743594513956e-5 0.00042928481330106836 5.49456234259011e-5 0.00017956127326413597 -7.596575974077163e-5 0.00012187282468601528 -0.00017687805316001683 -8.535772590023249e-5 6.091555028631941e-5; 4.6279269840039624e-5 -7.76458443268832e-5 4.4363244627772265e-5 0.0001667793215475346 -0.00015650659469055732 -5.761797791446345e-5 -3.207177786488776e-5 -0.00011745110958681225 0.00013088005226937334 -0.00010082284705812823 4.957116408523437e-5 6.404301103803542e-5 8.508714303485961e-6 -9.650829878036651e-5 0.00011283489158277638 -7.457522939051334e-6 -9.518002906215165e-5 7.406496598751521e-5 0.00013701109429722005 -8.430538281199303e-5 -8.29419920463744e-5 -1.9059417068904913e-5 0.00013233173678064002 0.00010243586740589913 -0.00012652164576674595 5.91889213993515e-5 6.748706086097326e-6 -0.00019509757538425525 0.00016227061434083832 0.0001581325153111781 -1.5722117210219313e-5 -0.00019883938210650136], bias = [1.4119539843730487e-9; -8.862376845591249e-11; 1.9300192225508705e-9; 1.1366200387044514e-9; 2.815448738543126e-9; 6.362706722072904e-9; -2.1428233380332754e-9; -1.5122840651261918e-10; 1.926319782531481e-9; -6.393626842255229e-10; 5.437047083786287e-9; -2.3390387522625154e-9; -3.691061202220092e-9; -1.5725774749314422e-9; -5.869173535503308e-10; 1.1926766964860688e-10; 1.6157989754178855e-10; -5.3348651360503546e-11; -2.3728401294516707e-10; -2.4593077455026457e-11; 1.9298558402802673e-9; -1.7950640577817836e-9; 1.075657469918325e-9; -1.3812672359409164e-9; 2.027384634278512e-10; -1.0132552708885414e-9; -9.053804404171781e-10; -2.9002508771812203e-9; -9.65222311785887e-10; 9.853281674692737e-10; 4.274490660193791e-9; -3.336562563039906e-11;;]), layer_4 = (weight = [-0.0006627712346373913 -0.0008099800060016549 -0.0007800210687743729 -0.0006901664419875012 -0.0006855352032101192 -0.0007619619960508707 -0.0005942347409939497 -0.0008058743792188532 -0.0004598289754350717 -0.0007267765296679698 -0.0005760250165637733 -0.0007820081235340194 -0.0007147002493450097 -0.0006426001489762194 -0.0006161127556153277 -0.0006197229038011119 -0.0007744175840491271 -0.0006693417426507386 -0.0005930157437774604 -0.0007192259154666608 -0.0009211616325684541 -0.0008482902101721075 -0.0007509774310946144 -0.0008137586360241685 -0.000559436559446722 -0.0005300043879474313 -0.000780650987516512 -0.0007602741978240212 -0.000862479386703533 -0.0006225753707566892 -0.000524321876711708 -0.0005396206061434635; 0.00016006500928942145 0.0003495293986783277 0.0003927242284354724 0.0002532560757399871 0.00017847132851616718 -6.805983350507839e-5 0.0001342675058943074 0.00032647382429198024 -2.1389034198200757e-5 9.386992148631587e-6 0.00021759086881318032 0.0002086429524611195 0.00022090260388577454 0.00017494111611860943 0.0002518471260758216 0.00022833537018689668 0.00013474688417223512 9.652843267700757e-5 0.000208188830345947 0.00033343874216026 0.000383252530905417 0.00040186009855420335 0.0003513628297093568 0.00017298234410975083 0.00014515621101797815 0.0002071469222036637 0.0003596026649357352 0.00018293835038805196 0.0003644678784715062 0.0004256312228055109 0.0003179002074887277 0.000372104948976513], bias = [-0.0006933596551503704; 0.00022104998621310534;;]))
```


<a id='Visualizing-the-Results'></a>

## Visualizing the Results


Let us now plot the loss over time


```julia
fig = with_theme(theme_web()) do
    fig = Figure()
    ax = CairoMakie.Axis(fig[1, 1]; xlabel="Iteration", ylabel="Loss")

    lines!(ax, losses; linewidth=2, alpha=0.75)

    return fig
end
```


![](1_GravitationalWaveForm-48.png)


Finally let us visualize the results


```julia
prob_nn = ODEProblem(ODE_model, u0, tspan, res.u)
soln_nn = Array(solve(prob_nn, RK4(); u0, p=res.u, saveat=tsteps, dt, adaptive=false))
waveform_nn_trained = first(compute_waveform(dt_data, soln_nn, mass_ratio,
    ode_model_params))

fig = with_theme(theme_web()) do
    fig = Figure()
    ax = CairoMakie.Axis(fig[1, 1]; xlabel="Time", ylabel="Waveform")

    l1 = lines!(ax, tsteps, waveform; linewidth=2, alpha=0.75)
    s1 = scatter!(ax, tsteps, waveform; markershape=:circle, markeralpha=0.25, alpha=0.5)

    l2 = lines!(ax, tsteps, waveform_nn; linewidth=2, alpha=0.75)
    s2 = scatter!(ax, tsteps, waveform_nn; markershape=:circle, markeralpha=0.25, alpha=0.5)

    l3 = lines!(ax, tsteps, waveform_nn_trained; linewidth=2, alpha=0.75)
    s3 = scatter!(ax, tsteps, waveform_nn_trained; markershape=:circle, markeralpha=0.25,
        alpha=0.5)

    axislegend(ax, [[l1, s1], [l2, s2], [l3, s3]],
        ["Waveform Data", "Waveform Neural Net (Untrained)", "Waveform Neural Net"];
        position=:lb)

    return fig
end
```


![](1_GravitationalWaveForm-50.png)


---


*This page was generated using [Literate.jl](https://github.com/fredrikekre/Literate.jl).*

